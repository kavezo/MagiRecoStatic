define("underscore backbone backboneCommon ajaxControl command text!template/util/SearchQuest.html text!css/util/SearchQuest.css QuestUtil js/view/quest/QuestListPartsView".split(" "),function(k,t,a,p,m,v,w,x,q){var n=null,l,g,z=t.View.extend({initialize:function(a){this.giftViews=[];this.template=k.template(v);this.createDom()},events:function(){var c={};c[a.cgti+" .tabBtns li"]=this.tabFunc;c[a.cgti+" .orderBtn"]=this.orderFunc;return c},render:function(){this.$el.html(this.template(p.getPageJson()));
return this},createDom:function(){this.halfAp=this.campaignData=null;l.campaignList&&(this.campaignData=a.campaignParse(l.campaignList));a.setGlobalView();a.content.append(this.render().el);this.createView()},createView:function(){a.ready.hide();var c=this;q.prototype.parentView=this;q.prototype.template=k.template($("#QuestListParts").text());r.prototype.parentView=this;r.prototype.template=k.template($("#GiftParts").text());y();var d=l.giftList,b=a.doc.createDocumentFragment(),h=a.doc.createDocumentFragment();
k.each(d,function(e){if(!(600<=e.id)){e.quantity=0;a.storage.userGiftList.findWhere({giftId:e.id})&&(e.quantity=a.storage.userGiftList.findWhere({giftId:e.id}).toJSON().quantity);var f=new r({model:e});f.el.dataset.giftid=e.id;f.el.dataset.scrollHash=e.id;c.giftViews.push(f);300>e.id||551==e.id?h.appendChild(f.render().el):b.appendChild(f.render().el)}});a.doc.querySelector(".itemScrollInner .gift01").appendChild(b);a.doc.querySelector(".itemScrollInner .gift02").appendChild(h);a.searchQuestGiftId&&
a.forceScrollPreset("itemScrollWrap","itemScrollInner",a.searchQuestGiftId,!0);a.scrollSet("itemScrollWrap","itemScrollInner",!0);a.scrollSet("questScrollWrap","questScrollInner",!0);this.orderInit();m.getBaseData(a.getNativeObj())},modelSend:function(c,d){c=a.storage.userSectionList.findWhere({sectionId:c?Number(c.currentTarget.parentNode.dataset.sectionid):d});if(!c)return!1;c=c.toJSON();if(d=a.storage.userChapterList.findWhere({chapterId:Number(c.section.genericId)}))c.section.chapterNoForView=
d.toJSON().chapter.chapterNoForView,c.section.chapter=d.toJSON().chapter;return c},tabFunc:function(c,d){var b=null,h=null;if(c){c.preventDefault();if(a.isScrolled())return;m.startSe(1002);b=c.currentTarget;h=c.currentTarget.dataset.type}else d&&(b=a.doc.querySelector("[data-type\x3d"+d+"]"),h=d);c="gift01"==h?"gift02":"gift01";a.removeClass(a.doc.querySelector(".tabBtns .current"),"current");a.addClass(b,"current");a.addClass(a.doc.querySelector("."+c),"hide");a.removeClass(a.doc.querySelector("."+
h),"hide");b="gift01"==h?"Materials":"Orbs/Books List";a.doc.querySelector("#itemWrap h2").innerText=b;a.scrollRefresh("itemScrollWrap","itemScrollInner",!0)},orderFunc:function(c){c.preventDefault();if(!a.isScrolled()){var d=a.sfml.SearchQuest;c.currentTarget.classList.contains("orderTypeBtn")?a.sfml.SearchQuest[0]="difficulty"==d[0]?"ap":"difficulty":a.sfml.SearchQuest[1]="asc"==d[1]?"desc":"asc";a.sfm();this.orderInit();u()}},orderInit:function(){"asc"==a.sfml.SearchQuest[1]?a.doc.querySelector(".orderBtn").className=
"orderBtn TE se_tabs asc":a.doc.querySelector(".orderBtn").className="orderBtn TE se_tabs desc"}}),r=t.View.extend({className:"gift",initialize:function(){this.listenTo(this.parentView,"removeGiftView",this.removeView)},events:function(){var c={};c[a.cgti]=this.tapGift;return c},render:function(){this.$el.html(this.template({model:this.model}));return this},tapGift:function(c){if(c){c.preventDefault();if(a.isScrolled())return;c=c.currentTarget;m.startSe(1002)}else c=this.el;g&&g.trigger("removeView");
console.log("tapGift");a.doc.querySelector("#itemWrap .select")==c?(a.removeClass(a.doc.querySelector("#itemWrap .select"),"select"),a.removeClass(a.doc.querySelector("#questWrap .defaultText"),"hide"),a.addClass(a.doc.querySelector("#questWrap .questNoneText"),"hide"),a.searchQuestGiftId=null):(a.removeClass(a.doc.querySelector("#itemWrap .select"),"select"),a.addClass(c,"select"),a.addClass(a.doc.querySelector("#questWrap .defaultText"),"hide"),a.addClass(a.doc.querySelector("#questWrap .questNoneText"),
"hide"),a.dropItemMap[this.model.id]&&0!==a.dropItemMap[this.model.id].length?A(this.model.id):a.removeClass(a.doc.querySelector("#questWrap .questNoneText"),"hide"),a.searchQuestGiftId=this.model.id)},removeView:function(){this.off();this.remove()}}),A=function(c){var d=a.doc.createDocumentFragment();k.each(a.dropItemMap[c],function(b,c){var e=g.modelSend(null,b.questBattle.sectionId);c=e.section.questType;b.searchViewObj={};e.section.chapter&&(b.searchViewObj.chapterNoForView=e.section.chapter.chapterNoForView,
b.searchViewObj.chapterId=e.section.chapter.chapterId);b.searchViewObj.genericIndex=e.section.genericIndex;if("CHARA"==c&&e.section.genericId){var f=a.storage.userCharaList.findWhere({charaId:e.section.charaId});b.searchViewObj.chara=f?f.toJSON().chara:{}}if("COSTUME"==c&&e.section.charaId)if(f=a.storage.userCharaList.findWhere({charaId:e.section.charaId})){var h=(e.section.genericId+"").slice(-2),h=a.storage.userLive2dList.findWhere({charaId:e.section.charaId,live2dId:h}),f=f.toJSON().chara,h=h.toJSON().live2d;
b.searchViewObj.chara=f;b.searchViewObj.live2d=h}else b.searchViewObj.chara={};b.questBattle.limitTurn&&(b.searchViewObj.limitTurn=!0);"HARD"==b.questBattle.questBattleType?(b.searchViewObj.isHard=!0,b.searchViewObj.ap=b.questBattle.ap,b.searchViewObj.difficulty=b.questBattle.difficulty):(b.searchViewObj.ap=e.section.ap,b.searchViewObj.difficulty=e.section.difficulty);g.campaignData&&g.campaignData.HALF_AP&&k.each(g.campaignData.HALF_AP.questType,function(a,c){if("MAIN"==a||"SUB"==a)a==e.section.questType&&
(0<=g.campaignData.HALF_AP.chapterIds.indexOf(String(b.searchViewObj.chapterId))||0===g.campaignData.HALF_AP.chapterIds.length)&&(b.searchViewObj.halfAp=Math.ceil(b.searchViewObj.ap/2));else if("ALL"===a||a==e.section.questType)b.searchViewObj.halfAp=Math.ceil(b.searchViewObj.ap/2)});f=new q({model:b});f.el.dataset.scrollHash=b.questBattleId;f.el.dataset.sectionid=b.questBattle.sectionId;f.el.dataset.difficulty=b.searchViewObj.difficulty;f.el.dataset.ap=b.searchViewObj.ap;"MAIN"==c?"HARD"==b.questBattle.questBattleType?
a.addClass(f.el,"mainHard"):a.addClass(f.el,"main"):"SUB"==c?a.addClass(f.el,"side"):"CHARA"==c?a.addClass(f.el,"chara"):"COSTUME"==c&&a.addClass(f.el,"costume");b.searchViewObj.halfAp&&(f.model.halfAp=b.searchViewObj.halfAp,a.addClass(f.el,"halfAp"));d.appendChild(f.render().el)});a.doc.querySelector(".questScrollInner").appendChild(d);u();a.charaListCustomizeSelectId||a.charaListComposeMagiaSelectId?a.charaListCustomizeSelectId?a.historyArr=["MyPage","CharaListCustomize/"+a.charaListCustomizeSelectId,
"SearchQuest"]:a.charaListComposeMagiaSelectId&&(a.historyArr=["MyPage","CharaListComposeMagia/"+a.charaListComposeMagiaSelectId,"SearchQuest"]):a.searchQuestGiftId&&n&&(a.forceScrollPreset("questScrollWrap","questScrollInner",n,!0),n=null,a.historyArr=["MyPage","ItemListTop","SearchQuest"]);a.scrollRefresh("questScrollWrap","questScrollInner",!0)},y=function(){a.dropItemMap={};var c=0;k.each(l.userQuestBattleList,function(d,b){b=d.questBattle.sectionId;if(!(4E5<=b&&7E5>b||8E5<=b)){for(b=1;10>=b;)d.questBattle["dropItem"+
b]&&k.each(d.questBattle["dropItem"+b],function(c,b){-1!=b.indexOf("rewardCode")&&(c=c.split("_")[1],a.dropItemMap[c]||(a.dropItemMap[c]=[]),d.cleared&&a.dropItemMap[c].push(d))}),b=b+1|0;c++}});console.log(a.dropItemMap)},u=function(){var c=a.sfml.SearchQuest,d="asc"===c[1]?-1:1,b=0,g=a.doc.querySelector(".questScrollInner");[].slice.call(g.querySelectorAll(".quest")).map(function(a){return{dom:a,param:a.dataset}}).sort(function(a,b){if("ap"==c[0]){if(Number(b.param.ap)<Number(a.param.ap))return-1*
d;if(Number(b.param.ap)>Number(a.param.ap))return 1*d}else if("difficulty"==c[0]){if(Number(b.param.difficulty)<Number(a.param.difficulty))return-1*d;if(Number(b.param.difficulty)>Number(a.param.difficulty))return 1*d}return Number(b.param.scrollHash)<Number(a.param.scrollHash)?-1*d:Number(b.param.scrollHash)>Number(a.param.scrollHash)?1*d:0}).forEach(function(a){a.dom.style.WebkitOrder=b;a.dom.style.order=b;b=b+1|0})},B=function(){a.mainQuestMode="NORMAL";a.sfml.SearchQuest||(a.sfml.SearchQuest=
["ap","desc"],a.sfm());a.setStyle(w);l=p.getPageJson();g=new z;x.supportPickUp(l);if(a.searchQuestGiftId){300>Number(a.searchQuestGiftId)||551==Number(a.searchQuestGiftId)?g.tabFunc(null,"gift02"):g.tabFunc(null,"gift01");console.log(a.searchQuestGiftId);var c=k.find(g.giftViews,function(c){return c.model.id==a.searchQuestGiftId});c?c.tapGift():(g.tabFunc(null,"gift01"),a.searchQuestGiftId=null)}else g.tabFunc(null,"gift01")};return{needModelIdObj:[{id:"user"},{id:"gameUser"},{id:"userStatusList"},
{id:"userCharaList"},{id:"userCardList"},{id:"userDoppelList"},{id:"itemList"},{id:"userItemList"},{id:"giftList"},{id:"userGiftList"},{id:"userDailyChallengeList"},{id:"userTotalChallengeList"},{id:"userLimitedChallengeList"},{id:"userGiftList"},{id:"userPieceList"},{id:"userPieceSetList"},{id:"userDeckList"},{id:"userLive2dList"},{id:"userFollowList"},{id:"userChapterList"},{id:"userSectionList"},{id:"userQuestBattleList"},{id:"userQuestAdventureList"}],fetch:function(a){a&&(n=a);p.pageModelGet(this.needModelIdObj)},
init:function(){B()},startCommand:function(){m.startBgm("bgm01_anime07");m.changeBg("web_common.ExportJson")},remove:function(a){g&&(g.trigger("removeView"),g.trigger("removeGiftView"),g.remove());n=null;a()}}});