define(["underscore","backbone","backboneCommon","ajaxControl","js/view/memoria/MemoriaSortView"],function(n,b,d,p,m){var l={RANK_1:0,RANK_2:1,RANK_3:2,RANK_4:3,RANK_5:4},f=["get","desc",null,null,null,null,1,null,null,null];b=function(a,c){this.memoryHash=a;this.parentView=c;this.sortPrm=[];this.sortInit()};b.prototype.sortStart=function(a){a||(a=this.sortPrm);var c="asc"===a[1]?1:-1,b,k=0;"MemoriaList"===d.location||"PieceArchive"===d.location?b=d.doc.getElementById("memoriaWrapInner"):"MemoriaCompose"===
d.location?b=d.doc.getElementById("cardWrap"):"MemoriaEquip"===d.location&&(b=d.doc.getElementById("scrollInner"));var h=!1,g=window.getComputedStyle(b).display;if("flex"===g||"-webkit-flex"===g)h=!0;[].slice.call(b.querySelectorAll(".userMemoriaIcon")).map(function(a){var c=a.getElementsByClassName("paramWrap")[0].dataset;return{dom:a,param:c}}).sort(function(b,e){if("rank"==a[0]){if(l[e.param.rank]<l[b.param.rank])return-1*c;if(l[e.param.rank]>l[b.param.rank])return 1*c}else if("level"==a[0]){if(Number(e.param.level)<
Number(b.param.level))return-1*c;if(Number(e.param.level)>Number(b.param.level))return 1*c}else if("atk"==a[0]){if(Number(e.param.atk)<Number(b.param.atk))return-1*c;if(Number(e.param.atk)>Number(b.param.atk))return 1*c}else if("def"==a[0]){if(Number(e.param.def)<Number(b.param.def))return-1*c;if(Number(e.param.def)>Number(b.param.def))return 1*c}else if("hp"==a[0]){if(Number(e.param.hp)<Number(b.param.hp))return-1*c;if(Number(e.param.hp)>Number(b.param.hp))return 1*c}else if("lb"==a[0]){if(Number(e.param.lb)<
Number(b.param.lb))return-1*c;if(Number(e.param.lb)>Number(b.param.lb))return 1*c}if("get"!==a[0]){if(Number(e.param.pieceId)<Number(b.param.pieceId))return-1*c;if(Number(e.param.pieceId)>Number(b.param.pieceId))return 1*c}if(Date.parse(e.param.created)<Date.parse(b.param.created))return-1*c;if(Date.parse(e.param.created)>Date.parse(b.param.created))return 1*c;if("get"===a[0]){if(Number(e.param.pieceId)<Number(b.param.pieceId))return-1*c;if(Number(e.param.pieceId)>Number(b.param.pieceId))return 1*
c}return 0}).forEach(function(c){if(h){var e=k;a[8]&&c.dom.classList.contains("equiped")&&(e=e-1E3|0);"PieceArchive"===d.location&&a[4]&&c.dom.classList.contains("effective")&&(e=e-1E3|0);c.dom.style.WebkitOrder=e;c.dom.style.order=e;k=k+1|0}else a[8]&&c.dom.classList.contains("equiped")&&(c.dom.style.WebkitOrder="-1000",c.dom.style.order="-1000"),b.appendChild(c.dom)});this.parentView&&this.parentView.afterFilterFunc()};b.prototype.sortInit=function(){if(this.memoryHash){this.localStorageCheck(this.memoryHash);
for(var a=4;a<f.length;)void 0===this.sortPrm[a]&&(this.sortPrm[a]=f[a]),a=a+1|0;d.sfml[this.memoryHash]=this.sortPrm;d.sfm()}else this.sortPrm=f};b.prototype.localStorageCheck=function(a){a&&a in d.sfml?this.sortPrm=d.sfml[a]:!a||a in d.sfml||(this.sortPrm=f,d.sfml[a]=this.sortPrm,d.sfm())};b.prototype.ascSort=function(a){this.sortPrm[1]=a;this.multiSort(this.sortPrm)};b.prototype.sortPopupOpen=function(a){var c;m.prototype.cardSort=this;c=new m;new d.PopupClass({popupType:"typeB"},null,null,function(){c.removeView()});
d.doc.getElementById("popupArea").getElementsByClassName("popupTextArea")[0].appendChild(c.render().el);a=d.doc.getElementById("sortfilter").getElementsByClassName("filterList");for(var b=0,k=a.length;b<k;){var h=parseInt(a[b].dataset.sortid);if(this.sortPrm[h])for(var h=this.sortPrm[h].split(","),g=a[b].getElementsByClassName("filterBtn"),f=0,e=g.length;f<e;)g[f].classList.contains("ALL")||-1<h.indexOf(g[f].dataset.filter)&&g[f].classList.add("current"),f=f+1|0;else a[b].getElementsByClassName("ALL")[0].classList.add("current");
b=b+1|0}};b.prototype.firstSort=function(){this.sortPrm&&this.sortStart(this.sortPrm)};b.prototype.multiSort=function(a){this.sortPrm=a;this.sortStart(this.sortPrm);a=[];for(var c=0;c<f.length;)a.push(this.sortPrm[c]),c=c+1|0;this.memoryHash&&(d.sfml[this.memoryHash]=a,d.sfm())};b.prototype.saveMemory=function(){if(this.sortPrm&&this.memoryHash){for(var a=[],c=0;c<f.length;)a.push(this.sortPrm[c]),c=c+1|0;d.sfml[this.memoryHash]=a;d.sfm()}};b.prototype.getSortId=function(){return this.sortPrm[0]};
b.prototype.getAscId=function(){return this.sortPrm[1]};b.prototype.getFilterType=function(){return this.sortPrm[2]};b.prototype.getFilterRare=function(){return this.sortPrm[3]};b.prototype.getFilterEvent=function(){return this.sortPrm[4]};b.prototype.getFilterLock=function(){return this.sortPrm[5]};b.prototype.getDisplaySize=function(){return this.sortPrm[6]};b.prototype.getEffectType=function(){return this.sortPrm[7]};b.prototype.getPrimary=function(){return this.sortPrm[8]};b.prototype.getFilterCompose=
function(){return this.sortPrm[9]};b.prototype.isFilterOn=function(){return null!==this.sortPrm[2]||null!==this.sortPrm[3]||null!==this.sortPrm[5]||null!==this.sortPrm[7]||null!==this.sortPrm[9]};b.prototype.isHideFilterType=function(a){var c=!1;if(null!==this.sortPrm[2]){var b=["REINFORCEMENT","LIMIT_BREAK"],d=this.getFilterType();if(-1<d.indexOf("REINFORCEMENT"))0>b.indexOf(a.piece.pieceKind)&&0>d.indexOf(a.piece.pieceType)&&(c=!0);else if(-1<b.indexOf(a.piece.pieceKind)||0>d.indexOf(a.piece.pieceType))c=
!0}return c};b.prototype.isHideFilterEffect=function(a){var c=!1;if(null!==this.sortPrm[7]){var b=!1;n.each(a.effectType,function(a,c){-1!==this.sortPrm[7].indexOf(a)&&(b=!0)}.bind(this));b||(c=!0)}return c};b.prototype.isHideFilterRank=function(a){var c=!1;null!==this.sortPrm[3]&&0>this.sortPrm[3].indexOf(a.piece.rank)&&(c=!0);return c};b.prototype.isHideFilterLock=function(a){var c=!1;null!==this.sortPrm[5]&&("LOCKED"!==this.sortPrm[5]||a.protect?"UNLOCKED"===this.sortPrm[5]&&a.protect&&(c=!0):
c=!0);return c};b.prototype.isHideFilterCompose=function(a){var c=!1;if(null!==this.sortPrm[9]){var c=!1,b=-1<this.sortPrm[9].indexOf("LV_MAX"),d=-1<this.sortPrm[9].indexOf("LB_MAX"),f=-1<this.sortPrm[9].indexOf("ETC"),g=-1<a.indexOf("lvMax");a=-1<a.indexOf("lbMax");b&&d&&g&&a?c=!0:b&&!d&&g&&!a?c=!0:!b&&d&&!g&&a?c=!0:!f||g||a||(c=!0);c=!c}return c};b.prototype.getSortPrm=function(a){a.filterType=this.sortPrm[2];a.rankFilter=this.sortPrm[3];a.lockFilter=this.sortPrm[5];a.effectFilter=this.sortPrm[7];
a.equipedPrimary=this.sortPrm[8];a.composeFilter=this.sortPrm[9]};return b});