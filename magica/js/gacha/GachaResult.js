define("underscore backbone backboneCommon ajaxControl command cardUtil text!css/gacha/GachaResult.css text!css/gacha/GachaTop.css text!template/gacha/GachaResult.html js/view/gacha/GachaBtnView js/memoria/MemoriaPopup js/card/CardPopup".split(" "),function(k,q,b,r,l,t,w,x,y,u,z,A){var B=q.Model.extend({}),m,p,h,n,C=q.View.extend({events:function(){var a={};a[b.cgti+" #onceMore"]=this.gachaPop;return a},initialize:function(a){this.drawFlg=!1;console.log("initialize",n);console.log(m);a={};a.userGachaGroup=
n.gachaAnimation.userGachaGroup||null;a.pieceCapacity=m.gameUser.cardCapacity;a.hasPieceNum=m.userPieceList.length;a.hasCardNum=m.userCharaList.length;a.playedGachaType=b.playedGachaType;a.playedGacha=h||null;this.model=a;this.template=k.template(y);u.prototype.parentView=this;this.createDom()},render:function(){this.$el.html(this.template({model:this.model}));return this},createDom:function(){b.setGlobalView();b.content.append(this.render().el);this.createView();b.ready.hide()},createView:function(){v.prototype.rootView=
this;new v({model:n,el:b.doc.getElementById("cardWrap")});console.log();if(h&&b.playedGachaPrm){var a;b.doc.createDocumentFragment();var e=b.getTotalStone();k.each(h.gachaKindList,function(f,d){if(b.playedGachaPrm.gachaBeanKind==f.beanKind){d=null;if(f.substituteItemId){var g=b.storage.userItemList.findWhere({itemId:f.substituteItemId});d=g?g.toJSON():null;g&&(d.subItemFlag=!0);d=d&&0<d.quantity?d:!1}if(!d)switch(f.needPointKind){case "PURCHASED_MONEY":d={item:{name:"Paid Magia Stone",shortDescription:"Paid Magia Stone",
itemCode:"PURCHASED_MONEY",unit:""},quantity:e.userMoney,moneyObj:e};break;case "MONEY":d={item:{name:"Magia Stone",shortDescription:"Magia Stone",itemCode:"MONEY",unit:""},quantity:e.totalMoney,moneyObj:e};break;case "YELL":d=(d=b.storage.userItemList.findWhere({itemId:"YELL"}))?d.toJSON():{item:{name:"Support Pts",shortDescription:"Support Pt",itemCode:"YELL",unit:"Pt"},quantity:0};break;case "ITEM":d=(d=b.storage.userItemList.findWhere({itemId:f.itemId}))?d.toJSON():{item:f.item,quantity:0}}f.userUseItem=
d;a=f;console.log("kind",f);new u({model:new B(f),el:b.doc.querySelector("#onceMore")})}});console.log("â˜…",a,a.beanKind,this.model.playedGachaType);a&&"DAILY"!==a.beanKind&&"STARTDASH"!==this.model.playedGachaType&&(b.doc.querySelector("#onceMore").style.display="block")}}}),v=q.View.extend({events:function(){var a={};a[b.cgti+" .cardChild"]=this.detailPopup;return a},initialize:function(b){this.listenTo(this.rootView,"removeView",this.removeView);this.render()},render:function(){var a=this.model.gachaAnimation.gachaResultList,
e=k.template($("#gachaResultParts").text());t.createCardList();var f=[];this.model.userPieceList&&k.each(this.model.userPieceList,function(b,a){a={};a.id=b.id;a.pieceId=b.pieceId;f.push(a)});var d=b.doc.createDocumentFragment(),g;k.each(a,function(a,c){g=b.doc.createElement("div");g.className="cardChild";c={};c.isNew=a.isNew;c.type=a.type;switch(a.type){case "CARD":c.charaId=a.charaId;a.itemId&&(c.itemId=a.itemId,c.item="on");c.attributeId=a.attributeId;c.rarity=a.rarity;c.key="card_"+a.cardId+"_c";
c.src="resource/image_native/card/image/card_"+a.cardId+"_c.png";g.dataset.typeId="card_"+c.charaId;break;case "PIECE":c.item="";c.key="memoria_"+a.pieceId+"_c";c.src="resource/image_native/memoria/memoria_"+a.pieceId+"_c.png";var h=k.findWhere(f,{pieceId:a.pieceId});g.dataset.typeId="memoria_"+h.id;f.splice(k.findIndex(f,h),1);break;case "ITEM":c.item="",c.key=a.itemId.toLowerCase(),c.rarity=a.rarity,c.src="resource/image_native/item/"+a.itemId.toLowerCase()+"_b.png",g.dataset.typeId=a.itemId}a.extraItemId&&
(c.extraItemNum=a.extraItemNum,c.extraItemId=a.extraItemId,c.extraItemType=-1<a.extraItemId.indexOf("GIFT_")?"gift":-1<a.extraItemId.indexOf("EVENT_")?"event":"main");g.innerHTML=e({model:c});d.appendChild(g)});b.doc.getElementById("cardWrap").appendChild(d);1===a.length&&b.addClass(b.doc.getElementById("cardWrap"),"cardOne");b.doc.querySelector("#backLinkBtn").dataset.href="#/GachaTop";h&&(b.doc.querySelector("#backLinkBtn").dataset.href="#/GachaTop/"+h.id);l.getBaseData(b.getNativeObj())},detailPopup:function(a){a.preventDefault();
if(!b.isScrolled()){var e=a.currentTarget.dataset.typeId.split("_");-1<e[0].indexOf("card")?(e=b.storage.userCardListEx.findWhere({charaId:e[1]|0}).toJSON(),A.instantPopup(a,e)):-1<e[0].indexOf("memoria")&&(e=b.storage.userPieceList.findWhere({id:e[1]}).toJSON(),z.instantPopup(a,e))}},removeView:function(){console.log("CardListView remove");this.off();this.remove()}});return{needModelIdObj:[{id:"user"},{id:"gameUser"},{id:"userStatusList"},{id:"userCharaList"},{id:"userCardList"},{id:"userDeckList"},
{id:"userDoppelList"},{id:"userLive2dList"},{id:"userGiftList"},{id:"pieceList"},{id:"giftList"},{id:"userPieceList"},{id:"userPieceSetList"},{id:"itemList"},{id:"userItemList"},{id:"userSectionList"},{id:"userQuestBattleList"},{id:"userDailyChallengeList"},{id:"userTotalChallengeList"},{id:"userLimitedChallengeList"}],fetch:function(a){l.setWebView();if(a)if(b.tutorialId=a,b.tutorialUtil)b.tutorialUtil.tutorialIdRegist(b.tutorialId),b.tutorialUtil.tutorialAddClass(b.tutorialId);else{l.nativeReload("#/TopPage");
return}r.pageModelGet(this.needModelIdObj)},init:function(){m=r.getPageJson();b.setStyle(w+x);t.createCardList();b.gachaResultJson?(console.log("common.gachaDisp",b.gachaDisp),h=k.findWhere(m.gachaScheduleList,{id:b.gachaDisp}),n=b.gachaResultJson,b.gachaResultJson={},p=new C):l.nativeReload("#/TopPage")},startCommand:function(){l.startBgm(b.settingBgm);l.changeBg("web_0017.ExportJson")},remove:function(a){p&&($("#popupArea").off(),p.trigger("removeView"),p.remove());h=n=null;a()}}});