define("underscore backbone backboneCommon ajaxControl text!template/memoria/MemoriaPopup.html memoriaUtil command".split(" "),function(h,p,a,n,q,f,k){var c,l=!1;a.ua.android&&a.doc.addEventListener("touchmove",function(){clearTimeout(a.popupTimerObj)},!0);var m=function(){var g=p.View.extend({className:"memoriaDetailPopInner",events:function(){var b={};b[a.cgti+" #memoriaProtect"]=this.protectHandler;b[a.cgti+" #memoriaPopClose"]=this.removeHandler;b[a.cgti+" .popupCardImage"]=this.cardZoom;return b},
initialize:function(){c.piece.description=c.piece.description.replace(/ï¼ /g,"\x3cbr\x3e");this.model=c;this.model.maxLevel||(this.model.maxLevel=f.getMaxLevel(this.model.piece.rank,this.model.lbCount));this.template=h.template(q);this.createDom()},render:function(){this.$el.html(this.template({model:this.model}));this.el.style.height="100%";this.el.style.width="100%";return this},createDom:function(){h.each(a.doc.querySelector("#baseContainer").children,function(b){a.addClass(b,"hide")});var b=a.doc.createElement("div");
b.id="memoriaDetailWrap";b.appendChild(this.render().el);k.startSe(1002);var d,e;f.getMaxLevel(c.piece.rank,c.lbCount)>c.level?(d=c.experience,e=f.parExArr[c.level]-c.experience||0,d=Math.round(d/f.parExArr[c.level]*100)||0):(e="MAX",d=100);b.getElementsByClassName("exp")[0].style.width=d+"%";b.getElementsByClassName("expNum")[0].textContent=d+"%";b.getElementsByClassName("nextExp")[0].textContent=e;a.doc.getElementById("baseContainer").appendChild(b);k.getBaseData(a.getNativeObj());a.scrollSet("memoriaPopScroll",
"infoWrap");a.disableLink=!1},protectHandler:function(b){b.preventDefault();if(!a.isScrolled()&&!l&&!c.lockFlg)if(c.unprotectLimitFlag)new a.PopupClass({title:"By Unlock Memoria",content:"You can not Unlock this Memoria during the course of this Event.",closeBtnText:"OK",popupType:"typeC"});else{l=!0;var d=b.currentTarget,e=this,g=function(b){"error"!==b.resultCode&&(b.userPieceList[0].equipFlag=e.model.equipFlag,b.userPieceList[0].equipDeck=e.model.equipDeck,b.userPieceList[0].eventDescription=e.model.eventDescription,
b.userPieceList[0].eventEffect=e.model.eventEffect,b.userPieceList[0].equipRemoveFlag=e.model.equipRemoveFlag,console.log(a.location),"PieceArchive"===a.location&&(e.model.archive&&(b.userPieceList[0].archive=e.model.archive),e.model.selectFlg&&(b.userPieceList[0].selectFlg=e.model.selectFlg)),a.responseSetStorage(b),d.classList.contains("protected")?d.textContent="Lock":d.textContent="Locked",d.classList.toggle("protected"));l=!1},f={userPieceId:c.id};b.currentTarget.classList.contains("protected")?
n.ajaxPost(a.linkList.userPieceUnprotect,f,g):n.ajaxPost(a.linkList.userPieceProtect,f,g)}},cardZoom:function(b){b.preventDefault();a.isScrolled()||b.currentTarget.classList.toggle("zoom")},removeHandler:function(){a.androidKeyStop=!1;a.disableLink=!1;h.each(a.doc.querySelector("#baseContainer").children,function(b){a.removeClass(b,"hide")});this.model.closeEvent&&this.model.closeEvent();a.doc.getElementById("memoriaDetailWrap")&&a.doc.getElementById("baseContainer").removeChild(a.doc.getElementById("memoriaDetailWrap"));
a.detailPopup&&(a.detailPopup.remove(),a.detailPopup=null)}});a.detailPopup=new g};return{cardDetailPopup:function(g,b,d){clearTimeout(a.popupTimerObj);a.disableLink=!0;a.popupTimerObj=setTimeout(function(){a.isScrolled()?a.disableLink=!1:(a.doc.querySelector("#sideMenu")&&(a.removeClass(a.doc.querySelector("#sideMenu"),"close"),a.removeClass(a.doc.querySelector("#sideMenu"),"anim")),g.preventDefault(),g.stopPropagation(),c=b,d&&k.endL2d(),m())},500)},popupTimerStop:function(c){a.disableLink=!1;clearTimeout(a.popupTimerObj)},
instantPopup:function(g,b){clearTimeout(a.popupTimerObj);c=b;m()},maxParamPopup:function(a,b,d,e,h){c=b;c.level=f.getMaxLevel(b.piece.rank,4);c.maxLevel=c.level;c.lbCount=4;c.experience=0;b=f.getParam(b,c.level);c.attack=b.attack;c.defense=b.defense;c.hp=b.hp;d&&(c.lockFlg=!0);e?this.cardDetailPopup(a,c,h):m()}}});