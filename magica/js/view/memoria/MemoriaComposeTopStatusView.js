define(["underscore","backbone","backboneCommon","ajaxControl","memoriaUtil"],function(l,n,d,p,f){return n.View.extend({initialize:function(){this.listenTo(this.rootView,"remove",this.removeView);this.listenTo(this.model,"change",this.modelChange);this.template=l.template($("#StatusParts").text());this.beforeStatus=$("#beforeStatus");this.afterStatus=$("#afterStatus")},modelChange:function(){l.isEmpty(this.model.toJSON())?(this.beforeStatus.empty(),this.afterStatus.empty()):(this.beforeStatusUpdate(),
0<this.rootView.useMaterialView.selectMaterial.length&&this.afterStatusUpdate())},beforeStatusUpdate:function(){var a=this.model.toJSON(),c=a.level,e=a.maxLevel>c?f.parExArr[c]-a.experience:"MAX",a=f.getGuageLength(a.experience,c);this.beforeStatusRender(e,a)},afterStatusUpdate:function(){var a=this.model.toJSON(),c=a.piece.rank,e=a.level,d=4<a.lbCount?4:a.lbCount,h=a.maxLevel,b=this.rootView.useMaterialView.selectMaterial;if(0===b.length)this.afterStatus.empty();else{var k=0;if(4>d){for(var g=0,
m=b.length;g<m;g++)a.pieceId!==b[g].pieceId&&"LIMIT_BREAK"!==b[g].piece.pieceKind||k++;0<k&&4<d+k&&(k=4-d)}g=a.experience;b=f.getComposeExp(c,e,b,a)|0;b=g+b;0<k&&(h=f.getMaxLevel(c,d+k));c=b+f.exArr[a.level-1];g=0;for(m=!0;m;)c>=f.exArr[a.level+g]?g++:m=!1;a=0;e+=g;h>e?(a=c-f.exArr[e-1],c=f.parExArr[e]-a):(e=h,c="MAX");this.afterStatusRender(e,h,a,c,d+k,b)}},beforeStatusRender:function(a,c){this.beforeStatus.html(this.template({model:this.model.toJSON()}));var e=d.doc.getElementById("beforeStatus");
e.getElementsByClassName("nextExp")[0].textContent=a;a=Math.floor(c/100*174);a=174<a?174:a;e.getElementsByClassName("exp")[0].style.width=a+"px";a=this.model.toJSON();e.getElementsByClassName("statusHP")[0].textContent=a.hp;e.getElementsByClassName("statusATK")[0].textContent=a.attack;e.getElementsByClassName("statusDEF")[0].textContent=a.defense},afterStatusRender:function(a,c,e,l,h){this.afterStatus.html(this.template({model:this.model.toJSON(),after:!0}));var b=d.doc.getElementById("afterStatus");
b.getElementsByClassName("lv")[0].textContent=a;b.getElementsByClassName("maxLv")[0].textContent=c;h>this.model.toJSON().lbCount&&d.addClass(b.getElementsByClassName("maxLv")[0],"c_red");0<h&&(b.getElementsByClassName("lbCount_3")[0].className="lbCount_3 thisLb"+h);b.getElementsByClassName("nextExp")[0].textContent=l;c=Math.floor(174*(f.getGuageLength(e,a)/100));c=174<c?174:c;b.getElementsByClassName("exp")[0].style.width=c+"px";c=f.getParam(this.model.toJSON(),a);a===this.model.toJSON().level&&(c.hp=
this.model.toJSON().hp,c.attack=this.model.toJSON().attack,c.defense=this.model.toJSON().defense);b.getElementsByClassName("statusHP")[0].textContent=c.hp;b.getElementsByClassName("statusATK")[0].textContent=c.attack;b.getElementsByClassName("statusDEF")[0].textContent=c.defense;(this.model.get("level")|0)<a?(d.addClass(b.getElementsByClassName("statusLvupIcon")[0],"show"),d.addClass(b.getElementsByClassName("lv")[0],"c_red"),d.addClass(b.getElementsByClassName("statusHP")[0],"c_red"),d.addClass(b.getElementsByClassName("statusATK")[0],
"c_red"),d.addClass(b.getElementsByClassName("statusDEF")[0],"c_red")):(d.removeClass(b.getElementsByClassName("statusLvupIcon")[0],"show"),d.removeClass(b.getElementsByClassName("lv")[0],"c_red"),d.removeClass(b.getElementsByClassName("statusHP")[0],"c_red"),d.removeClass(b.getElementsByClassName("statusATK")[0],"c_red"),d.removeClass(b.getElementsByClassName("statusDEF")[0],"c_red"))},removeView:function(){this.off();this.remove()}})});