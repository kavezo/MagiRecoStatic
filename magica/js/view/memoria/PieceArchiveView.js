define("underscore backbone backboneCommon ajaxControl text!template/memoria/PieceArchive.html js/view/memoria/PieceArchivePartsView js/view/memoria/MemoriaEquipInfoView cardUtil memoriaSortUtil memoriaUtil command".split(" "),function(f,g,a,h,x,m,r,t,y,n,k){var l="rank level hp atk def lb get".split(" "),u={rank:"Rarity",level:"Level",hp:"HP",atk:"ATK",def:"DEF",lb:"Ascension",get:"Date"},z=g.Model.extend(),e;r=g.View.extend({events:function(){var b={};b[a.cgti+" #ascPanelMemoria li"]=this.ascStartMemoria;
b[a.cgti+" #sortBtn"]=this.sortStart;b[a.cgti+" #sortPopupMemoria"]=this.sortPopMemoria;b[a.cgti+" #eventFilterBtn"]=this.eventFilterBtn;b[a.cgti+" #sizeChange"]=this.sizeChange;b[a.cgti+" #selectResetBtn"]=this.archiveAfterFunc;b[a.cgti+" .modeToggle"]=this.toggleMode;b[a.cgti+" #archiveBtn"]=this.archiveBtn;return b},initialize:function(b){this.template=f.template(x);this.listenTo(this,"remove",this.removeView);this.listenTo(a.storage.userPieceList,"change",this.memoriaChangeCheck);this.equipInfo=
b.equipInfo;this.mode=b.mode;this.memoriaSort=e=new y("UserMemoriaList_archive",this);this.mode="normal";this.hasChange=!1;this.userLimitArchive=this.userLimitHands=this.selectCount=this.archiveMemoriaCount=this.normalMemoriaCount=0;a.setGlobalView();this.createDom()},render:function(){this.$el.html(this.template(h.getPageJson()));return this},createDom:function(){a.content.append(this.render().el);this.growViewSet();this.createView()},growViewSet:function(){v.prototype.rootView=this;new v;w.prototype.rootView=
this;new w},createView:function(){this.memoriaUtil=n;this.memoriaPartsTemplate=f.template($("#MemoriaListParts").text());p.prototype.rootView=this;q.prototype.rootView=this;m.prototype.rootView=this;var b=h.getPageJson();this.orderSet();e.isFilterOn()?a.doc.getElementById("sortPopupMemoria").className="se_tabs sb_gold_02 TE on":a.doc.getElementById("sortPopupMemoria").className="se_tabs sb_gold_02 TE off";a.doc.querySelector("#sortBtn").innerHTML="\x3cspan class\x3d'b_screen'\x3e\x3c/span\x3e"+u[e.getSortId()];
a.addClass(a.doc.getElementById("memoriaWrapInner"),e.getSortId());this.archiveCollection=b.userPieceArchiveList;this.firstCollectionSort();this.firstArchiveCollectionSort();this.normalListView=new p;a.doc.getElementById("memoriaWrapInner").appendChild(this.normalListView.el);this.archiveListView=new q;k.getBaseData(a.getNativeObj());a.scrollSet("scrollSet","scrollInner");e.sortPrm[4]?a.addClass(a.doc.getElementById("memoriaWrap"),"onlyEvent"):a.removeClass(a.doc.getElementById("memoriaWrap"),"onlyEvent");
null!==e.sortPrm[4]&&a.addClass(a.doc.getElementById("eventFilterBtn"),"on");var b=a.doc.getElementById("memoriaWrap"),c=a.doc.getElementById("sizeChange");switch(e.getDisplaySize()){case .8:a.addClass(b,"smaller");c.dataset.size="smallest";a.addClass(c,"smaller");break;case .7:a.removeClass(b,"smaller");a.addClass(b,"smallest");c.dataset.size="normal";a.removeClass(c,"smaller");a.addClass(c,"smallest");break;default:a.removeClass(b,"smallest"),c.dataset.size="smaller",a.removeClass(c,"smallest")}this.userLimitHands=
a.storage.gameUser.toJSON().cardCapacity-a.storage.userPieceList.length;this.userLimitArchive=400-this.archiveCollection.length;this.archiveMemoriaCount=this.archiveCollection.length;a.doc.getElementById("nowCount").textContent=this.archiveMemoriaCount;a.doc.getElementById("limitCount").textContent=400;1>this.userLimitArchive&&a.addClass(a.doc.getElementById("memoriaWrap"),"reachLimit");"lv"!==e.getSortId()&&"rank"!==e.getSortId()&&"lb"!==e.getSortId()&&this.trigger("dispChange",e.getSortId())},firstCollectionSort:function(){var b=
{RANK_1:0,RANK_2:1,RANK_3:2,RANK_4:3,RANK_5:4},c="asc"===e.sortPrm[1]?1:-1;a.storage.userPieceList.comparator=function(a,d){if(e.sortPrm[4]&&(a.get("eventEffect")||d.get("eventEffect"))){if(a.get("eventEffect")&&!d.get("eventEffect"))return-1;if(!a.get("eventEffect")&&d.get("eventEffect"))return 1}if("rank"==e.sortPrm[0]){if(b[d.get("piece").rank]<b[a.get("piece").rank])return-1*c;if(b[d.get("piece").rank]>b[a.get("piece").rank])return 1*c}else if("level"==e.sortPrm[0]){if(d.get("level")<a.get("level"))return-1*
c;if(d.get("level")>a.get("level"))return 1*c}else if("atk"==e.sortPrm[0]){if(d.get("attack")<a.get("attack"))return-1*c;if(d.get("attack")>a.get("attack"))return 1*c}else if("def"==e.sortPrm[0]){if(d.get("defense")<a.get("defense"))return-1*c;if(d.get("defense")>a.get("defense"))return 1*c}else if("hp"==e.sortPrm[0]){if(d.get("hp")<a.get("hp"))return-1*c;if(d.get("hp")>a.get("hp"))return 1*c}else if("lb"==e.sortPrm[0]){if(d.get("lbCount")<a.get("lbCount"))return-1*c;if(d.get("lbCount")>a.get("lbCount"))return 1*
c}if("get"!==e.sortPrm[0]){if(d.get("pieceId")<a.get("pieceId"))return-1*c;if(d.get("pieceId")>a.get("pieceId"))return 1*c}return Date.parse(d.get("createdAt"))<Date.parse(a.get("createdAt"))?-1*c:Date.parse(d.get("createdAt"))>Date.parse(a.get("createdAt"))?1*c:0};a.storage.userPieceList.sort()},firstArchiveCollectionSort:function(){var b={RANK_1:0,RANK_2:1,RANK_3:2,RANK_4:3,RANK_5:4},c="asc"===e.sortPrm[1]?1:-1;this.archiveCollection.comparator=function(a,d){if(e.sortPrm[4]&&(a.get("eventEffect")||
d.get("eventEffect"))){if(a.get("eventEffect")&&!d.get("eventEffect"))return-1;if(!a.get("eventEffect")&&d.get("eventEffect"))return 1}if("rank"==e.sortPrm[0]){if(b[d.get("piece").rank]<b[a.get("piece").rank])return-1*c;if(b[d.get("piece").rank]>b[a.get("piece").rank])return 1*c}else if("level"==e.sortPrm[0]){if(d.get("level")<a.get("level"))return-1*c;if(d.get("level")>a.get("level"))return 1*c}else if("atk"==e.sortPrm[0]){if(d.get("attack")<a.get("attack"))return-1*c;if(d.get("attack")>a.get("attack"))return 1*
c}else if("def"==e.sortPrm[0]){if(d.get("defense")<a.get("defense"))return-1*c;if(d.get("defense")>a.get("defense"))return 1*c}else if("hp"==e.sortPrm[0]){if(d.get("hp")<a.get("hp"))return-1*c;if(d.get("hp")>a.get("hp"))return 1*c}else if("lb"==e.sortPrm[0]){if(d.get("lbCount")<a.get("lbCount"))return-1*c;if(d.get("lbCount")>a.get("lbCount"))return 1*c}if("get"!==e.sortPrm[0]){if(d.get("pieceId")<a.get("pieceId"))return-1*c;if(d.get("pieceId")>a.get("pieceId"))return 1*c}if(Date.parse(d.get("createdAt"))<
Date.parse(a.get("createdAt")))return-1*c;if(Date.parse(d.get("createdAt"))>Date.parse(a.get("createdAt")))return 1*c;if("get"===e.sortPrm[0]){if(d.get("pieceId")<a.get("pieceId"))return-1*c;if(d.get("pieceId")>a.get("pieceId"))return 1*c}return 0};a.storage.userPieceList.sort()},ascStartMemoria:function(b){b.preventDefault();a.isScrolled()||(e.ascSort(b.currentTarget.dataset.ascid),this.orderSet())},orderSet:function(){"asc"===e.getAscId()?(a.addClass(a.doc.getElementById("ascMemoria"),"none"),a.removeClass(a.doc.getElementById("descMemoria"),
"none")):(a.addClass(a.doc.getElementById("descMemoria"),"none"),a.removeClass(a.doc.getElementById("ascMemoria"),"none"))},eventFilterBtn:function(b){b.preventDefault();a.isScrolled()||(b.currentTarget.classList.toggle("on"),e.sortPrm[4]=null!==e.sortPrm[4]?null:"on",a.sfml.UserMemoriaList_card=e.sortPrm,a.sfm(),e.multiSort(e.sortPrm),e.sortPrm[4]?a.addClass(a.doc.getElementById("memoriaWrap"),"onlyEvent"):a.removeClass(a.doc.getElementById("memoriaWrap"),"onlyEvent"),a.scrollRefresh())},sortPopMemoria:function(b){b.preventDefault();
a.isScrolled()||e.sortPopupOpen(b)},sortStart:function(b){b.preventDefault();if(!a.isScrolled()){var c=l.indexOf(e.getSortId());a.removeClass(a.doc.getElementById("memoriaWrapInner"),e.getSortId());c=c+1>=l.length?0:c+1;e.sortPrm[0]=l[c];this.sortBtn=!0;e.multiSort(e.sortPrm);b.currentTarget.innerHTML="\x3cspan class\x3d'b_screen'\x3e\x3c/span\x3e"+u[l[c]];a.addClass(a.doc.getElementById("memoriaWrapInner"),e.getSortId());this.orderSet();"lv"!=e.getSortId()&&"rank"!=e.getSortId()&&"lb"!=e.getSortId()&&
this.trigger("dispChange",e.getSortId())}},afterFilterFunc:function(){this.sortBtn?this.sortBtn=!1:(this.trigger("afterFilter"),e.isFilterOn()?a.doc.getElementById("sortPopupMemoria").className="se_tabs sb_gold_02 TE on":a.doc.getElementById("sortPopupMemoria").className="se_tabs sb_gold_02 TE off",a.scrollRefresh("scrollSet","scrollInner"))},sizeChange:function(b){b.preventDefault();if(!a.isScrolled()){var c=a.doc.getElementById("memoriaWrap");switch(b.currentTarget.dataset.size){case "smaller":a.addClass(c,
"smaller");b.currentTarget.dataset.size="smallest";a.addClass(b.currentTarget,"smaller");b=.8;break;case "smallest":a.removeClass(c,"smaller");a.addClass(c,"smallest");b.currentTarget.dataset.size="normal";a.removeClass(b.currentTarget,"smaller");a.addClass(b.currentTarget,"smallest");b=.7;break;default:a.removeClass(c,"smallest"),b.currentTarget.dataset.size="smaller",a.removeClass(b.currentTarget,"smallest"),b=1}e.sortPrm[6]=b;e.saveMemory();a.scrollRefresh()}},toggleMode:function(b){b.preventDefault();
a.isScrolled()||(a.tapBlock(!0),a.doc.getElementById("memoriaWrapInner").innerHTML="","normal"===this.mode?(this.mode="archive",this.hasChange&&(this.archiveMemoriaCount=0,this.archiveListView.removeView(),this.archiveListView=new q),a.doc.getElementById("memoriaWrapInner").appendChild(this.archiveListView.el),a.doc.getElementById("info_memoriaCount").textContent=this.archiveMemoriaCount,a.doc.getElementById("info_memoriaCapacity").textContent=400,a.doc.getElementById("limitCount").textContent=400,
a.doc.getElementById("nowCount").nowCount=this.archiveMemoriaCount,a.doc.getElementById("safeTitle").textContent="Stock",a.doc.getElementById("memoriaInfoWrap").textContent="Select which Memoria you'd like to move to your inventory.",a.addClass(a.doc.getElementById("toArchive"),"gray"),a.removeClass(a.doc.getElementById("toHand"),"gray"),a.addClass(a.doc.getElementById("UserMemoriaList"),"toHand"),a.addClass(a.doc.getElementById("memoriaListInfo").getElementsByClassName("hasMemoriaNum")[0],"toHand")):
(this.mode="normal",this.hasChange&&(this.normalMemoriaCount=0,this.normalListView.removeView(),this.normalListView=new p),a.doc.getElementById("memoriaWrapInner").appendChild(this.normalListView.el),a.doc.getElementById("info_memoriaCount").textContent=this.normalMemoriaCount,a.doc.getElementById("info_memoriaCapacity").textContent=a.storage.gameUser.toJSON().cardCapacity,a.doc.getElementById("limitCount").textContent=a.storage.gameUser.toJSON().cardCapacity,a.doc.getElementById("nowCount").nowCount=
this.normalMemoriaCount,a.doc.getElementById("safeTitle").textContent="Vault",a.doc.getElementById("memoriaInfoWrap").textContent="Select which Memoria you'd like to move to the Vault.",a.removeClass(a.doc.getElementById("toArchive"),"gray"),a.addClass(a.doc.getElementById("toHand"),"gray"),a.removeClass(a.doc.getElementById("UserMemoriaList"),"toHand"),a.removeClass(a.doc.getElementById("memoriaListInfo").getElementsByClassName("hasMemoriaNum")[0],"toHand")),this.hasChange=!1,e.firstSort(),this.trigger("allUnselect"),
this.selectCount=0,this.archiveAfterFunc(b),k.getBaseData(a.getNativeObj()),a.scrollRefresh(),a.tapBlock(!1))},countChange:function(){var b="normal"===this.mode?this.archiveMemoriaCount:a.storage.userPieceList.length;a.doc.getElementById("nowCount").textContent=0<this.selectCount?b+this.selectCount:b},archiveBtn:function(b){b.preventDefault();if(!a.isScrolled()){var c=this;"normal"===this.mode?new a.PopupClass({title:"Memoria Vault",content:"Store selected Memoria to the \x3cspan class\x3d'c_red'\x3eVault\x3c/span\x3e?",
decideBtnText:"OK",decideBtnEvent:function(){c.sendArchive()},closeBtnText:"Cancel",popupType:"typeC",exClass:"pieceArchivePop"}):new a.PopupClass({title:"Memoria Vault",content:"Move selected Memoria to your \x3cspan class\x3d'c_red'\x3einventory?\x3c/span\x3e",decideBtnText:"OK",decideBtnEvent:function(){c.reciveArchive()},closeBtnText:"Cancel",popupType:"typeC",exClass:"pieceArchivePop"})}},sendArchive:function(){a.selectMemoria=[];this.trigger("selectAddArr","normal");if(!(1>a.selectMemoria.length)){var b=
this,c={};c.archiveUserPieceIdList=a.selectMemoria;h.ajaxPost(a.linkList.userPieceArchive,c,function(c){"error"!==c.resultCode&&(f.each(c.userPieceList,function(c){var d=a.storage.userPieceList.findWhere({id:c.id});a.storage.userPieceList.remove(d,{silent:!0});b.archiveCollection.push(c)}),b.trigger("removeCheck","normal"),b.normalMemoriaCount=b.normalMemoriaCount-c.userPieceList.length|0,b.archiveMemoriaCount=b.archiveMemoriaCount+c.userPieceList.length|0,b.archiveAfterFunc(),new a.PopupClass({title:"Memoria Vault",
content:"The Memoria have been moved to the \x3cspan class\x3d'c_red'\x3eVault.\x3c/span\x3e",closeBtnText:"OK",popupType:"typeC",exClass:"pieceArchivePop"}))})}},reciveArchive:function(){a.selectMemoria=[];this.trigger("selectAddArr","archive");if(!(1>a.selectMemoria.length)){var b=this,c={};c.archiveUserPieceIdList=a.selectMemoria;h.ajaxPost(a.linkList.userPieceUnArchive,c,function(c){"error"!==c.resultCode&&(a.responseSetStorage(c),f.each(c.userPieceList,function(a){b.archiveCollection=f.reject(b.archiveCollection,
function(b){return b.id===a.id})}),b.trigger("removeCheck","archive"),b.normalMemoriaCount=b.normalMemoriaCount+c.userPieceList.length|0,b.archiveMemoriaCount=b.archiveMemoriaCount-c.userPieceList.length|0,b.archiveAfterFunc(),new a.PopupClass({title:"Memoria Vault",content:"The Memoria have been moved to your \x3cspan class\x3d'c_red'\x3einventory.\x3c/span\x3e",closeBtnText:"OK",popupType:"typeC",exClass:"pieceArchivePop"}))})}},archiveAfterFunc:function(b){if(b){b.preventDefault();if(a.isScrolled())return;
this.trigger("allUnselect")}else this.hasChange=!0;this.selectCount=0;a.selectMemoria=null;this.countChange();b=a.storage.gameUser.toJSON().cardCapacity;this.userLimitHands=b-a.storage.userPieceList.toJSON().length;this.userLimitArchive=400-this.archiveCollection.length;a.doc.getElementById("limitCount").textContent="normal"===this.mode?400:b;a.doc.getElementById("info_memoriaCount").textContent="normal"===this.mode?a.storage.userPieceList.toJSON().length:this.archiveCollection.length;0<("normal"===
this.mode?this.userLimitArchive:this.userLimitHands)?a.removeClass(a.doc.getElementById("memoriaWrap"),"reachLimit"):a.addClass(a.doc.getElementById("memoriaWrap"),"reachLimit");a.addClass(a.doc.getElementById("archiveBtn"),"off");a.scrollRefresh()},memoriaChangeCheck:function(){"archive"===this.mode&&this.trigger("archiveChangeCheck")},removeView:function(){this.trigger("removeView");a.doc.getElementById("memoriaSaleCurtain")&&a.doc.getElementById("baseContainer").removeChild(a.doc.getElementById("memoriaSaleCurtain"));
a.doc.getElementById("memoriaSaleGlowWrap")&&a.doc.getElementById("baseContainer").removeChild(a.doc.getElementById("memoriaSaleGlowWrap"));this.off();this.remove()}});var p=g.View.extend({tagName:"div",id:"memoriaWrapInner",className:"scrollInner",initialize:function(){this.listenTo(this.rootView,"removeView",this.removeView);this.createList()},render:function(){return this},createList:function(){var b=this,c=a.doc.createDocumentFragment();a.storage.userPieceList.each(function(a,d){(d=t.memoriaEventCheck(a.toJSON()))&&
a.set(d);d=a.toJSON();d.selectFlg&&a.unset("selectFlg");a.set("maxLevel",n.getMaxLevel(d.piece.rank,d.lbCount));a=new m({model:a,mode:"normal"});c.appendChild(a.render().el);b.rootView.normalMemoriaCount++});"normal"===this.rootView.mode&&(a.doc.getElementById("info_memoriaCount").textContent=this.rootView.normalMemoriaCount);this.el.appendChild(c);c=null;a.scrollRefresh("scrollSet","scrollInner");k.getBaseData(a.getNativeObj());a.ready.hide()},removeView:function(){this.trigger("removeView");this.off();
this.remove()}}),q=g.View.extend({tagName:"div",id:"memoriaWrapInner",className:"scrollInner",initialize:function(){this.listenTo(this.rootView,"removeView",this.removeView);this.createList()},render:function(){return this},createList:function(){var b=this,c=a.doc.createDocumentFragment();f.each(this.rootView.archiveCollection,function(a,d){(d=t.memoriaEventCheck(a))&&(a=d);a=new z(a);d=a.toJSON();d.selectFlg&&a.unset("selectFlg");a.set("maxLevel",n.getMaxLevel(d.piece.rank,d.lbCount));a=new m({model:a,
mode:"archive"});c.appendChild(a.render().el);b.rootView.archiveMemoriaCount++});"archive"===this.rootView.mode&&(a.doc.getElementById("info_memoriaCount").textContent=this.rootView.archiveMemoriaCount);this.el.appendChild(c);c=null;a.scrollRefresh("scrollSet","scrollInner");k.getBaseData(a.getNativeObj());a.ready.hide()},removeView:function(){this.trigger("removeView");this.off();this.remove()}}),w=g.View.extend({id:"memoriaSaleGlowWrap",initialize:function(){this.listenTo(this.rootView,"removeView",
this.removeView);this.template=f.template($("#saleGlow").text());this.createDom()},render:function(){this.$el.html(this.template({gameUser:a.storage.gameUser.toJSON()}));return this},createDom:function(){a.doc.getElementById("baseContainer").appendChild(this.render().el);"sell"===this.rootView.mode&&a.addClass(this.el,"sale")},removeView:function(){this.off();this.remove()}}),v=g.View.extend({id:"memoriaSaleCurtain",initialize:function(){this.listenTo(this.rootView,"removeView",this.removeView);this.createDom()},
render:function(){this.$el.html();return this},createDom:function(){a.doc.getElementById("baseContainer").appendChild(this.render().el)},removeView:function(){this.off();this.remove()}});return r});