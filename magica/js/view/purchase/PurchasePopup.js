define("underscore backbone backboneCommon ajaxControl command text!template/purchase/PurchasePop.html text!template/etc/LawPopup.html js/view/purchase/PurchasePopupPartView".split(" "),function(g,q,a,e,h,r,t,k){var u=e.getPageJson(),f=!1,p,m=q.View.extend({events:function(){var d={};d[a.cgti+" .changeCurrencyBtn"]=this.changeCurrencyBtn;return d},initialize:function(a,b){this.model=(window.isLocal?JSON.parse(a):a).userCommonMoneyList;b&&(this.nativeFlag=!0);this.template=g.template(r);this.createDom()},
render:function(){this.$el.html(this.template({model:this.model,money:a.getTotalStone()}));return this},createDom:function(){p=this;var d=this;new a.PopupClass({title:"Purchase Magia Stones",content:"",popupType:"typeB",exClass:"purchasePop"},null,null,function(){d.nativeFlag&&h.setWebView(!1);d.removeView()});a.doc.getElementById("popupArea").getElementsByClassName("popupTextArea")[0].appendChild(this.render().el);k.prototype.parentView=this;k.prototype.template=g.template($("#purchaseParts").text());
var b=a.doc.createDocumentFragment(),l=e.getPageJson().currentTime.substr(0,10);g.each(this.model,function(a,d){"DAILY"===a.commonMoney.commonMoneyType&&a.purchasedAt&&a.purchasedAt.substr(0,10)===l||(a=new k(a,f),b.appendChild(a.render().el))});a.doc.getElementById("PurchaseListWrap").appendChild(b);f?(a.removeClass(a.doc.getElementById("changeCurrencyBtn"),"usd"),a.addClass(a.doc.getElementById("changeCurrencyBtn"),"cad")):(a.addClass(a.doc.getElementById("changeCurrencyBtn"),"usd"),a.removeClass(a.doc.getElementById("changeCurrencyBtn"),
"cad"));a.scrollSetX("purchaseScrollX","purchaseScrollInner");$("#changeCurrencyBtn").click(function(){p.changeCurrencyBtn()})},changeCurrencyBtn:function(a){f=!0===f?!1:!0;this.createDom()},lawPopup:function(d){d.preventDefault();if(!a.isScrolled()){var b=this;new a.PopupClass({title:"About the Specified Commercial Transactions/Payment Services Acts",content:t,popupType:"typeB"},null,null,function(){b.nativeFlag?e.ajaxSimpleGet(a.linkList.moneyShopList,"",function(a){b.removeView();new m(a,!0)}):
b.parentView.moneyPopup()});a.doc.getElementById("rulesBase").getElementsByClassName("ruleDisp")[0].addEventListener(a.cgti,function(d){d.preventDefault();a.isScrolled()||d.currentTarget.classList.contains("current")||(a.doc.getElementById("rulesBase").className="rule",a.scrollRefresh(),a.removeClass(a.doc.getElementById("rulesBase").getElementsByClassName("thirteenDisp")[0],"current"),a.addClass(d.currentTarget,"current"))});a.doc.getElementById("rulesBase").getElementsByClassName("thirteenDisp")[0].addEventListener(a.cgti,
function(d){d.preventDefault();a.isScrolled()||d.currentTarget.classList.contains("current")||(a.doc.getElementById("rulesBase").className="thirteen",a.scrollRefresh(),a.removeClass(a.doc.getElementById("rulesBase").getElementsByClassName("ruleDisp")[0],"current"),a.addClass(d.currentTarget,"current"))});a.scrollSet("rulesBase","rulesPop")}},checkBirthDay:function(){var d=this;require(["text!template/purchase/PurchaseTemps.html?bust\x3d"+(new Date).getTime],function(b){b=g.template(b);var l=a.doc.createElement("div");
l.innerHTML=b({platform:a.thisPlatform});var f=function(){e.ajaxSimpleGet(a.linkList.moneyShopList,"",function(a){d.nativeFlag?new m(a,!0):new m(a)})},k=function(b){b.preventDefault();a.isScrolled()||(a.tapBlock(!0),b={year:a.doc.getElementById("year").value,month:a.doc.getElementById("day").value},e.ajaxPost(a.linkList.inputBirthDay,b,function(b){var c=function(){a.tapBlock(!0);if(a.purchaseSaving){var b=function(b){!b||b&&!b.message?(a.tapBlock(!1),d.nativeFlag&&setTimeout(function(){h.setWebView(!1)},
1E3),d.removeView()):(new a.PopupClass({content:b.message,closeBtnText:"OK",exClass:"purchaseError",popupType:"typeC"},null,null,function(){d.nativeFlag&&setTimeout(function(){h.setWebView(!1)},1E3);d.removeView()}),a.tapBlock(!1))},c=a.storage.user.toJSON(),n=c.monthlyPurchase|0,f=c.birthDay.split("/"),g=e.getPageJson().currentTime.split(" ")[0].split("/"),c=Number(g[0]-f[0]);Number(f[1])>Number(g[1])&&c--;if(20>c&&(n+=a.purchaseSaving.commonMoney.coin,16>c&&5E3<n||3E4<n)){new a.PopupClass({content:"You cannot complete this transaction due to your monthly purchase limit.",
closeBtnText:"OK",exClass:"purchaseError",popupType:"typeC"},null,null,b);a.tapBlock(!1);return}a.addClass(a.doc.getElementById("curtain"),"show");$("#commandDiv").on("purchaseCallback",function(d,c){$("#commandDiv").off("purchaseCallback");"error"!==c.resultCode?(c&&c.fox&&h.setFoxData(c.fox),c&&c.adjust&&h.setAdjustData(c.adjust),a.responseSetStorage(c),a.globalMenuView&&a.globalMenuView.itemChangeHandler(),a.removeClass(a.doc.getElementById("curtain"),"show"),b(c)):(a.tapBlock(!1),a.removeClass(a.doc.getElementById("curtain"),
"show"),new a.PopupClass({content:c.errorTxt,closeBtnText:"OK",exClass:"purchaseError",popupType:"typeC"},null,null,b))});h.purchaseItem(a.purchaseSaving);a.purchaseSaving=null;window.isBrowser&&(a.doc.getElementById("tapBlock").style.block="",a.removeClass(a.doc.getElementById("curtain"),"show"),b())}};"error"!==b.resultCode&&(a.responseSetStorage(b),a.tapBlock(!1),new a.PopupClass({title:"Age Verification",content:"Thank you very much.\x3cbr\x3eYour age has been verified.\x3cbr\x3ePlease enjoy more of what we have to offer.",
closeBtnText:"OK",exClass:"purchasePop"},null,null,c))}))};b=g.template(l.getElementsByClassName("birthCheckFirst")[0].innerText);new a.PopupClass({title:"Age Verification Required",content:b(),exClass:"purchasePop"},null,null,f);a.doc.getElementById("birthCheck").addEventListener(a.cgti,function(b){b.preventDefault();if(!a.isScrolled()){b=g.template(l.getElementsByClassName("birthInputs")[0].innerText);new a.PopupClass({title:"Age Verification",content:b(),exClass:"purchasePop"},null,null,f);a.doc.getElementById("birthDecide").addEventListener(a.cgti,
k);b=u.currentTime.substr(0,4)|0;for(var c=b-100,d=a.doc.createDocumentFragment();c<b;){var e=a.doc.createElement("option");e.value=c;e.innerHTML=c;1995===c&&(e.selected="selected");d.appendChild(e);c=c+1|0}a.doc.getElementById("year").appendChild(d);b=a.doc.createDocumentFragment();for(c=1;13>c;c++)d=a.doc.createElement("option"),d.value=c,d.innerHTML=c,b.appendChild(d);a.doc.getElementById("day").appendChild(b)}})})},removeView:function(){a.purchaseSaving=null;this.trigger("removeChild");this.off();
a.g_popup_instance&&a.g_popup_instance.popupView.close();this.remove()}});return m});