define("underscore backbone backboneCommon ajaxControl text!template/quest/SubQuest.html js/view/quest/QuestChapterListPartsView text!template/quest/OutlinePopup.html command QuestUtil js/view/quest/ClearAnimationsView iscroll_stage".split(" "),function(e,t,b,l,u,g,v,h,k,m){var n={2001:[2001,2002,2004,2005,2006],2002:[2002,2004,2005,2006,2001],2004:[2004,2005,2006,2001,2002],2005:[2005,2006,2001,2002,2004],2006:[2006,2001,2002,2004,2005]},c;return t.View.extend({events:function(){var a={};a[b.cgti+
" .mapDebugBtn"]=this.debugMapIcon;return a},initialize:function(a){this.listenTo(this,"removeView",this.removeView);this.template=e.template(u);this.createView()},render:function(){this.$el.html(this.template(l.getPageJson()));return this},createView:function(){b.content.append(this.render().el);b.setGlobalView();c=l.getPageJson();b.firstNaviCheck(c);var a=!1;c.campaignList&&(a=b.campaignParse(c.campaignList));if(a.POINT_UP&&!a.POINT_UP.globalBadge&&0<a.POINT_UP.pointUpType.length){var d=b.doc.getElementById("questLinkBtnWrap");
-1<a.POINT_UP.pointUpType.indexOf("MAIN")&&b.addClass(d.getElementsByClassName("main")[0],"pointUp");if(-1<a.POINT_UP.pointUpType.indexOf("SUB")){var p=b.storage.gameUser.toJSON();p.closeFunctions&&-1===p.closeFunctions.indexOf("ARENA")&&b.addClass(d.getElementsByClassName("side")[0],"pointUp")}(-1<a.POINT_UP.pointUpType.indexOf("CHARA")||-1<a.POINT_UP.pointUpType.indexOf("COSTUME"))&&b.addClass(d.getElementsByClassName("chara")[0],"pointUp");(-1<a.POINT_UP.pointUpType.indexOf("COMPOSE")||-1<a.POINT_UP.pointUpType.indexOf("MATERIAL"))&&
b.addClass(d.getElementsByClassName("event")[0],"pointUp")}var f=[];e.each(c.userChapterList,function(b){b.sectionList=[];b.halfAp=!1;a&&a.HALF_AP&&e.each(a.HALF_AP.questType,function(q,x){"SUB"==q&&(0<=a.HALF_AP.chapterIds.indexOf(String(b.chapterId))||0===a.HALF_AP.chapterIds.length)?b.halfAp=!0:"ALL"==q&&(b.halfAp=!0)});e.each(c.userSectionList,function(a){b.chapterId===a.section.genericId&&"SUB"==a.section.questType&&(a.chapterId=b.chapterId,a.section.questBattleList=[],e.each(c.userQuestBattleList,
function(b){a.section.sectionId===b.questBattle.sectionId&&a.section.questBattleList.push(b)}),a.section.questBattleList.sort(function(a,b){return a.questBattle.sectionIndex-b.questBattle.sectionIndex}),b.sectionList.push(a))});b.sectionList.length&&(b.sectionList.sort(function(a,b){return a.sectionId>b.sectionId?-1:a.sectionId<b.sectionId?1:0}),f.push(b))});f.sort(function(a,b){return a.chapter.chapterNo>b.chapter.chapterNo?-1:a.chapter.chapterNo<b.chapter.chapterNo?1:0});g.prototype.template=e.template($("#ChapterParts").text());
g.prototype.rootView=this;var r=b.doc.createDocumentFragment(),w=this;e.each(f,function(a,c){var d=new g({model:a});0===c&&(w.outline=a,a.cleared||(d.el.className="chapter titleHide open"));a.halfAp&&b.addClass(d.el,"halfAp");r.appendChild(d.render().el)});b.doc.getElementById("questList").appendChild(r);this.trigger("appendComp");this.createDom()},createDom:function(){var a=b.doc.querySelectorAll(".section")[0].querySelector(".prm_areaMapId").innerText;this.bgId=a;h.showSubQuestBg(n[a]);this.scrollListInit();
k.canPlayQuestNum();k.eventTabSwitch(c.eventList);b.ready.hide();if(b.clearSectionModel){var a=b.clearSectionModel.section,d=k.clearRewardChestColor(a.clearReward);m.section(a.clearRewardCode,a,d,function(){b.clearChapterModel&&(m.story(b.clearChapterModel.before,b.clearChapterModel.after),b.clearChapterModel=null)});b.clearSectionModel=null}c.sectionOutline&&this.outlinePopup()},outlinePopup:function(){if(this.outline){var a=$.extend(!0,{},this.outline.sectionList[0].section);a.title="Story up to Chapter "+
this.outline.sectionList[0].chapterNoForView+" Episode "+this.outline.sectionList[0].section.genericIndex;this.outline.sectionList[0].section.outline&&(a.outline=this.outline.sectionList[0].section.outline.replace(/＠/g,"\x3cbr\x3e"));new b.PopupClass(a,v);h.getBaseData(b.getNativeObj())}else console.log("全てのクエストをクリアしています。")},scrollListInit:function(){this.listScroll=new IScroll("#questListWrap",{tap:!0,click:!0,scrollFit:!0,deceleration:.003});this.listScroll.refresh();var a=this;this.listScroll.on("setNewPosition",
function(d){if(d=b.doc.querySelectorAll(".scrollElm")[this.listIndex]){var c=d.querySelector(".prm_areaMapId").innerText;console.log(c);if(a.bgId&&a.bgId!==c){var f=!0;e.each(n[a.bgId],function(a,b){console.log(a,b);if(c==a&&1==b||c==a&&2==b)f=!1});a.bgId=c;h.moveSubQuestBg(a.bgId,f)}}})},removeView:function(){this.off();this.remove()}})});