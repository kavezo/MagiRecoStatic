define("underscore backbone backboneCommon ajaxControl text!template/user/AnnounceTemp.html text!template/user/AnnounceTempMainte.html command".split(" "),function(k,r,b,l,t,u,n){var m,h,q;return r.View.extend({events:function(){var a={};a[b.cgti+" .titleList"]=this.openText;a[b.cgti+" .bannerAnnounce"]=this.openText;a[b.cgti+" .otherNews"]=this.openText;a[b.cgti+" .bannerLinkBtn"]=this.bannerLink;a[b.cgti+" .newsClose.btn"]=this.closeText;a[b.cgti+" .announceBtn"]=this.categoryToggle;a[b.cgti+" .andMoreBtn"]=
this.andMore;a[b.cgti+" .announcePassport"]=this.passPortAnnounce;a[b.cgti+" .outerLink"]=this.outerLink;a[b.cgti+" .announceTextLink"]=this.announceTextLink;a[b.cgti+" .announceOuterLink"]=this.outerLink;a[b.cgti+" .separateOuterLink"]=this.separateOuterLink;return a},initialize:function(a){this.listenTo(this,"removeView",this.removeView);this.model=JSON.parse(a.announcementJson);this.bannerModel=JSON.parse(a.bannerJson);this.currentCategory="NEW";if("Maintenance"!==b.historyArr[b.historyArr.length-
1])this.readDay=b.storage.gameUser.get("announcementViewAt")?Date.parse(b.storage.gameUser.get("announcementViewAt")):-1,this.template=k.template(t),this.currentTime=l.getPageJson().currentTime;else{this.readDay=Infinity;this.template=k.template(u);var c=new Date;this.currentTime=c.getFullYear()+"/"+(c.getMonth()+1)+"/"+c.getDate()+" "+c.getHours()+":"+c.getMinutes()+":"+c.getSeconds()}var d=this;window.isLocal&&window.isDebug&&(this.currentTime="2017-11-20 20:00:00");this.model=k.filter(this.model,
function(a){return Date.parse(a.startAt.replace(/-/g,"/"))<=Date.parse(d.currentTime)});this.model=k.sortBy(this.model,function(a){return a.startAt});this.newestList=k.sortBy(this.model,function(a){return-1*a.sortKey});this.render();b.scrollSet("scrollTextWrap","newsField");b.scrollSet("newsScrollWarp","announceTitle");"Maintenance"!==b.historyArr[b.historyArr.length-1]&&b.scrollSet("announceBannerArea","scrollBar");a.firstViewNews&&this.openTextFirst(a.firstViewNews);a.targetEvent&&this.openTextEvent(a.targetEvent);
a.targetCampaign&&this.openTextCampaign(a.targetCampaign)},render:function(){k.sortBy(this.model,function(a){return-1*a.sortKey});var a=k.sortBy(this.bannerModel,function(a){return a.sortKey}),c=[],d=b.thisPlatform?b.thisPlatform:b.ua.android?"ANDROID":b.ua.ios?"IOS":window.isDebug?"IOS":"DMM";console.log("platForm",d);this.platForm=d;if("Maintenance"!==b.historyArr[b.historyArr.length-1]){for(var f=this.newestList.length,e=0,g=Date.parse(l.getPageJson().currentTime);e<f;){var p=this.newestList[e].startAt.replace(/-/g,
"/"),n=this.newestList[e].endAt.replace(/-/g,"/");g>=Date.parse(p)&&Date.parse(p)>this.readDay&&Date.parse(n)>g&&(0>c.indexOf(this.newestList[e].category)&&(this.newestList[e].displayOs&&"ALL"===this.newestList[e].displayOs?c.push(this.newestList[e].category):this.newestList[e].displayOs&&this.newestList[e].displayOs===d&&c.push(this.newestList[e].category)),3===c.length&&(e=f));e++}0<c.length&&(-1<c.indexOf("NEW")?this.currentCategory="NEW":-1<c.indexOf("MNT")?this.currentCategory="MNT":-1<c.indexOf("UPD")&&
(this.currentCategory="UPD"))}f={};"Maintenance"!==b.location&&(e=Date.parse(l.getPageJson().currentTime),g=(new Date(e)).getDay(),f.week=g,g=b.storage.gameUser?b.storage.gameUser.toJSON():l.getPageJson().gameUser,g.passportExpiredAt?(p=Math.floor((Date.parse(g.passportExpiredAt)-e)/1E3/60/60/24),f.passport=-1<p?!1:!0):f.passport=!0,g.startdashGachaExpiredAt?(p=Math.floor(Date.parse(g.startdashGachaExpiredAt)-e),f.startDash=0<p?!0:!1):f.startDash=!1,f.isQuestionAnswered=b.storage.isQuestionAnswered,
f.startDashCampaign=!1,g.startdashCampaignExpiredAt&&(g=new Date(g.startdashCampaignExpiredAt),p=Math.floor(g.getTime()-e),0<p&&(e=k.findWhere(l.getPageJson().campaignList,{campaignType:"STARTDASH"}))))&&(f.startDashCampaign=!0,f.startDashCampaignContent={},f.startDashCampaignContent.campaignId=e.id,f.startDashCampaignContent.endDate=g.getMonth()+1+"/"+g.getDate()+" "+g.getHours()+":"+g.getMinutes(),e=k.findWhere(this.model,{campaignId:e.id|0}))&&(f.startDashCampaignContent.campaignNewsId=e.id);this.$el.html(this.template({model:this.newestList,
newFlg:c,readDay:this.readDay,banner:a,addShow:f,currentTime:this.currentTime,userAgent:d}));this.el.style.width="100%";this.el.style.height="100%";b.doc.getElementById("popupArea").getElementsByClassName("popupTextArea")[0].appendChild(this.el);m=b.doc.getElementById("popupArea").getElementsByClassName("announceTitle")[0];h=b.doc.getElementById("popupArea").getElementsByClassName("newsField")[0];q=b.doc.getElementById("announceTab");b.addClass(q.getElementsByClassName(this.currentCategory)[0],"current");
m.classList.add(this.currentCategory);if("Maintenance"!==b.historyArr[b.historyArr.length-1]){a=this.model.length;c=-1;for(d=Date.parse(l.getPageJson().currentTime);0<a;)a--,f=this.model[a].startAt.replace(/-/g,"/"),e=this.model[a].endAt.replace(/-/g,"/"),d>=Date.parse(f)&&Date.parse(f)>this.readDay&&Date.parse(e)>d&&(c=this.model[a].id,a=0);-1<c&&!window.isLocal&&l.ajaxSimpleGet(b.linkList.readAnnounce,"",function(a){b.responseSetStorage(a)})}},openText:function(a){a.preventDefault();if(!b.isScrolled()&&
"question"!=a.currentTarget.getAttribute("data-newsId")&&(a=k.findWhere(this.model,{id:a.currentTarget.getAttribute("data-newsId")|0}))){var c="";a.imgPath&&(c='\x3cdiv class\x3d"newsImage announceImg"\x3e\x3cimg src\x3d"'+resDir+a.imgPath+'"\x3e\x3c/div\x3e');h.getElementsByClassName("newsTextField")[0].innerHTML=c+a.text;if("DMM"===this.platForm&&h.getElementsByClassName("newsTextField")[0].getElementsByClassName("notDMM"))for(var c=h.getElementsByClassName("newsTextField")[0].getElementsByClassName("notDMM"),
d=0;c[d];)b.addClass(c[d],"hide"),d=d+1|0;n.getBaseData(b.getNativeObj());for(var f=b.doc.getElementById("scrollTextWrap").getElementsByClassName("announceImg"),e=0,c=0;c<f.length;c++)d=new Image,d.onload=function(){e++;e>=f.length&&b.scrollRefresh("scrollTextWrap","newsField",!0)},d.src=f[c].src;c=a.startAt.split("-");d=a.subject.replace(/(<br>|<br \/>|<br\/>)/gi,"");b.doc.getElementById("announceTitle").getElementsByClassName("announceMultiLine")[0].innerHTML=d;switch(a.category){case "NEW":a="News";
break;case "MNT":a="Maintenance";break;case "UPD":a="Update";break;default:a="News"}b.doc.getElementById("categoryBanner").innerText=a;b.doc.getElementById("innerDate").innerText=Number(c[1])+"/"+Number(c[2].split(" ")[0]);b.doc.getElementsByClassName("announceList")[0].classList.add("none");b.doc.getElementsByClassName("announceText")[0].classList.remove("none");h.classList.add("on");m.classList.add("off");a=b.doc.getElementById("popupArea").getElementsByClassName("newsCloseMini")[0];a.classList.add("on");
a.addEventListener(b.cgti,this.closeText,!1);b.scrollRefresh("scrollTextWrap","newsField",!0)}},openTextFirst:function(a){if(a=k.findWhere(this.model,{id:a|0})){var c=Date.parse(l.getPageJson().currentTime),d=a.startAt.replace(/-/g,"/"),f=a.endAt.replace(/-/g,"/");if(!(c<Date.parse(d)&&Date.parse(f)<=c)){c="";a.imgPath&&(c='\x3cdiv class\x3d"newsImage announceImg"\x3e\x3cimg src\x3d"'+resDir+a.imgPath+'"\x3e\x3c/div\x3e');h.getElementsByClassName("newsTextField")[0].innerHTML=c+a.text;if("DMM"===
this.platForm&&h.getElementsByClassName("newsTextField")[0].getElementsByClassName("notDMM"))for(c=h.getElementsByClassName("newsTextField")[0].getElementsByClassName("notDMM"),d=0;c[d];)b.addClass(c[d],"hide"),d=d+1|0;n.getBaseData(b.getNativeObj());for(var e=b.doc.getElementById("scrollTextWrap").getElementsByClassName("announceImg"),g=0,c=0;c<e.length;c++)d=new Image,d.onload=function(){g++;g>=e.length&&b.scrollRefresh("scrollTextWrap","newsField",!0)},d.src=e[c].src;c=a.startAt.split("-");d=a.subject.replace(/(<br>|<br \/>|<br\/>)/gi,
"");b.doc.getElementById("announceTitle").getElementsByClassName("announceMultiLine")[0].innerHTML=d;switch(a.category){case "NEW":a="Announcement";break;case "MNT":a="Maintenance";break;case "UPD":a="Update";break;default:a="Announcement"}b.doc.getElementById("categoryBanner").innerText=a;b.doc.getElementById("innerDate").innerText=Number(c[1])+"/"+Number(c[2].split(" ")[0]);b.doc.getElementsByClassName("announceList")[0].classList.add("none");b.doc.getElementsByClassName("announceText")[0].classList.remove("none");
h.classList.add("on");m.classList.add("off");a=b.doc.getElementById("popupArea").getElementsByClassName("newsCloseMini")[0];a.classList.add("on");a.addEventListener(b.cgti,this.closeText,!1);b.scrollRefresh("scrollTextWrap","newsField",!0)}}},openTextEvent:function(a){if(a=k.findWhere(this.model,{eventId:a|0})){Date.parse(l.getPageJson().currentTime);var c="";a.imgPath&&(c='\x3cdiv class\x3d"newsImage announceImg"\x3e\x3cimg src\x3d"'+resDir+a.imgPath+'"\x3e\x3c/div\x3e');h.getElementsByClassName("newsTextField")[0].innerHTML=
c+a.text;if("DMM"===this.platForm&&h.getElementsByClassName("newsTextField")[0].getElementsByClassName("notDMM"))for(var c=h.getElementsByClassName("newsTextField")[0].getElementsByClassName("notDMM"),d=0;c[d];)b.addClass(c[d],"hide"),d=d+1|0;n.getBaseData(b.getNativeObj());for(var f=b.doc.getElementById("scrollTextWrap").getElementsByClassName("announceImg"),e=0,c=0;c<f.length;c++)d=new Image,d.onload=function(){e++;e>=f.length&&b.scrollRefresh("scrollTextWrap","newsField",!0)},d.src=f[c].src;c=
a.startAt.split("-");d=a.subject.replace(/(<br>|<br \/>|<br\/>)/gi,"");b.doc.getElementById("announceTitle").getElementsByClassName("announceMultiLine")[0].innerHTML=d;switch(a.category){case "NEW":a="Announcement";break;case "MNT":a="Maintenance";break;case "UPD":a="Update";break;default:a="Announcement"}b.doc.getElementById("categoryBanner").innerText=a;b.doc.getElementById("innerDate").innerText=Number(c[1])+"/"+Number(c[2].split(" ")[0]);b.doc.getElementsByClassName("announceList")[0].classList.add("none");
b.doc.getElementsByClassName("announceText")[0].classList.remove("none");h.classList.add("on");m.classList.add("off");c=b.doc.getElementById("popupArea").getElementsByClassName("newsCloseMini")[0];c.classList.add("on");a=function(){b.g_popup_instance.popupView.close()};c.addEventListener(b.cgti,a,!1);c=b.doc.getElementsByClassName("newsClose")[0];c.innerText="Close";b.addClass(c,"eventClose");b.removeClass(c,"newsClose");c.addEventListener(b.cgti,a,!1);b.scrollRefresh("scrollTextWrap","newsField",
!0)}},openTextCampaign:function(a){if(a=k.findWhere(this.model,{campaignId:a|0})){var c="";a.imgPath&&(c='\x3cdiv class\x3d"newsImage announceImg"\x3e\x3cimg src\x3d"'+resDir+a.imgPath+'"\x3e\x3c/div\x3e');h.getElementsByClassName("newsTextField")[0].innerHTML=c+a.text;if("DMM"===this.platForm&&h.getElementsByClassName("newsTextField")[0].getElementsByClassName("notDMM"))for(var c=h.getElementsByClassName("newsTextField")[0].getElementsByClassName("notDMM"),d=0;c[d];)b.addClass(c[d],"hide"),d=d+1|
0;n.getBaseData(b.getNativeObj());for(var f=b.doc.getElementById("scrollTextWrap").getElementsByClassName("announceImg"),e=0,c=0;c<f.length;c++)d=new Image,d.onload=function(){e++;e>=f.length&&b.scrollRefresh("scrollTextWrap","newsField",!0)},d.src=f[c].src;c=a.startAt.split("-");d=a.subject.replace(/(<br>|<br \/>|<br\/>)/gi,"");b.doc.getElementById("announceTitle").getElementsByClassName("announceMultiLine")[0].innerHTML=d;switch(a.category){case "NEW":a="News";break;case "MNT":a="Maintenance";break;
case "UPD":a="Update";break;default:a="News"}b.doc.getElementById("categoryBanner").innerText=a;b.doc.getElementById("innerDate").innerText=Number(c[1])+"/"+Number(c[2].split(" ")[0]);b.doc.getElementsByClassName("announceList")[0].classList.add("none");b.doc.getElementsByClassName("announceText")[0].classList.remove("none");h.classList.add("on");m.classList.add("off");c=b.doc.getElementById("popupArea").getElementsByClassName("newsCloseMini")[0];c.classList.add("on");a=function(){b.g_popup_instance.popupView.close()};
c.addEventListener(b.cgti,a,!1);c=b.doc.getElementsByClassName("newsClose")[0];c.innerText="Close";b.addClass(c,"eventClose");b.removeClass(c,"newsClose");c.addEventListener(b.cgti,a,!1);b.scrollRefresh("scrollTextWrap","newsField",!0)}},closeText:function(a){a.preventDefault();b.isScrolled()||(b.doc.getElementsByClassName("announceList")[0].classList.remove("none"),b.doc.getElementsByClassName("announceText")[0].classList.add("none"),h.classList.remove("on"),m.classList.remove("off"),h.getElementsByClassName("newsTextField")[0].innerHTML=
"",b.doc.getElementById("popupArea").getElementsByClassName("newsCloseMini")[0].classList.remove("on"),window.isLocal||"Maintenance"===b.historyArr[b.historyArr.length-1]||b.scrollRefresh("announceBannerArea","scrollBar"),b.scrollRefresh("newsScrollWarp","announceTitle"))},bannerLink:function(a){a.preventDefault();b.isScrolled()||(-1<location.hash.indexOf(a.currentTarget.dataset.href)?b.g_popup_instance.popupView.close():(b.ready.show(),setTimeout(function(){location.href=a.currentTarget.dataset.href},
500)))},categoryToggle:function(a){a.preventDefault();b.isScrolled()||this.currentCategory===a.currentTarget.getAttribute("data-category")||(a=a.currentTarget.getAttribute("data-category"),b.removeClass(q.getElementsByClassName(this.currentCategory)[0],"current"),m.classList.remove(this.currentCategory),b.addClass(q.getElementsByClassName(a)[0],"current"),m.classList.add(a),this.currentCategory=a,b.scrollRefresh("newsScrollWarp","announceTitle",!0))},andMore:function(a){a.preventDefault();b.isScrolled()||
(b.addClass(b.doc.getElementById("newsScrollWarp").getElementsByClassName("scrollBar")[0],"moreDisp"),b.scrollRefresh())},passPortAnnounce:function(a){a.preventDefault();b.isScrolled()||b.globalMenuView.moneyPopup(a)},outerLink:function(a){a.preventDefault();b.isScrolled()||(a=a.currentTarget.dataset.outlink)&&n.browserOpen(a)},separateOuterLink:function(a){a.preventDefault();b.isScrolled()||(a=b.ua.android?a.currentTarget.dataset.androidUrl:a.currentTarget.dataset.iosUrl)&&n.browserOpen(a)},announceTextLink:function(a){a.preventDefault();
if(!b.isScrolled()&&"Maintenance"!==b.historyArr[b.historyArr.length-1]){var c=a.currentTarget.dataset.href;c&&(-1<location.hash.indexOf(a.currentTarget.dataset.href)?b.g_popup_instance.popupView.close():location.href=c)}},removeView:function(){this.off();this.remove()}})});