define("underscore backbone backboneCommon ajaxControl command cardUtil js/card/CardPopup js/memoria/MemoriaPopup".split(" "),function(m,f,b,n,d,g,h,k){var l=function(){d.endL2d();var a={id:"101799",x:150};a.y=Math.floor(b.doc.getElementsByTagName("body")[0].offsetHeight/2);a.type=1;a.key="idle";d.startL2d(a)};f.Model.extend();return f.View.extend({className:"shopItemWrap commonFrame4",events:function(){var a={};a[b.cgti]=this.tapped;a["touchstart .itemIcon"]=this.detailTouchStart;a[b.cgti+".itemIcon"]=
this.detailTouchEnd;return a},initialize:function(){this.listenTo(this.rootView,"remove",this.removeView);this.listenTo(this.rootView,"haveNumberAllCheck",this.toggleAction);this.listenTo(this.rootView,"conditionChecks",this.conditionCheck);this.hasNum=0},render:function(){var a;switch(this.model.needItemId){case "MONEY":a="icon_money_f.png";break;case "RICHE":a="icon_cursechip_f.png";break;default:a=(-1<this.model.needItemId.indexOf("EVENT_")?"event/":-1<this.model.needItemId.indexOf("CAMPAIGN_")?
"campaign/":"")+"icon_"+this.model.needItemId.toLowerCase()+"_f.png"}var c=!1;this.model.consumeType&&"PURCHASED_MONEY"===this.model.consumeType&&(c=!0);this.$el.html(this.template({model:this.model,costImage:a,purchasedFlg:c}));this.toggleAction();this.model.recommend&&b.addClass(this.el.getElementsByClassName("recommend")[0],"on");this.model.alreadyGet&&(b.addClass(this.el,"off"),b.addClass(this.el,"thisHad"));this.model.limitedNumber&&this.userShopModel&&(this.el.getElementsByClassName("itemAmountNumber")[0].innerText=
this.model.limitedNumber-this.userShopModel.num+"/"+this.model.limitedNumber,0===this.model.limitedNumber-this.userShopModel.num&&(b.addClass(this.el,"off"),console.log("#################"+this.model.needItemId.toLowerCase()),"campaign_9991_exchange"==this.model.needItemId.toLowerCase()&&b.addClass(this.el,"off9991")));return this},toggleAction:function(){this.conditionCheck();switch(this.model.shopItemType){case "CARD":var a=["userCharaIcon",this.model.card.rank,this.model.card.attributeId];b.addClass(this.el.getElementsByClassName("itemIcon")[0],
a);b.storage.userCharaList.findWhere({charaId:this.model.card.charaNo})&&(this.hasNum=1);this.el.getElementsByClassName("itemHasNumber")[0].textContent=this.hasNum;break;case "ITEM":b.storage.userItemList.findWhere({itemId:this.model.item.itemCode})&&(this.hasNum=b.storage.userItemList.findWhere({itemId:this.model.item.itemCode}).toJSON().quantity);this.el.getElementsByClassName("itemHasNumber")[0].textContent=this.hasNum;break;case "GIFT":b.storage.userGiftList.findWhere({giftId:this.model.gift.id})&&
(this.hasNum=b.storage.userGiftList.findWhere({giftId:this.model.gift.id}).toJSON().quantity);this.el.getElementsByClassName("itemHasNumber")[0].textContent=this.hasNum;break;case "GEM":this.hasNum=(a=b.storage.userCharaList.findWhere({charaId:Number(this.model.genericId)}))?a.toJSON().lbItemNum?a.toJSON().lbItemNum:0:0;this.el.getElementsByClassName("itemHasNumber")[0].textContent=this.hasNum;break;case "LIVE2D":this.hasNum=b.storage.userLive2dList.findWhere({charaId:Number(this.model.chara.id),
live2dId:this.model.live2d.live2dId})?1:0;this.el.getElementsByClassName("itemHasNumber")[0].textContent=this.hasNum;break;case "FORMATION_SHEET":this.hasNum=b.storage.userFormationSheetList.findWhere({formationSheetId:Number(this.model.formationSheet.id)})?1:0;this.el.getElementsByClassName("itemHasNumber")[0].textContent=this.hasNum;break;case "SET":var c=this.model.rewardCode.split(","),a=c[0].split("_");(-1<c[0].indexOf("RICHE_")||1<c.length||-1<c[0].indexOf("PRSENTED_MONEY")||"ITEM_COMPOSE_ITEM_ALL_PP_10"==
c[0])&&b.addClass(this.el.getElementsByClassName("had_dl")[0],"none");switch(a[0]){case "ITEM":c=a.length-1;if(0===c)break;for(var e="",d=1;d<c;d++)e=""!==e?e+"_"+a[d]:a[d];b.storage.userItemList.findWhere({itemId:e})&&(this.hasNum=b.storage.userItemList.findWhere({itemId:e}).toJSON().quantity);this.el.getElementsByClassName("itemHasNumber")[0].textContent=this.hasNum;break;case "GIFT":b.storage.userGiftList.findWhere({giftId:a[1]|0})&&(this.hasNum=b.storage.userGiftList.findWhere({giftId:a[1]|0}).toJSON().quantity);
this.el.getElementsByClassName("itemHasNumber")[0].textContent=this.hasNum;break;case "CARD":b.addClass(this.el.getElementsByClassName("had_dl")[0],"none")}}},detailTouchStart:function(a){"CARD"===this.model.shopItemType?this.cardTimer(a):"PIECE"!==this.model.shopItemType&&"MAXPIECE"!==this.model.shopItemType||this.memoriaTimer(a)},cardTimer:function(a){this.model.maxLevel=g.getMaxLevel(this.model.card.rank);this.model.maxStatus=g.getAfterParam(this.model.card.cardId,this.model.chara,null,this.model.maxLevel);
h.shopCardDetailPopup(a,this.model,l)},memoriaTimer:function(a){this.model.closeEvent=l;k.maxParamPopup(a,this.model,!0,!0,!0)},tapped:function(a){if("CARD"===this.model.shopItemType){if(h.popupTimerStop(),b.detailView)return}else if("PIECE"===this.model.shopItemType||"MAXPIECE"===this.model.shopItemType)if(k.popupTimerStop(),b.detailPopup)return;if(!b.isScrolled()){a.preventDefault();d.startSe(1002);a=this.rootView.popupTemplate;new b.PopupClass({title:this.model.name,content:"",exClass:"popupShop"});
var c=new this.rootView.popupView;c.parentView=this;c.template=a;b.doc.getElementById("popupArea").getElementsByClassName("popupTextArea")[0].appendChild(c.render().el);this.model.limitedNumber&&this.userShopModel&&(b.doc.getElementById("popupArea").getElementsByClassName("itemAmountNumber")[0].innerText=this.model.limitedNumber-this.userShopModel.num+"/"+this.model.limitedNumber,1>this.model.limitedNumber-this.userShopModel.num&&b.addClass(b.doc.getElementById("purchaseDecide"),"off"));("SET"!==
this.model.shopItemType||"SET"===this.model.shopItemType&&-1===this.model.rewardCode.indexOf(",")&&-1===this.model.rewardCode.indexOf("RICHE")&&0!=this.model.rewardCode.indexOf("CARD"))&&"PIECE"!==this.model.shopItemType&&"MAXPIECE"!==this.model.shopItemType&&(this.toggleAction(),b.doc.getElementById("popupArea").getElementsByClassName("hasAmount")[0].innerText=this.hasNum);d.getBaseData(b.getNativeObj())}},amountChange:function(a,c){this.toggleAction();this.model.limitedNumber&&(a=m.findWhere(a,
{shopItemId:this.model.id}),this.userShopModel?this.userShopModel.num=this.userShopModel.num+c|0:this.userShopModel=a,c=this.model.limitedNumber-this.userShopModel.num|0,this.el.getElementsByClassName("itemAmountNumber")[0].innerText=c+"/"+this.model.limitedNumber,0===c&&(b.addClass(this.el,"off"),console.log("################# : "+this.model.needItemId.toLowerCase()),"campaign_9991_exchange"==this.model.needItemId.toLowerCase()&&b.addClass(this.el,"off9991"),"LIVE2D"===this.model.shopItemType&&b.storage.userLive2dList?
b.storage.userLive2dList.findWhere({charaId:this.model.live2d.charaId,live2dId:this.model.live2d.live2dId})&&(this.model.alreadyGet=!0):"ITEM"===this.model.shopItemType&&"BACKGROUND"===this.model.item.itemType&&b.storage.userItemList.findWhere({itemId:this.model.item.itemCode})&&(this.model.alreadyGet=!0),this.model.alreadyGet&&b.addClass(this.el,"thisHad")))},conditionCheck:function(a){this.model.openConditionIdList&&(a&&0===!this.model.openConditionIdList.indexOf(a)||(this.rootView.conditionFlag(this.model.shopId,
this.model.openConditionIdList)?b.removeClass(this.el,"none"):b.addClass(this.el,"none")))},removeView:function(){this.off();this.remove()}})});