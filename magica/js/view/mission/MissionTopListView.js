define(["underscore","backbone","backboneCommon","ajaxControl"],function(h,l,a,g){var e=!1;return l.View.extend({className:"wrap commonFrame4",events:function(){var b={};b[a.cgti+" .missionBtn"]=this.missionBtn;return b},initialize:function(a,c){this.listenTo(this.rootView,"removeChildView",this.removeView);this.listenTo(this.rootView,"afterAllRecieve",this.afterAllRecieve);this.model=a;this.missionType=c;e=!1},render:function(){this.$el.html(this.template({model:this.model}));var b=this.model.challenge.count,
c=this.model.clearedCount;c>=b?(this.el.classList.add("clear"),a.addClass(this.el.getElementsByClassName("missionBtn")[0],"clear"),a.removeClass(this.el.getElementsByClassName("missionBtn")[0],"b_white"),a.addClass(this.el.getElementsByClassName("missionBtn")[0],"b_pink"),this.el.getElementsByClassName("missionGuage")[0].style.width="100%",c!==b&&(this.el.getElementsByClassName("missionCompleteNum")[0].textContent=b+"/"+b)):this.el.getElementsByClassName("missionGuage")[0].style.width=Math.floor(c/
b*100)+"%";return this},missionBtn:function(b){b.preventDefault();if(!a.isScrolled()&&!e)if(e=!0,this.model.clearedCount>=this.model.challenge.count){var c=this;b=function(b){if("error"!==b.resultCode){a.responseSetStorage(b);switch(c.missionType){case "daily":a.storage.userDailyChallengeList.remove(a.storage.userDailyChallengeList.findWhere({challengeId:c.model.challengeId}));c.rootView.allReservCheck();break;case "total":a.storage.userTotalChallengeList.remove(a.storage.userTotalChallengeList.findWhere({challengeId:c.model.challengeId}));
c.rootView.allReservCheck();break;default:c.rootView.eventMission=c.rootView.makeEventMissionList(),c.rootView.allReservCheck()}e=!1;var d=function(){c.rootView.clearMissionCount()};1>Object.keys(b).length||window.isLocal&&window.isBrowser&&2>Object.keys(b).length?new a.PopupClass({content:"This Mission Reward has expired.\x3cbr\x3eYou cannot receive expired Rewards.",closeBtnText:"OK",popupType:"typeC",exClass:"missionPop"},null,null,d):new a.PopupClass({content:"Mission Reward(s) Received\x3cbr\x3e\x3cbr\x3eâ€»Item(s) can be found in your Inventory.",
closeBtnText:"OK",popupType:"typeC",exClass:"missionPop"},null,null,d);c.removeView();"daily"===c.missionType?1>a.doc.getElementById("mission1").getElementsByClassName("wrap").length&&(a.doc.getElementById("mission1").innerHTML='\x3cp class\x3d"noMission ts_white"\x3eThere are no available Missions\x3c/p\x3e'):"total"===c.missionType?1>a.doc.getElementById("mission2").getElementsByClassName("wrap").length&&(a.doc.getElementById("mission2").innerHTML='\x3cp class\x3d"noMission ts_white"\x3eThere are no available Missions\x3c/p\x3e'):
1>a.doc.getElementById(c.missionType).getElementsByClassName("wrap").length&&(a.doc.getElementById(c.missionType).innerHTML='\x3cp class\x3d"noMission ts_white"\x3eThere are no available Missions\x3c/p\x3e');a.scrollRefresh(null,null,!0)}};if("daily"===this.missionType)g.ajaxPost(a.linkList.userDailyChallengeReceive,{challengeId:this.model.challengeId},b);else if("total"===this.missionType)g.ajaxPost(a.linkList.userTotalChallengeReceive,{challengeId:this.model.challengeId},b);else{var f=this.missionType.split("_");
"e"!==f[0]&&"c"!==f[0]||g.ajaxPost(a.linkList.userLimitedChallengeReceive,{challengeId:this.model.challengeId},b)}}else if(e=!1,b=this.model.challenge.pageLink?this.model.challenge.pageLink:"#/MyPage","daily"!==this.missionType&&"total"!==this.missionType){var d=this.missionType.split("_"),f=function(a){var b=Date.parse(new Date);a=Date.parse(a.endAt);return b>a?!1:!0},k=function(){location.href="#/MyPage"};"e"===d[0]?(d=h.findWhere(this.rootView.eventMission,{checkId:this.missionType}),f(d)?location.href=
b:new a.PopupClass({title:"Not in Session",content:"This Mission is not available",closeBtnText:"Home",popupType:"typeC"},null,null,k)):"c"===d[0]&&(d=h.findWhere(this.rootView.eventMission,{checkId:this.missionType}),f(d)?location.href=b:new a.PopupClass({title:"Not in Session",content:"This Mission is not available",closeBtnText:"Home",popupType:"typeC"},null,null,k))}else location.href=b},afterAllRecieve:function(b,c){b===this.missionType&&("daily"===this.missionType?-1<c.indexOf(this.model.challengeId)&&
(a.storage.userDailyChallengeList.remove(a.storage.userDailyChallengeList.findWhere({challengeId:this.model.challengeId})),this.removeView(),1>a.doc.getElementById("mission1").getElementsByClassName("wrap").length&&(a.doc.getElementById("mission1").innerHTML='\x3cp class\x3d"noMission ts_white"\x3eThere are no available Missions\x3c/p\x3e'),a.scrollRefresh()):"total"===this.missionType?-1<c.indexOf(this.model.challengeId)&&(a.storage.userTotalChallengeList.remove(a.storage.userTotalChallengeList.findWhere({challengeId:this.model.challengeId})),
this.removeView(),1>a.doc.getElementById("mission2").getElementsByClassName("wrap").length&&(a.doc.getElementById("mission2").innerHTML='\x3cp class\x3d"noMission ts_white"\x3eThere are no available Missions\x3c/p\x3e'),a.scrollRefresh()):-1<c.indexOf(this.model.challengeId)&&(this.removeView(),1>a.doc.getElementById(b).getElementsByClassName("wrap").length&&(a.doc.getElementById(b).innerHTML='\x3cp class\x3d"noMission ts_white"\x3eThere are no available Missions\x3c/p\x3e'),a.scrollRefresh()))},
removeView:function(){this.off();this.remove();delete this.model.challenge.view}})});