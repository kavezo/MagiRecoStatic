define("underscore backbone backboneCommon ajaxControl command text!template/arena/ArenaConfirm.html".split(" "),function(g,h,a,k,e,l){return h.View.extend({tagName:"div",id:"confirmPopWrap",events:function(){var b={};b[a.cgti+" #battleStartBtn"]=this.battleStart;b[a.cgti+" .closeBtn"]=this.removeView;return b},initialize:function(){this.listenTo(this.parentView.rootView,"removeView",this.removeView);this.template=g.template(l)},render:function(){var b=a.isRankingRunning(this.model.eventList);this.$el.html(this.template({model:this.model,
rankingRun:b}));a.addClass(a.doc.getElementById("curtain"),"show");return this},battleStart:function(b){b.preventDefault();if(!a.isScrolled()&&!this.started){var d=this;if("SIMULATE"!==d.model.battleType&&(b=(Date.parse(new Date)/1E3|0)-this.parentView.rootView.accessClientTime,this.parentView.rootView.accessServerTime+b>=this.parentView.rootView.matchExpiredAt)){new a.PopupClass({title:"Opponent Changed",content:"Opponents changed due to time out. \x3cbr\x3eReturning to the Mirrors Page.",decideBtnText:"Mirrors",
canClose:!1,popupType:"typeC"},null,function(){$(".decideBtn").on(a.cgti,function(){d.removeView();$(".decideBtn").off(a.cgti);location.href="#/ArenaTop"})});return}if(1>a.storage.userStatusList.findWhere({statusId:"BTP"}).toJSON().point){new a.PopupClass({title:"Error",content:"You do not have enough BP.",closeBtnText:"Close",decideBtnText:"Restore"});var f=function(b){b.preventDefault();a.isScrolled()||(a.doc.removeEventListener(a.cgti,f),d.parentView.rootView.infoView.bpCurePop(b))};a.doc.getElementById("popupArea").getElementsByClassName("decideBtn")[0].addEventListener(a.cgti,
f)}else this.started=!0,this.parentView.rootView.infoView.timerStop(),this.startJson={opponentUserId:this.model.userId,arenaBattleType:this.model.battleType},a.battleEnemy=this.model.userId,window.isBrowser?(a.arenaJson=this.startJson,e.sendCommand("ArenaStub,"+JSON.stringify(this.startJson)),d.removeView()):k.ajaxPost(a.linkList.arenaStart,this.startJson,function(b){a.acpTimeCure&&(clearInterval(a.acpTimeCure),a.acpTimeCure=null);$(a.ready.target).on("webkitAnimationEnd",function(){e.changeBg("web_black.jpg");
$(a.ready.target).off("webkitAnimationEnd");$(a.ready.target).on("webkitAnimationEnd",function(b){"readyFadeOut"==b.originalEvent.animationName&&(a.ready.target.className="")});var c={};c.questId=b.userQuestBattleResultList[0].id;c.resultUrl="/magica/index.html#/ArenaResult";c.retireUrl="FREE_RANK"===d.model.battleType?"/magica/index.html#/ArenaFreeRank":"SIMULATE"===d.model.battleType?"/magica/index.html#/ArenaSimulate":"/magica/index.html#/ArenaRanking";c.tips={type:2};a.globalMenuView&&a.globalMenuView.trigger("removeView");
setTimeout(function(){e.setWebView(!1);$("#commandDiv").on("nativeCallback",function(b,c){$("#commandDiv").off();c&&c.webData&&a.responseSetStorage(c.webData);location.href="#/QuestBackground";d.removeView()});e.startArena(c)},500)});a.addClass(a.ready.target,"preNativeFadeIn")})}},removeView:function(){a.removeClass(a.doc.getElementById("curtain"),"show");a.arenaConfirmView=null;this.off();this.remove()}})});