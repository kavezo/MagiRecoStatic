define("underscore backbone backboneCommon ajaxControl command text!template/arena/ArenaResult.html js/follow/FollowPopup".split(" "),function(f,l,a,h,e,m,n){var g;return l.View.extend({events:function(){var b={};b[a.cgti+" #enemyClip"]=this.enemyPopup;b[a.cgti+" #touchScreen"]=this.toggles;b["webkitTransitionEnd #resultTitle"]=this.toggleTapBlock;b["webkitAnimationEnd #resultTitle"]=this.toggleTapBlock;b["webkitanimationend #resultTitle"]=this.toggleTapBlock;b["animationend #resultTitle"]=this.toggleTapBlock;
b["webkitTransitionEnd #pointsWrap"]=this.toggleTapStep;b["webkitAnimationEnd #pointsWrap"]=this.toggleTapStep;b["webkitanimationend #pointsWrap"]=this.toggleTapStep;b["animationend #pointsWrap"]=this.toggleTapStep;b["webkitTransitionEnd .nextMirrorAfter"]=this.rankUpAfter;b["webkitAnimationEnd .nextMirrorAfter"]=this.rankUpAfter;b["webkitanimationend .nextMirrorAfter"]=this.rankUpAfter;b["animationend .nextMirrorAfter"]=this.rankUpAfter;b["webkitTransitionEnd #enemyBtn"]=this.enemyBtnActive;b["webkitAnimationEnd #enemyBtn"]=
this.enemyBtnActive;b["webkitanimationend #enemyBtn"]=this.enemyBtnActive;b["animationend #enemyBtn"]=this.enemyBtnActive;return b},initialize:function(b){a.oldModel.userArenaBattle?(this.oldArenaBattle=a.oldModel.userArenaBattle,a.oldModel=null):this.oldArenaBattle=a.storage.userArenaBattle.toJSON();this.model=b;this.newestModel=h.getPageJson();this.model.userArenaBattleResultList[0]?(g=this,this.tapFlag=!1,this.tapStep="first",a.responseSetStorage(this.model),this.allInitialized(),this.template=
f.template(m),this.campaign=a.campaignParse(h.getPageJson().campaignList),this.battleDataMake(),this.checkEnemy()):(e.setWebView(),a.androidKeyStop=!0,new a.PopupClass({title:"Error",content:"Battle results could not be retrieved.\x3cbr\x3eReturning to the Title page.",closeBtnText:"OK"},null,null,function(){e.endArena();e.nativeReload("#/TopPage")}))},render:function(){this.$el.html(this.template({model:this.model,battleData:this.battleData,gameUser:a.storage.gameUser.toJSON()}));return this},battleDataMake:function(){this.battleData=
{};this.battleData.result=this.model.userArenaBattleResultList[0];this.battleData.battle=this.model.userArenaBattle;this.battleData.oldBattle=this.model.oldArenaBattle;this.battleData.quest=this.model.userQuestBattleResultList[0];this.battleData.isRanking=!1;this.battleData.isSimulate="SIMULATE"==this.battleData.result.arenaBattleType?!0:!1;this.battleData.freeResult={};var a=[1.5,1.5,1.5,1.4,1.3,1.2,1.1],c=[0,0,1,2,3,5,7,10],d="HIGHER"===this.battleData.result.arenaBattleOpponentType?2:"SAME"===
this.battleData.result.arenaBattleOpponentType?1:0;this.battleData.freeResult.matchDiff="HIGHER"===this.battleData.result.arenaBattleOpponentType?2:"SAME"===this.battleData.result.arenaBattleOpponentType?1:0;this.battleData.freeResult.difficultyBonus=[.8,1,1.2][d];this.battleData.freeResult.turnBonus=6<this.battleData.quest.turns?1:a[this.battleData.quest.turns];this.battleData.freeResult.consectiveBonus=8>this.battleData.result.numberOfConsecutiveWins?c[this.battleData.result.numberOfConsecutiveWins]:
0;a=this.battleData.oldBattle.previousFreeRankClass?this.battleData.oldBattle.previousFreeRankClass.requiredPoint|0:0;this.battleData.freeResult.guageLen=Math.round((this.battleData.oldBattle.freeRankArenaPoint-a)/(this.battleData.oldBattle.currentFreeRankClass.requiredPoint-a)*100);this.battleData.freeResult.mirrorsPoint=this.battleData.oldBattle.currentFreeRankClass.requiredPoint-this.battleData.oldBattle.freeRankArenaPoint;a=1;"FREE_RANK"==this.battleData.result.arenaBattleType&&this.campaign.ARENA_REWARD_UP&&
(a=this.campaign.ARENA_REWARD_UP.magnification/1E3);this.battleData.freeResult.getCoin="WIN"!==this.battleData.result.arenaBattleStatus?1*a:3*a},createDom:function(){a.content.append(this.render().el);e.getBaseData(a.getNativeObj());a.globalMenuView&&a.globalMenuView.trigger("removeView");var b;b="WIN"===this.model.userArenaBattleResultList[0].arenaBattleStatus?1701:1702;this.resultSe=setTimeout(function(){e.startSe(b);g.resultSe=null},2666);"FREE_RANK"==this.battleData.result.arenaBattleType&&this.campaign.ARENA_REWARD_UP&&
a.addClass(a.doc.getElementById("pointsWrap").getElementsByClassName("coinNum")[0],"bonus");e.setWebView()},toggleTapBlock:function(a){this.tapFlag=!0},toggleTapStep:function(a){this.tapStep="second"},checkEnemy:function(){for(var a=h.getPageJson().userProfile,c=[],d=1;6>d;d++)a.userDeck["userCardId"+d]&&c.push(f.findWhere(a.userCardList,{id:a.userDeck["userCardId"+d]}));c=Date.parse(this.newestModel.currentTime)/1E3;(d=a.lastAccessDate?Date.parse(a.lastAccessDate)/1E3:null)?(c=(c-d)/60,16>c?c="15 Min(s) Ago":
60>c?c=Math.floor(c)+" Min(s) Ago":60<c&&1440>c?c=Math.floor(c/60)+" Hour(s) Ago":(c=c/60/24,c=30<c?Math.floor(c/30)+" Month(s) Ago":Math.floor(c)+" Day(s) Ago")):c="- Day(s) Ago";a.loginTimeLag=c;this.model.enemyData=a;this.createDom()},allInitialized:function(){a.historyArray=["MyPage","ArenaTop"];this.backLink="FREE_RANK"===this.model.userArenaBattleResultList[0].arenaBattleType?"#/ArenaFreeRank":"RANKING"===this.model.userArenaBattleResultList[0].arenaBattleType?"#/ArenaRanking":"SIMULATE"===
this.model.userArenaBattleResultList[0].arenaBattleType?"#/ArenaSimulate":"#/ArenaTop";a.arenaStoryPlay=!1;this.storyId=null;this.model.oldArenaBattle=this.oldArenaBattle;this.oldArenaBattle=null;this.model.arenaDecks={};this.model.arenaDecks.noneLeader=[];for(var b=f.findWhere(a.storage.userDeckList.toJSON(),{deckType:21}),c=f.findWhere(a.storage.userCardList.toJSON(),{id:b.questEpisodeUserCardId}),d=1;6>d;d++)if(b["userCardId"+d])if(b.questEpisodeUserCardId!==b["userCardId"+d]){var e=f.findWhere(a.storage.userCardList.toJSON(),
{id:b["userCardId"+d]}),g=f.findWhere(a.storage.userCharaList.toJSON(),{charaId:e.card.charaNo});e.chara=g.chara;this.model.arenaDecks.noneLeader.push(e)}else this.model.arenaDecks.leaderCard=c,e=f.findWhere(a.storage.userCharaList.toJSON(),{charaId:c.card.charaNo}),this.model.arenaDecks.leaderCard.chara=e.chara;"FREE_RANK"===this.model.userArenaBattleResultList[0].arenaBattleType&&(this.model.rankup=!1,this.model.userArenaBattle&&this.model.oldArenaBattle.currentFreeRankClassType!==this.model.userArenaBattle.currentFreeRankClassType?
(this.model.rankup=!0,this.model.rankupDisp={},this.rankUpStoryChecks()):this.model.userArenaBattle||(this.model.userArenaBattle=this.model.oldArenaBattle))},enemyPopup:function(b){b.preventDefault();a.isScrolled()||(b.currentTarget.classList.contains("canTap")||b.currentTarget.classList.contains("skipAnim")?n.instantPopup(b,this.model.enemyData,"arena",this):this.toggles(b))},toggles:function(b){b.preventDefault();!a.isScrolled()&&this.tapFlag&&(this.tapFlag=!1,"first"===this.tapStep?(a.addClass(a.doc.getElementById("touchScreen"),
"nodisp"),a.addClass(a.doc.getElementById("mainWrap"),"skipAnim"),a.addClass(a.doc.getElementById("resultTitle"),"skipAnim"),a.addClass(a.doc.getElementById("enemyBtn"),"skipAnim"),a.addClass(a.doc.getElementById("enemyClip"),"skipAnim"),this.tapStep="second",setTimeout(function(){g.tapFlag=!0;a.removeClass(a.doc.getElementById("touchScreen"),"nodisp")},300)):(a.addClass(a.doc.getElementById("touchScreen"),"nodisp"),a.addClass(a.doc.getElementById("mainWrap").getElementsByClassName("touch_screen")[0],
"off"),"FREE_RANK"===this.model.userArenaBattleResultList[0].arenaBattleType&&this.guageUpFlag?(a.addClass(a.doc.getElementById("rankupWrap"),"endAnim"),a.addClass(a.doc.getElementById("resultMirror"),"endAnim"),a.addClass(a.doc.getElementById("resultTitle"),"endAnim"),this.nextPageHandler(b)):"FREE_RANK"===this.model.userArenaBattleResultList[0].arenaBattleType&&this.model.oldArenaBattle.currentFreeRankClass.nextClass?this.guageFunc():this.nextPageHandler(b)))},guageFunc:function(){this.guageUpFlag=
!0;this.tapStep="second";var b=function(b){g.model.rankup?g.rankUps():setTimeout(function(){a.addClass(a.doc.getElementById("mainWrap"),"endAnim");a.addClass(a.doc.getElementById("resultMirror"),"endAnim");a.addClass(a.doc.getElementById("resultTitle"),"endAnim");a.addClass(a.doc.getElementById("enemyBtn"),"fadeOut");g.nextPageHandler(b)},1E3)},c=this.model.oldArenaBattle.previousFreeRankClass?this.model.oldArenaBattle.previousFreeRankClass.requiredPoint|0:0,d=Math.round((this.model.oldArenaBattle.freeRankArenaPoint-
c)/(this.model.oldArenaBattle.currentFreeRankClass.requiredPoint-c)*100),f;this.model.rankup?(c=100,f=this.model.oldArenaBattle.currentFreeRankClass.requiredPoint):(c=this.model.userArenaBattle.previousFreeRankClass?this.model.userArenaBattle.previousFreeRankClass.requiredPoint|0:0,c=Math.round((this.model.userArenaBattle.freeRankArenaPoint-c)/(this.model.userArenaBattle.currentFreeRankClass.requiredPoint-c)*100),f=this.model.userArenaBattle.freeRankArenaPoint);var k=0,h=(c-d)/50,l=this.model.oldArenaBattle.currentFreeRankClass.requiredPoint-
this.model.oldArenaBattle.freeRankArenaPoint,m=(f-this.model.oldArenaBattle.freeRankArenaPoint)/50,n=setInterval(function(){e.startSe(1007);k++;var c=Math.round(d+h*k);a.doc.getElementById("requireWrap").getElementsByClassName("requireGuageInner")[0].style.width=c+"%";a.doc.getElementById("leftCount").textContent=Math.round(l-m*k);49<k&&(clearInterval(n),b())},20)},rankUpAfter:function(){this.tapFlag=!0;a.removeClass(a.doc.getElementById("touchScreen"),"nodisp")},rankUps:function(){a.addClass(a.doc.getElementById("enemyBtn"),
"fadeOut");a.addClass(a.doc.getElementById("mainWrap"),"fadeOut");a.removeClass(a.doc.getElementById("rankupWrap"),"nodisp");a.addClass(a.doc.getElementById("rankupFlash"),"flashing");this.model.rankup=!1;e.startSe(1703)},rankUpStoryChecks:function(){this.storyId=this.model.userArenaBattle.currentFreeRankClass.storyId;this.model.rankupDisp.storyName=this.model.userArenaBattle.currentFreeRankClass.className+" ["+this.model.userArenaBattle.currentFreeRankClass.storyTitle+"]";var b=a.storage.userSectionList.findWhere({sectionId:Number(this.model.userArenaBattle.currentFreeRankClass.openConditionSectionId)}),
b=b&&b.toJSON().cleared?!0:!1;this.model.userArenaBattle.currentFreeRankClass.openConditionSectionId&&!b?(b=this.model.userArenaBattle.currentFreeRankClass.openConditionSection,this.model.rankupDisp.conditionSection="Complete Chapter\x26nbsp;"+b.openConditionChapter.chapterNoForView+" Episode\x26nbsp;"+b.genericIndex+" of the Main Story",a.arenaStoryPlay=!1):a.arenaStoryPlay=!0},nextPageHandler:function(a){a&&a.preventDefault();this.storyCheck(this.backLink)},storyCheck:function(b){$(a.ready.target).on("webkitAnimationEnd",
function(){$(a.ready.target).off("webkitAnimationEnd");$(a.ready.target).on("webkitAnimationEnd",function(b){"readyFadeOut"==b.originalEvent.animationName&&(a.ready.target.className="")});e.endArena();location.href=g.storyId?"#/ArenaTop":b});a.addClass(a.ready.target,"preNativeFadeIn")},enemyBtnActive:function(b){a.addClass(a.doc.getElementById("enemyClip"),"canTap")},removeView:function(){g=null;this.off();this.remove()}})});