define("underscore backbone backboneCommon ajaxControl command text!template/arena/ArenaFreeRank.html js/view/arena/ArenaPartsView js/view/arena/ArenaInfoPartsView".split(" "),function(g,l,a,f,e,m,h,k){return l.View.extend({events:function(){var c={};c[a.cgti+" .arenaReloadBtn"]=this.matchingReload;return c},initialize:function(){this.template=g.template(m);this.createDom()},render:function(){this.model=f.getPageJson();this.$el.html(this.template({model:this.model}));return this},createDom:function(){a.content.append(this.render().el);
this.matchExpiredAt=Date.parse(this.model.userArenaBattleMatch.expiredAt)/1E3|0;this.accessServerTime=Date.parse(this.model.currentTime)/1E3|0;this.accessClientTime=Date.parse(new Date)/1E3|0;this.createView();a.setGlobalView();e.getBaseData(a.getNativeObj());a.arenaStoryPlay?a.storage.gameUser.toJSON().closeFunctions&&-1<a.storage.gameUser.toJSON().closeFunctions.indexOf("ARENA")?location.href="#/ArenaTop":(a.androidKeyStop=!0,this.arenaStory()):a.storage.userQuestAdventureList.findWhere({adventureId:a.storage.userArenaBattle.toJSON().currentFreeRankClass.storyId})?
a.ready.hide():location.href="#/ArenaTop"},createView:function(){k.prototype.rootView=this;this.infoView=new k;a.doc.getElementById("bpGuageFreeRank").appendChild(this.infoView.render().el);this.createMattingList()},arenaStory:function(){var c=function(){$("#commandDiv").on("nativeCallback",function(b,c){e.startBgm(a.bgm);e.changeBg(a.background);c&&c.isSkipped&&(b={},b.adventureId=String(a.storage.userArenaBattle.toJSON().currentFreeRankClass.storyId),f.ajaxPost(a.linkList.adventureSkip,b,function(b){a.responseSetStorage(b)}));
a.ready.target.className="show";e.setWebView();a.ready.hide();$("#commandDiv").off();a.androidKeyStop=!1});var b={adventureId:String(a.storage.userArenaBattle.toJSON().currentFreeRankClass.storyId)};f.ajaxPost(a.linkList.userQuestAdventureRegist,b,function(b){"error"!==b.resultCode&&(a.responseSetStorage(b),a.arenaStoryPlay=null,setTimeout(function(){e.setWebView(!1);e.startStory(String(a.storage.userArenaBattle.toJSON().currentFreeRankClass.storyId))},500))})};$(a.ready.target).on("webkitAnimationEnd",
function(){$(a.ready.target).off("webkitAnimationEnd");$(a.ready.target).on("webkitAnimationEnd",function(b){"readyFadeOut"==b.originalEvent.animationName&&(a.ready.target.className="")});e.changeBg("web_black.jpg");c()});if(!window.isBrowser)a.addClass(a.ready.target,"preNativeFadeIn");else if(window.isBrowser){var d={adventureId:String(a.storage.userArenaBattle.toJSON().currentFreeRankClass.storyId)};f.ajaxPost(a.linkList.userQuestAdventureRegist,d,function(b){"error"!==b.resultCode&&(a.responseSetStorage(b),
a.arenaStoryPlay=null)});a.androidKeyStop=!1;a.ready.hide()}},createMattingList:function(){var c=this.model.userArenaBattleMatch,d=[];if(c.opponentUserId1){var b={},b=c.opponentUserArenaBattleInfo1;b.userId=c.opponentUserId1;b.difficult="HIGHER"===b.type?2:"SAME"===b.type?1:0;b.battleType=c.arenaBattleType;d.push(b);b=null}c.opponentUserId2&&(b={},b=c.opponentUserArenaBattleInfo2,b.userId=c.opponentUserId2,b.difficult="HIGHER"===b.type?2:"SAME"===b.type?1:0,b.battleType=c.arenaBattleType,d.push(b),
b=null);c.opponentUserId3&&(b={},b=c.opponentUserArenaBattleInfo3,b.userId=c.opponentUserId3,b.difficult="HIGHER"===b.type?2:"SAME"===b.type?1:0,b.battleType=c.arenaBattleType,d.push(b),b=null);d=g.sortBy(d,function(a){return-1*a.difficult});h.prototype.rootView=this;h.prototype.template=g.template($("#arenaParts").text());if(0<d.length){var e=a.doc.createDocumentFragment();g.each(d,function(a,b){a=new h(a);e.appendChild(a.render().el)});a.doc.getElementById("matchingWrap").appendChild(e)}else a.doc.getElementById("matchingWrap").innerHTML=
'\x3cli class\x3d"nomatch"\x3eThere are no opponents available.\x3cbr\x3ePlease try again later.\x3c/li\x3e'},matchingReload:function(c){c.preventDefault();if(!a.isScrolled()){var d=this.matchExpiredAt-this.accessServerTime-((Date.parse(new Date)/1E3|0)-this.accessClientTime);if(0>d)new a.PopupClass({title:"Opponents Changed",content:"Opponents changed due to timeout.\x3cbr\x3eReturn to the Mirrors screen.",decideBtnText:"Mirrors",canClose:!1,popupType:"typeC"},null,function(){$(".decideBtn").on(a.cgti,
function(b){b.preventDefault();a.isScrolled()||($(".decideBtn").off(a.cgti),location.href="#/ArenaTop")})});else{c=d/60|0;d=d-60*c|0;10>d&&(d="0"+d);var b=this;this.reloadPop=new a.PopupClass({title:"Change Opponents",content:"Do you want to use 1 BP to change opponents?\x3cbr\x3e(Opponents will refresh in "+c+":"+d+")",closeBtnText:"Cancel",decideBtnText:"Change",popupType:"typeC"},null,function(){$(".decideBtn").on(a.cgti,function(){a.isScrolled()||($(".decideBtn").off(),a.tapBlock(!0),b.reloadFunc())})},
function(){$(".decideBtn").off()})}}},reloadFunc:function(){var c=this;if(0<a.storage.userStatusList.findWhere({statusId:"BTP"}).toJSON().point)f.ajaxPost(a.linkList.arenaReload,{arenaBattleType:"FREE_RANK"},function(b){a.responseSetStorage(b);c.reCreateView(b)});else{a.tapBlock(!1);new a.PopupClass({title:"Error",content:"Insufficient BP.",closeBtnText:"Cancel",decideBtnText:"Restore"});this.reloadPop=null;var d=function(b){b.preventDefault();a.isScrolled()||(a.doc.removeEventListener(a.cgti,d),
c.infoView.bpCurePop(b))};a.doc.getElementById("popupArea").getElementsByClassName("decideBtn")[0].addEventListener(a.cgti,d)}},reCreateView:function(c){this.model.userArenaBattleMatch=c.userArenaBattleMatch;this.matchExpiredAt=Date.parse(this.model.userArenaBattleMatch.expiredAt)/1E3|0;this.accessServerTime=Date.parse(this.model.userArenaBattleMatch.matchedAt)/1E3|0;this.accessClientTime=Date.parse(new Date)/1E3|0;this.trigger("resetListView");this.createMattingList();e.getBaseData(a.getNativeObj());
this.infoView.afterReload(this.accessServerTime);this.reloadPop.remove();this.reloadPop=null;a.tapBlock(!1)},checkMatchingSpend:function(c){this.matchExpiredAt>c?(this.accessServerTime=c|0,this.accessClientTime=Date.parse(new Date)/1E3|0):new a.PopupClass({title:"Opponents Changed",content:"Opponents changed due to timeout.\x3cbr\x3eReturn to the Mirrors screen.",decideBtnText:"Mirrors",canClose:!1,popupType:"typeC"},null,function(){$(".decideBtn").on(a.cgti,function(){$(".decideBtn").off(a.cgti);
location.href="#/ArenaTop"})})},removeHandler:function(){this.trigger("removeView");this.off();this.remove()}})});