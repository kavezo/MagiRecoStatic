define(["jquery","underscore","backbone"],function(n,v,x){var a={nativeDownload:!1,background:"web_common.ExportJson",bgm:"bgm01_anime07",settingBg:"web_0011.ExportJson",settingBgm:"bgm01_anime07",mainQuestMode:"NORMAL",settingThemeInit:function(){if(a.storage.gameUser){var b=a.storage.gameUser.get("bgItemId"),c=a.storage.gameUser.get("bgItem");b&&c?(a.settingBg=c.backgroundImage,a.settingBgm=c.parameter?c.parameter:"bgm01_anime07"):(a.settingBg="web_0011.ExportJson",a.settingBgm="bgm01_anime07")}else a.settingBg=
"web_0011.ExportJson",a.settingBgm="bgm01_anime07"},resourceUpdated:!1,tutorialId:null,tutorialUtil:null,historyArr:[],doc:document};a.content=n("#mainContent");a.location="";a.imgData={};var H=!1;a.EffectView=x.View.extend({className:"commonEffect",events:function(){var a={};a.webkitAnimationEnd=this.removeView;return a},render:function(){this.$el.html(this.template({model:this.model}));this.el.style.top=this.model.y-128+"px";this.el.style.left=this.model.x-128+"px";return this},removeView:function(){this.remove()}});
a.EffectView.prototype.template=v.template(n("#TapEffect").text());a.getNativeObj=function(){var b={},c=a.doc.querySelectorAll("[data-nativeimgkey]")||[],d=a.doc.querySelectorAll("[data-nativebgkey]")||[];v.each(c,function(c){var e=c.dataset.nativeimgkey;a.imgData[e]||""===e||(b[e]=c.dataset.src)});v.each(d,function(c){var e=c.dataset.nativebgkey;a.imgData[e]||""===e||(b[e]=c.dataset.src)});return b};a.periodCheck=function(a,c){if(!a||!c)return!1;a=a.replace(/-/g,"/");c=c.replace(/-/g,"/");c=new Date(c);
a=(new Date(a)).getTime();return c.getTime()>=a?!1:"end"};a.getClientTime=function(){var a=new Date;return[a.getFullYear(),("0"+(a.getMonth()+1)).slice(-2),("0"+a.getDate()).slice(-2)].join("/")+" "+[("0"+a.getHours()).slice(-2),("0"+a.getMinutes()).slice(-2),("0"+a.getSeconds()).slice(-2)].join(":")};a.getTimeText=function(a,c){a=new Date(a);return c?a.getMonth()+1+"/"+a.getDate()+" "+a.getHours()+":"+("0"+a.getMinutes()).slice(-2):a.getMonth()+1+"/"+a.getDate()+" "+a.getHours()+":"+("0"+a.getMinutes()).slice(-2)+
""};a.live2dDetail=function(a){var b={};if(a){if(a.live2dDetail){var d=a.live2dDetail.split("");b.motionId=Number(d[0]+d[1]);b.faceId=String(d[2]+d[3]+d[4]);8==a.live2dDetail.split("").length?(b.cheekId=Number(d[5]+d[6]),b.tearId=Number(d[7])):(b.cheekId=Number(d[5]),b.tearId=Number(d[6]))}else b={};b.voice="vo_char_"+a.charaNo+"_"+a.messageId;return b}};a.sfml=JSON.parse(localStorage.getItem("SortFilterMemoryList"))||{};a.sfm=function(){localStorage.setItem("SortFilterMemoryList",JSON.stringify(a.sfml));
a.sfml=JSON.parse(localStorage.getItem("SortFilterMemoryList"))};a.miniCharaStandPose=localStorage.getItem("miniCharaStandPose")||"wait";a.questBattleModel=null;a.questSupportModel=null;a.addBackHandler=function(b){if(b&&a.doc.getElementById("globalBackBtn")){a.eventBackHandler=!0;var c=a.doc.getElementById("globalBackBtn");c.setAttribute("data-noLink","true");n(c).off(a.cgti);n(c).on(a.cgti,b)}};a.removeBackHandler=function(){a.eventBackHandler=!1;if(a.doc.getElementById("globalBackBtn")){var b=
a.doc.getElementById("globalBackBtn");b.setAttribute("data-noLink","")}n(b).off(a.cgti)};var L={GachaTop:["navi_011","navi_012_b"],CharaListTop:["navi_021_a"],CharaListCustomize:["navi_031"],CharaListComposeMagia:["navi_041"],CharaListEquip:["navi_051_a","navi_052_a"],MemoriaTop:["navi_061"],ArenaTop:["navi_071_b"],FormationSupport:["navi_081_b"],FormationTop:["navi_091_a","navi_092_a","navi_093","navi_094"],SubQuest:["navi_101"],MemoriaSetList:["navi_111"],MemoriaSetEquip:["navi_121"],CharaQuest:["navi_131"]};
a.firstNaviCheck=function(b){b&&b.firstNavi&&require(["js/view/tutorial/TutorialPopupView"],function(b){var c,h=L[a.location];h&&new a.PopupClass({popupType:"tutorial"},null,function(){b.prototype.parentView=this;c=new b({imgArr:h,type:"tutorial"});a.doc.getElementsByClassName("popupInner")[0].appendChild(c.render().el)},function(){c.removeView()})})};a.eventFirstNavi=function(b,c,d,h,e){b&&c&&d&&require(["js/view/tutorial/TutorialPopupView"],function(k){var g;new a.PopupClass({popupType:"tutorial"},
null,function(){k.prototype.parentView=this;g=new k({imgArr:b,type:"event",eventId:c,eventType:d,callback:h,eventDetail:e});a.doc.getElementsByClassName("popupInner")[0].appendChild(g.render().el)},function(){g.removeView()})})};a.campaignParse=function(a){var b={};v.each(a,function(a,c){switch(a.campaignType){case "POINT_UP":var e={campaignId:a.id,CARD_COMPOSE:{},EXPP:{},YELL:{},EXPC:{},CC:{},EP:{},pointUpType:[],globalBadge:!1};v.each(a.parameterMap,function(a,b){-1!==b.indexOf("CARD_COMPOSE_")&&
(e.CARD_COMPOSE[b.split("CARD_COMPOSE_")[1]]=(a|0)/1E3);-1!==b.indexOf("EXPP_")&&(e.EXPP[b.split("EXPP_")[1]]=(a|0)/1E3,e.pointUpType.push(b.split("EXPP_")[1]),"ALL"===b.split("EXPP_")[1]&&(e.globalBadge=!0));-1!==b.indexOf("YELL_")&&(e.YELL[b.split("YELL_")[1]]=(a|0)/1E3,e.pointUpType.push(b.split("YELL_")[1]),"ALL"===b.split("YELL_")[1]&&(e.globalBadge=!0));-1!==b.indexOf("EXPC_")&&(e.EXPC[b.split("EXPC_")[1]]=(a|0)/1E3,e.pointUpType.push(b.split("EXPC_")[1]),"ALL"===b.split("EXPC_")[1]&&(e.globalBadge=
!0));-1!==b.indexOf("CC_")&&(e.CC[b.split("CC_")[1]]=(a|0)/1E3,e.pointUpType.push(b.split("CC_")[1]),"ALL"===b.split("CC_")[1]&&(e.globalBadge=!0));-1!==b.indexOf("EP_")&&(e.EP[b.split("EP_")[1]]=(a|0)/1E3,e.pointUpType.push(b.split("EP_")[1]),"ALL"===b.split("EP_")[1]&&(e.globalBadge=!0))});b[a.campaignType]=e;break;case "HALF_AP":e={campaignId:a.id,questType:[],chapterIds:[],bgImgPath:""};e.questType=a.parameterMap.TARGET_QUEST_TYPES.split(",");e.chapterIds=a.parameterMap.TARGET_GENERIC_IDS?a.parameterMap.TARGET_GENERIC_IDS.split(","):
[];e.bgImgPath="url(/magica/resource/image_web/campaign/half_ap/"+e.campaignId+"/global_icon.png) left top no-repeat";b[a.campaignType]=e;break;case "ARENA_REWARD_UP":e={campaignId:a.id,magnification:a.parameterMap.ARENA_REWARD_UP|0};b[a.campaignType]=e;break;case "BOX_GACHA":e={campaignId:a.id,bannerImgPath:a.parameterMap.MYPAGE_BANNER_IMAGE};b[a.campaignType]=e;break;case "FREE_AT_NOT_CLEAR":e={campaignId:a.id,questType:[],chapterIds:[],sectionIds:[]},e.questType=a.parameterMap.TARGET_QUEST_TYPES?
a.parameterMap.TARGET_QUEST_TYPES.split(","):[],e.chapterIds=a.parameterMap.TARGET_GENERIC_IDS?a.parameterMap.TARGET_GENERIC_IDS.split(","):[],e.sectionIds=a.parameterMap.TARGET_SECTION_IDS?a.parameterMap.TARGET_SECTION_IDS.split(","):[],b[a.campaignType]=e}});return b};a.storyPlayCheck=function(b,c,d){if(!b||!c)return!1;var h=!0;d=d||a.storage.userQuestAdventureList.toJSON();v.each(d,function(a){b===a.adventureId&&(h=!1)});h?(n(a.ready.target).off(),n(a.ready.target).on("webkitAnimationEnd",function(){cmd.changeBg("web_black.jpg");
n(a.ready.target).off();n(a.ready.target).on("webkitAnimationEnd",function(b){"readyFadeOut"==b.originalEvent.animationName&&(a.ready.target.className="")});ajaxControl.ajaxPost(a.linkList.userQuestAdventureRegist,{adventureId:String(b)},c.bind(null,!0))}),a.ready.target.classList.contains("preNativeFadeIn")?n(a.ready.target).trigger("webkitAnimationEnd"):a.addClass(a.ready.target,"preNativeFadeIn")):c(!1)};a.storage={};a.storageType={user:"model",userList:"model",gameUser:"model",itemList:"collection",
giftList:"collection",pieceList:"collection",userStatusList:"collection",userCharaList:"collection",userCardList:"collection",userDoppelList:"collection",userDeckList:"collection",userPieceList:"collection",userPieceSetList:"collection",userLive2dList:"collection",userItemList:"collection",userGiftList:"collection",userFollowList:"collection",userFormationSheetList:"collection",userQuestAdventureList:"collection",userArenaBattle:"model",userChapterList:"collection",userSectionList:"collection",userQuestBattleList:"collection",
presentList:"collection",userDailyChallengeList:"collection",userTotalChallengeList:"collection",userLimitedChallengeList:"collection"};a.checkStorageType=function(b){return a.storageType[b]||null};a.setStorage=function(b,c){a.storage[c]={};a.storage[c]=b};a.hasModel=function(b){return a.storage[b]?!0:!1};a.responseSetStorage=function(b){for(var c in b)if("resultCode"!=c)if(b[c]instanceof Array)if(a.hasModel(c))v.each(b[c],function(b,d,g){var e;b.id?e={id:b.id}:b.itemId?e={itemId:b.itemId}:b.statusId?
e={statusId:b.statusId}:b.charaId?e={charaId:b.charaId}:b.challengeId?e={challengeId:b.challengeId}:b.giftId?e={giftId:b.giftId}:b.chapterId?e={chapterId:b.chapterId}:b.sectionId?e={sectionId:b.sectionId}:b.questBattleId?e={questBattleId:b.questBattleId}:b.areaMapId?e={areaMapId:b.areaMapId}:b.followUserId?e={followUserId:b.followUserId}:b.deckType?e={deckType:b.deckType}:b.doppelId?e={doppelId:b.doppelId}:b.formationSheetId?e={formationSheetId:b.formationSheetId}:b.adventureId?e={adventureId:b.adventureId}:
b.setNum&&(e={setNum:b.setNum});"pieceList"===c?e={pieceId:b.pieceId}:"itemList"===c?e={itemCode:b.itemCode}:"userLive2dList"==c&&(e.charaId=b.charaId,e.live2dId=b.live2dId);(d=a.storage[c].findWhere(e))?"userFollowList"!==c?(d.clear({silent:!0}),d.set(b)):!b.inviteCode&&b.recentUsedAt?(d.set({recentUsedAt:b.recentUsedAt}),console.log("common.storage[userFollowList]",a.storage.userFollowList.toJSON())):(d.clear({silent:!0}),d.set(b)):a.storage[c].add(b)});else{var d=c,h=new (x.Collection.extend({url:a.linkList[d]}))(b[c]);
a.setStorage(h,d)}else a.storage[c]?a.storage[c].set(b[c]):(d=c,h=new (x.Model.extend({url:a.linkList[d]}))(b[c]),a.setStorage(h,d))};a.refreshStorage=function(){a.storage={}};a.loading={};a.loading.target=a.doc.getElementById("loading");a.loading.hide=function(){setTimeout(function(){a.androidKeyForceStop=!1},500);a.loading.target.style.display="none"};a.loading.show=function(){a.androidKeyForceStop=!0;a.loading.target.style.display="block"};a.ready={};a.ready.target=a.doc.getElementById("ready");
a.ready.content=a.doc.getElementById("baseContainer");a.ready.hide=function(){(n(a.ready.target).hasClass("show")||n(a.ready.target).hasClass("fadein")||n(a.ready.target).hasClass("preNativeFadeIn"))&&setTimeout(function(){a.ready.target.className="fadeout";a.androidKeyForceStop=!1},100);n(a.ready.target).hasClass("tutorialStart")&&setTimeout(function(){a.ready.target.className="tutorialStartFadeout";a.androidKeyForceStop=!1},100);n(a.ready.target).hasClass("gameStartFadeIn")&&setTimeout(function(){a.ready.target.className=
"gameStartFadeOut";a.androidKeyForceStop=!1},100);n(a.ready.content).hasClass("fadeout")&&setTimeout(function(){a.removeClass(a.ready.content,"fadeout");a.addClass(a.ready.content,"fadein");a.androidKeyForceStop=!1},300)};a.ready.show=function(){H||(""===a.doc.getElementsByTagName("html")[0].style.height&&0!==window.innerHeight&&(a.doc.getElementsByTagName("html")[0].style.height=window.innerHeight+"px",H=!0),a.ua.ios?a.addClass(a.doc.getElementsByTagName("body")[0],"ios"):a.addClass(a.doc.getElementsByTagName("body")[0],
"android"));a.androidKeyForceStop=!0;a.removeClass(a.ready.content,"fadein");a.addClass(a.ready.content,"fadeout");a.tapBlock(!0)};a.tapBlock=function(b){b&&!a.tutorialId?(a.doc.querySelector("#tapBlock").style.display="block",a.addClass(a.doc.getElementById("globalBackBtn"),"off")):setTimeout(function(){b?(a.doc.querySelector("#tapBlock").style.display="block",a.addClass(a.doc.getElementById("globalBackBtn"),"off")):(a.doc.querySelector("#tapBlock").style.display="",a.removeClass(a.doc.getElementById("globalBackBtn"),
"off"))},a.tutorialId&&!b?1E3:10)};var l=function(){for(var a=navigator.userAgent.toLowerCase(),c=0;c<arguments.length;c++)if(a.match(arguments[c])||"ipad"===arguments[c]&&"MacIntel"===window.clientInformation.platform&&"undefined"!==typeof document.ontouchstart)return!0;return!1};a.ua={ios:l("ipad","iphone","ipod"),ios6:l("iphone os 6_"),ios7:l("iphone os 7_"),ipad:l("ipad"),ipod:l("ipod"),android:l("android"),isAndroidOs5:l("android 5"),isAndroidOs4_4:l("android 4.4"),isAndroidOs4_2:l("android 4.2"),
isAndroidOs4_1:l("android 4.1"),isGalaxyNote:l("sc-02e","sc-01g","sc-05d","scl22","scl24","sc-01f"),isGalaxysTab:l("sc-01e"),isGalaxys2:l("isw11sc","sc-02c","sc-03d"),isGalaxys3:l("sc-03e","sc-06d","scl21"),isGalaxyNote2:l("sc-02e"),isGalaxys3a:l("sc-03e"),isGalaxyJ:l("sc-02f"),isXperia:l("is11s","is12s","so-01b","so-01c","so-01e","so-02e","so-03d","sol21","sol22"),isXperiaAX:l("so-01e"),isArrows:l("f-05d","f-10d","fjl"),isEluga:l("p-02e"),isINFOBAR_A02:l("htx21"),isNexus6:l("nexus 6"),isNexus:l("nexus 6",
"nexus 5"),isNexus5x:l("nexus 5x"),isSO_04E:l("so-04e"),isLowAnimeRate:l("201f","201m","202f","203sh","206sh","301f","302hw","302sh","303sh","403sc","404kc","asus_t00p","dm015k","f-01f","f-02e","f-02f","f-04e","f-05e","f-06e","fjl22","htl21","htl22","htl23","l-01e","l-04e","l-05d","l-05e","lgl24","lgv31","n-02e","n-03e","n-04e","n-06e","nexus 10","nexus 7","p-02e","p-03e","sc-01f","sc-01g","sc-02e","sc-02f","sc-03e","sc-04e","sc-06d","scl22","scl24","sh-02e","sh-02f","sh-04f","sh-05f","sh-06e","sh-08e",
"shl21","shl22","shl23","so-01e","so-04d","sol21","wx10k")};a.ua.ios&&(a.ua.iosVersion=parseInt(navigator.userAgent.toLowerCase().split("os ")[1].substr(0,1)),l("iphone")&&480==screen.availWidth&&320==screen.availHeight?a.ua.iphone4=!0:3==window.devicePixelRatio&&(a.ua.iphone6plus=!0));l=null;a.setPlatForm=function(b){b&&b.currentPlatform&&(a.thisPlatform=b.currentPlatform)};a.setStyle=function(b){a.doc.getElementById("headStyle").innerHTML=b};var A=0,B=0,D=0,p=0,u=0,F=0,G=0;a.doc.addEventListener("touchstart",
function(a){B=A=0;F=a.changedTouches[0].clientX;G=a.changedTouches[0].clientY;D=a.touches.length},!0);a.doc.addEventListener("touchend",function(a){p=F-a.changedTouches[0].clientX;u=G-a.changedTouches[0].clientY;p=0>p?-p:p;u=0>u?-u:u;B=0<u-p?u:p;1>a.touches.length&&(D=0);(new Date).getTime()},!0);a.doc.addEventListener("touchmove",function(a){A+=1;p=F-a.changedTouches[0].clientX;u=G-a.changedTouches[0].clientY;p=0>p?-p:p;u=0>u?-u:u;B=0<u-p?u:p;"range"!==a.target.type&&a.preventDefault()},{useCapture:!0,
passive:!1});a.androidResetHandler=function(){B=A=0};a.isScrolled=function(){return 20<A?!0:16>B?!1:!0};a.isTouching=function(){return 0<D?!0:!1};a.isDoubleTouch=function(){return 1<D?!0:!1};a.cgti=!a.ua.ios&&!a.ua.android||a.ua.isGalaxys2||a.ua.isGalaxys3?"click":"touchend";a.g_popup_instance=null;a.popupArea=a.doc.querySelector("#popupArea");n("#popupCurtain").on(a.cgti,function(){this.classList.contains("tapBlock")||a.g_popup_instance&&a.g_popup_instance.remove()});a.PopupClass=function(b,c,d,
h){var e=x.Model.extend();null!==a.g_popup_instance&&a.g_popup_instance.remove();a.g_popup_instance=this;this.popupView=null;this.temp=c?c:a.doc.getElementById("popupTemp").textContent;b.canClose=void 0===b.canClose?!0:b.canClose;this.popupModel=new e(b);this.callback=d;this.closeEvent=h;this.popupType=this.popupModel.get("popupType")||"typeA";this.exClass=this.popupModel.get("exClass")||"";this.simple=this.popupModel.get("simple")?"simpleAppear":"";this.showCurtain=void 0===this.popupModel.get("showCurtain")?
!0:this.popupModel.get("showCurtain");this.decideBtnLink=b.decideBtnLink;this.decideBtnEvent=b.decideBtnEvent;this.open()};a.PopupClass.prototype.open=function(){var b=this;this.popupView=new (x.View.extend({model:b.popupModel,className:"popupContent open "+this.popupType+" "+this.exClass+" "+this.simple,id:this.popupModel.get("popupId"),initialize:function(a){this.template=v.template(b.temp)},events:function(){var b={};b[a.cgti+" .popupCloseBtn"]=this.close;b.animationend=this.nextAnimation;b.webkitAnimationEnd=
this.nextAnimation;b.webkitTransitionEnd=this.nextAnimation;return b},render:function(){this.$el.html(this.template({model:this.model.toJSON()}));this.model.toJSON().decideBtnLink&&(this.el.querySelector(".decideBtn").dataset.href=this.model.toJSON().decideBtnLink,a.addClass(this.el.querySelector(".decideBtn"),"linkBtn"));if(this.model.toJSON().decideBtnEvent){var b=this,c=this.el.querySelector(".decideBtn");n(c).on(a.cgti,function(a){b.model.toJSON().decideBtnEvent(a)})}return this},close:function(b){b&&
b.preventDefault();a.isScrolled()||(a.removeClass(this.el,"open"),a.addClass(this.el,"close"),a.popupCloseBtn=!0,a.helpPopup&&a.helpPopup.removeHandler())},nextAnimation:function(a){a.currentTarget.classList.contains("close")&&b.remove()}}));if(this.callback){var c=new MutationObserver(function(){c.disconnect();!b.callback||b.callback&&"function"!==typeof b.callback||b.callback()}),d=a.doc.getElementById("popupArea");c.observe(d,{attributes:!1,childList:!0,characterData:!1})}n("#popupArea").append(this.popupView.render().el);
this.showCurtain&&a.addClass(a.doc.getElementById("popupCurtain"),"show");this.canClose||a.addClass(a.doc.getElementById("popupCurtain"),"tapBlock");this.popupModel.get("param")&&(d=this.popupModel.get("param"),this.popupView.$el.find(".popupInner").css(d),d=null)};a.PopupClass.prototype.remove=function(){if(""!==a.popupArea.className){var b=new Event(a.popupArea.className+"Close");a.popupArea.dispatchEvent(b);a.popupArea.className=""}a.doc.getElementById("popupCurtain").className="";this.popupView&&
this.popupView.remove();this.popupModel&&this.popupModel.clear();this.temp=this.popupModel=this.popupView=this.callback=null;a.g_popup_instance=null;if(this.closeEvent&&a.popupCloseBtn&&("function"==typeof this.closeEvent&&this.closeEvent(),"object"==typeof this.closeEvent))this.closeEvent[0](this.closeEvent[1]);this.closeEvent=null;a.popupCloseBtn=null};a.addClass=function(a,c){if(a)if(Array.isArray(c))for(var b in c)a.classList.contains(c[b])||a.classList.add(c[b]);else a.classList.contains(c)||
a.classList.add(c)};a.removeClass=function(a,c){if(a)if(Array.isArray(c))for(var b in c)a.classList.contains(c[b])&&a.classList.remove(c[b]);else a.classList.contains(c)&&a.classList.remove(c)};a.responseCheck=function(a){return"error"==a.resultCode?(this.errorFunc(a.errorTxt,a.errorLink),!1):"redirect"==a.resultCode?(location.href=a.pageLink,!1):!0};a.errorFunc=function(a,c){function b(){n("#commonJsErrorLinkBtn").off(cgti,b);c?location.href=c:popupClose("commonJsErrorPopup")}n("#loading").css("display",
"none");document.getElementById("commonJsErrorCautionText").textContent=a;n("#commonJsErrorLinkBtn").on(cgti,b);popupStart("commonJsErrorPopup")};a.getTotalStone=function(){var b=a.storage.userItemList.findWhere({itemId:"MONEY"}),c=a.storage.userItemList.findWhere({itemId:"PRESENTED_MONEY"}),b=b?b.get("quantity"):0,c=c?c.get("quantity"):0;return{totalMoney:b+c,userMoney:b,presentedMoney:c}};a.scrollBarDisp=function(b){if(a.ua.ios)require(["js/libs/iscroll5"],function(){a.myScroll||(a.myScroll=[],
a.setScrollArray=[]);if(Array.isArray(b))for(var c in b)-1===a.setScrollArray.indexOf(b[c])&&(a.myScroll[a.myScroll.length]=new IScroll(b[c],{mouseWheel:!0,scrollbars:!0,fadeScrollbars:!0}),a.setScrollArray[a.setScrollArray.length]=b[c]);else-1===a.setScrollArray.indexOf(b)&&(a.myScroll[a.myScroll.length]=new IScroll(b,{mouseWheel:!0,scrollbars:!0,fadeScrollbars:!0}),a.setScrollArray[a.setScrollArray.length]=b)});else for(var c=a.doc.getElementsByClassName("scrollBar"),d=0,h=c.length;d<h;d++)c[d].style=
"overflow-y:scroll;height:100%;"};a.scrollBarControl=function(b,c){if(a.ua.ios&&a.myScroll){if(Array.isArray(a.myScroll))for(var d=0,h=a.myScroll.length;d<h;d++)"refresh"==b&&(a.myScroll[d].refresh(),c&&a.myScroll[d].scrollTo(0,0)),"destroy"==b&&a.myScroll[d].destroy();else"refresh"==b&&(a.myScroll.refresh(),c&&a.myScroll.scrollTo(0,0)),"destroy"==b&&a.myScroll.destroy();"destroy"==b&&(a.myScroll=null,a.setScrollArray=null)}};a.backLinkHandler=function(){a.androidKeyForceStop=!0;if("MyPage"!==a.location&&
""!==a.location&&"#/TopPage"!==a.location&&(!a.tutorialId||"TU520"===a.tutorialId))if(a.backlinkTimer&&1001>(new Date).getTime()-a.backlinkTimer)a.androidKeyForceStop=!1;else if(a.backlinkTimer=(new Date).getTime(),!a.eventBackHandler){var b=!0,c=location.hash;v.each("QuestBackground GachaResult MemoriaComposeResult MemoriaEquip MemoriaSetEquip EventTrainingCharaSelect".split(" "),function(a,e){console.log("nowHash",c.split("/")[1]);-1!==c.indexOf(a)&&(b=!1)});var d=!1;v.each(["QuestBackground","QuestResult",
"ArenaResult","MyPage"],function(a,b){-1<c.indexOf(a)&&(d=!0)});if(d)a.androidKeyForceStop=!1;else{var h=!1;v.each("CharaListTop MemoriaTop GachaTop MissionTop ShopTop FormationTop MainQuest ArenaTop CollectionTop ItemListTop Help ConfigTop PresentList EventDungeonMap".split(" "),function(a,b){-1<c.indexOf(a)&&c.split("/")[1]==a&&(h=!0)});a.scrollBarControl("destroy");if(h)a.historyArr=[],location.href="#/MyPage";else{var e="";b?(a.locationPrev=a.historyArr[a.historyArr.length-1],a.historyArr.splice(a.historyArr.length-
1,1),1<a.historyArr.length?(a.doc.getElementById("sideMenu")&&(a.doc.querySelector("#sideMenu").className=""),a.tapBlock(!0),-1===location.hash.indexOf("PresentHistory")?location.href="#/"+a.historyArr[a.historyArr.length-1]:-1<a.historyArr[a.historyArr.length-1].indexOf("GachaTop")?(a.gachaDisp&&(e="/"+a.gachaDisp),location.href="#/GachaTop"+e):location.href="#/"+a.historyArr[a.historyArr.length-1]):location.href="#/MyPage"):a.historyArr[a.historyArr.length-1]?(a.doc.getElementById("sideMenu")&&
(a.doc.querySelector("#sideMenu").className=""),a.tapBlock(!0),-1!==location.hash.indexOf("GachaResult")?(a.gachaDisp&&(e="/"+a.gachaDisp),location.href="#/GachaTop"+e):location.href="#/"+a.historyArr[a.historyArr.length-1]):location.href="#/MyPage"}}}};var I=!1;a.setGlobalView=function(b){I||setTimeout(function(){a.setGlobalView(b)},100)};require(["GlobalView"],function(b){I=!0;a.setGlobalView=function(c){"LoginBonus"!==a.historyArr[a.historyArr.length-1]&&(a.globalMenuView?a.globalMenuView.trigger("optionSet",
c):a.globalMenuView=new b(c),a.globalMenuView.addCampaignBanner(),a.globalMenuView.addCampaignBadge(),a.globalMenuView.addEventBadge(),"#/MyPage"===location.hash&&a.addClass(a.doc.getElementById("sideMenu"),"anim"))}});a.setHelpPopup=function(b,c){a.tapBlock(!0);require(["HelpPopup"],function(d){a.tapBlock(!1);a.helpPopup=new d(b,c)})};a.itemSet=function(b){function c(a){switch(-1!==String(a).indexOf("RANK_")?a.split("_")[1]|0:a){case 1:return"BRONZE";case 2:return"SILVER";default:return"GOLD"}}if("MISS"!=
b){var d,h={};v.each("RICHE_ ITEM_ CARD_ PIECE_ MAXPIECE_ GIFT_ EVENTITEM_ GACHAEVENTITEM_ GEM_ LIVE2D_ DOPPEL_ FORMATIONSHEET_ EVENTEFFECT_".split(" "),function(a){-1!==b.indexOf(a)&&(d=a.split("_")[0])});var e=b.split("_"),k;switch(d){case "RICHE":h.itemCode="riche";h.quantity=Number(e[e.length-1]);h.chestColor="BRONZE";h.rewardType="RICHE";break;case "ITEM":k="";h.quantity=Number(e[e.length-1]);e.shift();e.pop();v.each(e,function(a,b){0!==b&&(a="_"+a);k+=a});h.itemCode=k;e=(e=a.storage.itemList.findWhere({itemCode:k}))?
e.toJSON().treasureChestColor:"BRONZE";"GOLD"==e||"SILVER"==e||"BRONZE"==e?h.chestColor=e:"ADDED_DROP"==e&&(h.chestColor="ADDED_DROP");h.rewardType="ITEM";break;case "GIFT":k="";h.quantity=Number(e[e.length-1]);e.pop();v.each(e,function(a,b){0!==b&&(a="_"+a);k+=a});h.itemCode="item_"+k.toLowerCase();e=k.split("_")[1]|0;e=a.storage.giftList.findWhere({id:e});h.chestColor=e?c(e.toJSON().rank):"BRONZE";h.rewardType="GIFT";break;case "LIVE2D":e.pop();e.shift();h.itemCode=e[0];h.chestColor="GOLD";h.rewardType=
"LIVE2D";break;case "DOPPEL":e.shift();h.itemCode=e[0];h.chestColor="GOLD";h.rewardType="DOPPEL";break;case "PIECE":case "MAXPIECE":1<Number(e[e.length-1])&&(h.quantity=Number(e[e.length-1]));e.pop();e.shift();h.itemCode="memoria_"+e[0]+"_s";e=a.storage.pieceList.findWhere({pieceId:e[0]|0});h.chestColor=e?c(e.toJSON().rank):"BRONZE";h.rewardType="PIECE";break;case "GEM":e.pop();e.shift();h.itemCode="chara_"+e[0]+"_h";h.chestColor="GOLD";h.rewardType="GEM";break;case "EVENTEFFECT":e.pop();e.shift();
e.shift();e=e.join("_");h.effectItemCode=e;h.rewardType="EVENTEFFECT";break;case "CARD":e=a.storage.userCardList.findWhere({cardId:Number(e[1])}),h.cardModel=e.toJSON(),h.rewardType="CARD"}return h}};a.getApRemainTime=function(a,c,d){c=c.point-a.point;return 0>=c?0:a.checkPeriod*c*60+Date.parse(a.checkedAt)/1E3-Date.parse(d)/1E3};a.scrollSet=function(b,c){if(a.doc.getElementById(b)&&!(1>a.doc.getElementById(b).getElementsByClassName(c).length)){var d=a.location;a.scrollArr||(a.scrollArr={});a.scrollArr[b+
c+d]||(a.scrollArr[b+c+d]={});a.scrollArr[b+c+d].targetId=b;a.scrollArr[b+c+d].innerClass=c;a.scrollArr[b+c+d].thisPage=d;a.scrollArr[b+c+d].scrollbarPositionBase=0;a.scrollArr[b+c+d].touchScrollBarPosition=0;a.scrollArr[b+c+d].stopVelocity=!1;var h,e,k,g=!1;a.ua.ios?(h=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a){g=window.setInterval(a,17)},e=window.cancelAnimationFrame||
window.mozCancelAnimationFrame||function(a){window.clearInterval(g);g=!1}):(h=function(a){g=window.setInterval(a,17)},e=function(a){window.clearInterval(g);g=!1});a.scrollArr[b+c+d].touchStartNum=0;var f=a.scrollArr[b+c+d].scrollCount=0,m=0,r=null,E=a.doc.getElementById(b);a.scrollArr[b+c+d].domHeight=E.offsetHeight;var q=a.doc.getElementById(b).getElementsByClassName(c)[0];a.scrollArr[b+c+d].limit=q.offsetHeight;a.doc.getElementsByTagName("body");var l=q.style.cssText?q.style.cssText:"";a.scrollArr[b+
c+d].defaultCss=l;var n=!1;if(1>a.doc.getElementById(b).getElementsByClassName("scrollIndicator").length){var J=a.doc.createElement("div"),w=a.doc.createElement("div");J.className="scrollIndicator";w.className="scrollIndicatorInner";a.doc.getElementById(b).appendChild(J);a.doc.getElementById(b).getElementsByClassName("scrollIndicator")[0].appendChild(w)}"static"===window.getComputedStyle(a.doc.getElementById(b)).position&&(a.doc.getElementById(b).style.position="relative");"static"===window.getComputedStyle(a.doc.getElementById(b).getElementsByClassName(c)[0]).position&&
(a.doc.getElementById(b).getElementsByClassName(c)[0].style.position="relative");var t=a.doc.getElementById(b).getElementsByClassName("scrollIndicatorInner")[0];a.scrollArr[b+c+d].scrollBarHeight=Math.round(a.scrollArr[b+c+d].domHeight*a.scrollArr[b+c+d].domHeight/a.scrollArr[b+c+d].limit);t.style.height=a.scrollArr[b+c+d].scrollBarHeight+"px";var v=a.ua.ios?!0:!1,y=function(e){if(v)return a.scrollArr[b+c+d].scrollbarPositionBase=e,t.style.cssText="height:"+a.scrollArr[b+c+d].scrollBarHeight+"px;-webkit-transform:translateY("+
Math.round(e/a.scrollArr[b+c+d].limit*-a.scrollArr[b+c+d].domHeight)+"px) translateZ(0);","-webkit-transform:translateY("+e+"px) translateZ(0);";a.scrollArr[b+c+d].scrollbarPositionBase=e;t.style.cssText="height:"+a.scrollArr[b+c+d].scrollBarHeight+"px;-webkit-transform:translate3d(0,"+Math.round(e/a.scrollArr[b+c+d].limit*-a.scrollArr[b+c+d].domHeight)+"px,0);";return"-webkit-transform:translate3d(0,"+e+"px,0);"},z,C,K=function(){if(n||!x||!q||!a.doc.getElementById(b)||!a.scrollArr[b+c+d]||a.scrollArr[b+
c+d].thisPage!==a.location||a.forceScrollFlag||a.scrollArr[b+c+d].stopVelocity)e(k);else if(!(1>a.doc.getElementById(b).getElementsByClassName(c).length)){var f=(new Date).getTime()-r;a.scrollArr[b+c+d].touchStartNum=a.scrollArr[b+c+d].scrollCount;a.scrollArr[b+c+d].scrollCount=a.scrollArr[b+c+d].scrollCount+m|0;m=((1700-f)/1700*m*100|0)/100;if(0>a.scrollArr[b+c+d].scrollCount&&-a.scrollArr[b+c+d].scrollCount<z)q.style.cssText=l+y(a.scrollArr[b+c+d].scrollCount);else{if(0<=a.scrollArr[b+c+d].scrollCount){q.style.cssText=
l+y(0);a.scrollArr[b+c+d].touchStartNum=0;a.removeClass(t,"onScroll");a.removeClass(a.doc.getElementById(b).getElementsByClassName(c)[0],"scrollWillChange");e(k);return}if(-a.scrollArr[b+c+d].scrollCount>=z){a.scrollArr[b+c+d].touchStartNum=C;q.style.cssText=l+y(a.scrollArr[b+c+d].touchStartNum);a.removeClass(t,"onScroll");a.removeClass(a.doc.getElementById(b).getElementsByClassName(c)[0],"scrollWillChange");e(k);return}}if(!n&&q&&a.doc.getElementById(b)&&a.scrollArr[b+c+d]){var E=0>m?-m:m;1700>f&&
0<E?g||(k=h(K)):(a.removeClass(t,"onScroll"),a.removeClass(a.doc.getElementById(b).getElementsByClassName(c)[0],"scrollWillChange"),e(k))}else e(k)}},p=!1,u=!1,x=!1,B=null;a.doc.getElementById(b).getElementsByClassName(c)[0].addEventListener("touchstart",function(d){a.isDoubleTouch()?e(k):(p=!1,B=null,n=!0,u=x=!1,k&&e(k),f=d.changedTouches[0].clientY,m=0,!a.doc.getElementById(b)||1>a.doc.getElementById(b).getElementsByClassName(c).length||(d=a.location,a.scrollArr[b+c+d]&&a.location===a.scrollArr[b+
c+d].thisPage&&(a.addClass(a.doc.getElementById(b).getElementsByClassName(c)[0],"scrollWillChange"),a.scrollArr[b+c+d].stopVelocity=!1,z=a.scrollArr[b+c+d].limit-a.scrollArr[b+c+d].domHeight,C=-a.scrollArr[b+c+d].limit+a.scrollArr[b+c+d].domHeight,B=(new Date).getTime(),p=!0)))},!0);var A=null;a.doc.getElementById(b).getElementsByClassName(c)[0].addEventListener("touchmove",function(h){if(a.isDoubleTouch()||a.androidKeyForceStop||!p||!a.doc.getElementById(b)||1>a.doc.getElementById(b).getElementsByClassName(c).length)e(k);
else{!u&&a.detailPopup&&(u=!0,1>a.doc.querySelectorAll("#memoriaDetailWrap #"+b).length&&(p=!1));var g=a.scrollArr[b+c+d].touchStartNum+(h.changedTouches[0].clientY-f);if(!x){if(10>(0>g?-g:g))return;a.addClass(t,"onScroll");x=!0}h.preventDefault();A=(new Date).getTime();m=-(a.scrollArr[b+c+d].scrollCount-g)|0;a.scrollArr[b+c+d].scrollCount=g|0;0>a.scrollArr[b+c+d].scrollCount&&-a.scrollArr[b+c+d].scrollCount<z&&(q.style.cssText=l+y(a.scrollArr[b+c+d].scrollCount));0<=a.scrollArr[b+c+d].scrollCount?
(a.scrollArr[b+c+d].scrollCount=0,a.scrollArr[b+c+d].touchStartNum=0,q.style.cssText=l+y(0)):-a.scrollArr[b+c+d].scrollCount>=z&&(a.scrollArr[b+c+d].scrollCount=C,a.scrollArr[b+c+d].touchStartNum=C,q.style.cssText=l+y(a.scrollArr[b+c+d].touchStartNum))}},!0);a.doc.getElementById(b).getElementsByClassName(c)[0].addEventListener("touchend",function(g){n=!1;if(p)if(p=!1,a.isDoubleTouch())e(k);else if(E&&q&&a.doc.getElementById(b)&&!(1>a.doc.getElementById(b).getElementsByClassName(c).length)&&a.scrollArr[b+
c+d]&&a.scrollArr[b+c+d].thisPage===a.location)if(0>a.scrollArr[b+c+d].scrollCount&&-a.scrollArr[b+c+d].scrollCount<z){a.scrollArr[b+c+d].touchStartNum=a.scrollArr[b+c+d].scrollCount;var l=(new Date).getTime();!A||200<l-A?m=0:A&&200>l-B&&(l=a.scrollArr[b+c+d].domHeight/a.scrollArr[b+c+d].limit*a.scrollArr[b+c+d].limit,l=(0>g.changedTouches[0].clientY-f?-(g.changedTouches[0].clientY-f):g.changedTouches[0].clientY-f)>(0>l?-l:l)?0<g.changedTouches[0].clientY-f?l:-l:g.changedTouches[0].clientY-f,m=l/
4|0);1<(0>m?-m:m)?(r=(new Date).getTime(),k=h(K)):(a.removeClass(a.doc.getElementById(b).getElementsByClassName(c)[0],"scrollWillChange"),a.removeClass(t,"onScroll"))}else 0<=a.scrollArr[b+c+d].scrollCount?(a.scrollArr[b+c+d].touchStartNum=0,a.removeClass(t,"onScroll"),a.removeClass(a.doc.getElementById(b).getElementsByClassName(c)[0],"scrollWillChange")):-a.scrollArr[b+c+d].scrollCount>=z&&(a.scrollArr[b+c+d].touchStartNum=C,a.removeClass(t,"onScroll"),a.removeClass(a.doc.getElementById(b).getElementsByClassName(c)[0],
"scrollWillChange"));else e(k);else e(k)},!0);a.doc.getElementById(b).getElementsByClassName("scrollIndicatorInner")[0].addEventListener("touchstart",function(e){a.isDoubleTouch()||!a.doc.getElementById(b)||1>a.doc.getElementById(b).getElementsByClassName(c).length||(m=0,1>a.scrollArr[b+c+d].limit-a.scrollArr[b+c+d].domHeight||(a.addClass(a.doc.getElementById(b).getElementsByClassName(c)[0],"scrollWillChange"),a.scrollArr[b+c+d].touchScrollBarPosition=e.changedTouches[0].clientY,a.scrollArr[b+c+d].touchScrollBarStartPosition=
a.doc.getElementById(b).getElementsByClassName("scrollIndicatorInner")[0].getBoundingClientRect().top-a.doc.getElementById(b).getBoundingClientRect().top,a.addClass(t,"onScroll")))});a.doc.getElementById(b).getElementsByClassName("scrollIndicatorInner")[0].addEventListener("touchmove",function(e){if(!a.isDoubleTouch()&&a.doc.getElementById(b)&&!(1>a.doc.getElementById(b).getElementsByClassName(c).length||1>a.scrollArr[b+c+d].limit-a.scrollArr[b+c+d].domHeight)){e.preventDefault();var f=a.scrollArr[b+
c+d].domHeight;e=-a.scrollArr[b+c+d].touchScrollBarStartPosition-(e.changedTouches[0].clientY-a.scrollArr[b+c+d].touchScrollBarPosition);a.scrollArr[b+c+d].scrollCount=f<=a.scrollArr[b+c+d].scrollBarHeight+-1*e?-1*(a.scrollArr[b+c+d].limit-a.scrollArr[b+c+d].domHeight):0<=e?0:Math.round(e/(f-a.scrollArr[b+c+d].scrollBarHeight)*(a.scrollArr[b+c+d].limit-a.scrollArr[b+c+d].domHeight));q.style.cssText=l+y(a.scrollArr[b+c+d].scrollCount)}});a.doc.getElementById(b).getElementsByClassName("scrollIndicatorInner")[0].addEventListener("touchend",
function(e){a.isDoubleTouch()||!a.doc.getElementById(b)||1>a.doc.getElementById(b).getElementsByClassName(c).length||(a.removeClass(t,"onScroll"),a.scrollArr[b+c+d].touchStartNum=a.scrollArr[b+c+d].scrollCount,a.removeClass(a.doc.getElementById(b).getElementsByClassName(c)[0],"scrollWillChange"))})}};a.scrollSetX=function(b,c){if(a.doc.getElementById(b)&&!(1>a.doc.getElementById(b).getElementsByClassName(c).length)){a.scrollArrX||(a.scrollArrX={});if(!a.scrollArrX[b+c])a.scrollArrX[b+c]={};else if(-1<
["CharaListTop","CharaListCompose","CharaListComposeMagia","CharaListCustomize","CharaListEquip"].indexOf(a.location)&&a.doc.getElementById(a.scrollArrX[b+c].targetId)&&"charaListScrollWrap"===a.scrollArrX[b+c].targetId)return;a.scrollArrX[b+c].targetId=b;a.scrollArrX[b+c].innerClass=c;a.scrollArrX[b+c].scrollbarPositionBase=0;a.scrollArrX[b+c].thisPage=a.location;var d,h,e;a.ua.ios?(d=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||
window.msRequestAnimationFrame||function(a){window.setTimeout(a,10)},h=window.cancelAnimationFrame||window.mozCancelAnimationFrame||function(a){window.setTimeout(a)}):(d=function(a){window.setTimeout(a,10)},h=function(a){window.clearTimeout(a)});var k=a.scrollArrX[b+c].touchStartNum=0,g=a.scrollArrX[b+c].scrollCount=0,f=a.doc.getElementById(b),m=a.doc.getElementById(b).getElementsByClassName(c)[0];a.scrollArrX[b+c].scrollDomWidth=f.offsetWidth;for(var r=m.childNodes,l=r.length,q=r[l-1],n=q.offsetLeft;0<
l;)l=l-1|0,r[l].offsetLeft>n&&(q=r[l],n=q.offsetLeft);a.scrollArrX[b+c].lastDom=q;a.scrollArrX[b+c].lastDomOffLeft=n;a.scrollArrX[b+c].limit=a.scrollArrX[b+c].lastDomOffLeft+q.offsetWidth+5;var p=m.style.cssText?m.style.cssText:"";a.scrollArrX[b+c].defaultCss=p;var u=!1,r=a.doc.createElement("div"),l=a.doc.createElement("div");r.className="scrollIndicatorX";l.className="scrollIndicatorInnerX";a.doc.getElementById(b).appendChild(r);a.doc.getElementById(b).getElementsByClassName("scrollIndicatorX")[0].appendChild(l);
"static"===window.getComputedStyle(a.doc.getElementById(b)).position&&(a.doc.getElementById(b).style.position="relative");var w=a.doc.getElementById(b).getElementsByClassName("scrollIndicatorInnerX")[0];a.scrollArrX[b+c].scrollBarWidth=Math.round(a.scrollArrX[b+c].scrollDomWidth*a.scrollArrX[b+c].scrollDomWidth/a.scrollArrX[b+c].limit);w.style.width=a.scrollArrX[b+c].scrollBarWidth+"px";var t=function(e){var d=e=Math.round(100*e)/100;a.scrollArrX[b+c].scrollbarPositionBase=d;d=Math.round(d/a.scrollArrX[b+
c].limit*-a.scrollArrX[b+c].scrollDomWidth);w.style.cssText=a.ua.ios?"width:"+a.scrollArrX[b+c].scrollBarWidth+"px;-webkit-transform:translateX("+d+"px) translateZ(0);":"width:"+a.scrollArrX[b+c].scrollBarWidth+"px;-webkit-transform:translate3d("+d+"px,0,0);";return a.storage.user&&a.ua.ios?"-webkit-transform:translateX("+e+"px) translateZ(0);":"-webkit-transform:translate3d("+e+"px,0,0);"},v=function(){if(a.isDoubleTouch())h(e);else if(a.doc.getElementById(b))if(1>a.doc.getElementById(b).getElementsByClassName(c).length)h(e);
else{var k=0>g?-1*g:g;!f||!m||.1>k||u||!a.doc.getElementById(b)||!a.scrollArrX[b+c]||a.scrollArrX[b+c].thisPage!==a.location?h(e):(a.scrollArrX[b+c].scrollCount+=g,0<=a.scrollArrX[b+c].scrollCount?(m.style.cssText=p+t(0),a.scrollArrX[b+c].scrollCount=Math.round(a.scrollArrX[b+c].scrollCount),a.scrollArrX[b+c].touchStartNum=0,a.removeClass(w,"onScroll"),a.removeClass(a.doc.getElementById(b).getElementsByClassName(c)[0],"scrollWillChange")):-a.scrollArrX[b+c].scrollCount>=a.scrollArrX[b+c].limit-a.scrollArrX[b+
c].scrollDomWidth?(a.scrollArrX[b+c].scrollCount=Math.round(a.scrollArrX[b+c].scrollCount),a.scrollArrX[b+c].touchStartNum=-a.scrollArrX[b+c].limit+a.scrollArrX[b+c].scrollDomWidth,m.style.cssText=p+t(a.scrollArrX[b+c].touchStartNum),a.removeClass(w,"onScroll"),a.removeClass(a.doc.getElementById(b).getElementsByClassName(c)[0],"scrollWillChange")):(m.style.cssText=p+t(a.scrollArrX[b+c].scrollCount),f&&m&&!(.1>k)&&!u&&a.doc.getElementById(b)&&a.scrollArrX[b+c]&&(g*=.95,a.scrollArrX[b+c].touchStartNum=
a.scrollArrX[b+c].scrollCount,.6<k?e=d(v):(a.removeClass(w,"onScroll"),a.removeClass(a.doc.getElementById(b).getElementsByClassName(c)[0],"scrollWillChange")))))}else h(e)};a.doc.getElementById(b).getElementsByClassName(c)[0].addEventListener("touchstart",function(d){u=!0;a.isDoubleTouch()?h(e):!a.doc.getElementById(b)||1>a.doc.getElementById(b).getElementsByClassName(c).length||(q=a.scrollArrX[b+c].lastDom,g=0,a.scrollArrX[b+c].scrollCount=Math.round(a.scrollArrX[b+c].scrollCount),a.scrollArrX[b+
c].scrollDomWidth>a.scrollArrX[b+c].limit||(a.addClass(a.doc.getElementById(b).getElementsByClassName(c)[0],"scrollWillChange"),k=d.changedTouches[0].clientX))});a.doc.getElementById(b).getElementsByClassName(c)[0].addEventListener("touchmove",function(d){d.preventDefault();a.isDoubleTouch()||a.androidKeyForceStop?h(e):a.doc.getElementById(b)?1>a.doc.getElementById(b).getElementsByClassName(c).length?h(e):(w.classList.contains("onScroll")||a.addClass(w,"onScroll"),a.scrollArrX[b+c].scrollDomWidth>
a.scrollArrX[b+c].limit?h(e):(g=-(a.scrollArrX[b+c].scrollCount-(a.scrollArrX[b+c].touchStartNum+(d.changedTouches[0].clientX-k))),a.scrollArrX[b+c].scrollCount=a.scrollArrX[b+c].touchStartNum+(d.changedTouches[0].clientX-k),0<a.scrollArrX[b+c].scrollCount?(m.style.cssText!==p+t(0)&&(m.style.cssText=p+t(0)),a.scrollArrX[b+c].scrollCount=0):-a.scrollArrX[b+c].scrollCount>=a.scrollArrX[b+c].limit-a.scrollArrX[b+c].scrollDomWidth?(a.scrollArrX[b+c].scrollCount=-a.scrollArrX[b+c].limit+a.scrollArrX[b+
c].scrollDomWidth,a.scrollArrX[b+c].touchStartNum=-a.scrollArrX[b+c].limit+a.scrollArrX[b+c].scrollDomWidth,m.style.cssText=p+t(a.scrollArrX[b+c].touchStartNum)):m.style.cssText=p+t(a.scrollArrX[b+c].scrollCount))):h(e)},!0);a.doc.getElementById(b).getElementsByClassName(c)[0].addEventListener("touchend",function(k){a.isDoubleTouch()?h(e):(u=!1,f&&m&&a.doc.getElementById(b)&&a.scrollArrX[b+c]&&a.scrollArrX[b+c].thisPage===a.location)?!a.doc.getElementById(b)||1>a.doc.getElementById(b).getElementsByClassName(c).length||
(0<=a.scrollArrX[b+c].scrollCount?(a.scrollArrX[b+c].touchStartNum=0,a.removeClass(w,"onScroll"),a.removeClass(a.doc.getElementById(b).getElementsByClassName(c)[0],"scrollWillChange")):-a.scrollArrX[b+c].scrollCount>=a.scrollArrX[b+c].limit-a.scrollArrX[b+c].scrollDomWidth?(a.scrollArrX[b+c].touchStartNum=-a.scrollArrX[b+c].limit+a.scrollArrX[b+c].scrollDomWidth,a.removeClass(w,"onScroll"),a.removeClass(a.doc.getElementById(b).getElementsByClassName(c)[0],"scrollWillChange")):(a.scrollArrX[b+c].touchStartNum=
a.scrollArrX[b+c].scrollCount,1<(0>g?-1*g:g)?e=d(v):(a.removeClass(w,"onScroll"),a.removeClass(a.doc.getElementById(b).getElementsByClassName(c)[0],"scrollWillChange")))):h(e)},!0)}};a.scrollRefresh=function(b,c,d,h){if(a.scrollArr||a.scrollArrX){var e=function(b){return a.storage.user&&a.ua.ios?"-webkit-transform:translateY("+b+"px);":"-webkit-transform:translate3d(0,"+b+"px,0);"},k=function(b){return a.storage.user&&a.ua.ios?"-webkit-transform:translateX("+b+"px);":"-webkit-transform:translate3d("+
b+"px,0,0);"},g=a.location,f,m,r,l;if(b&&c)if(a.scrollArr&&a.scrollArr[b+c+g])if(!a.doc.getElementById(b)||1>a.doc.getElementById(b).getElementsByClassName(c).length||a.scrollArr[b+c+g].thisPage!==a.location)delete a.scrollArr[b+c+g];else{a.scrollArr[b+c+g].stopVelocity=!0;f=a.doc.getElementById(b);k=f.offsetHeight;a.scrollArr[b+c+g].domHeight=k;f=a.doc.getElementById(b).getElementsByClassName(a.scrollArr[b+c+g].innerClass)[0];var q=f.offsetHeight;a.scrollArr[b+c+g].limit=q;r=a.doc.getElementById(b).getElementsByClassName("scrollIndicatorInner")[0];
l=d?0:Math.round(a.scrollArr[b+c+g].scrollbarPositionBase/q*-k);a.scrollArr[b+c+g].scrollBarHeight=Math.round(k*k/q);if(q<=k||d)m=f.style.cssText,f.style.cssText=m+e(0),a.scrollArr[b+c+g].scrollCount=0,a.scrollArr[b+c+g].touchStartNum=0;l+a.scrollArr[b+c+g].scrollBarHeight>=k&&!d&&(m=f.style.cssText,f.style.cssText=m+e(-1*(q-k)),a.scrollArr[b+c+g].scrollCount=-1*(q-k));r&&(r.style.cssText=a.ua.ios?"height:"+a.scrollArr[b+c+g].scrollBarHeight+"px;-webkit-transform:translateY("+l+"px);":"height:"+a.scrollArr[b+
c+g].scrollBarHeight+"px;-webkit-transform:translate3d(0,"+l+"px,0);");h&&a.forceScrollArr&&a.forceScrollArr[b+c]&&(d=a.forceScrollArr[b+c].split(","),a.forceScroll(b,c,d[0],d[1]),a.forceScrollArr[b+c]=void 0)}else{if(a.scrollArrX&&a.scrollArrX[b+c])if(!a.doc.getElementById(b)||1>a.doc.getElementById(b).getElementsByClassName(c).length)delete a.scrollArrX[b+c];else{f=a.doc.getElementById(b);a.scrollArrX[b+c].scrollDomWidth=f.offsetWidth;f=a.doc.getElementById(b).getElementsByClassName(a.scrollArrX[b+
c].innerClass)[0];e=f.childNodes;g=e.length;m=e[g-1];for(r=m.offsetLeft;0<g;)g=g-1|0,e[g].offsetLeft>r&&(m=e[g],r=m.offsetLeft);a.scrollArrX[b+c].lastDom=m;a.scrollArrX[b+c].lastDomOffLeft=r;a.scrollArrX[b+c].limit=a.scrollArrX[b+c].lastDomOffLeft+m.offsetWidth+5;r=a.doc.getElementById(b).getElementsByClassName("scrollIndicatorInner")[0];l=d?0:Math.round(a.scrollArrX[b+c].scrollbarPositionBase/a.scrollArrX[b+c].limit*-a.scrollArrX[b+c].scrollDomWidth);a.scrollArrX[b+c].scrollBarWidth=Math.round(a.scrollArrX[b+
c].scrollDomWidth*a.scrollArrX[b+c].scrollDomWidth/a.scrollArrX[b+c].limit);e=!1;a.scrollArrX[b+c].scrollDomWidth>a.scrollArrX[b+c].lastDomOffLeft+m.offsetWidth&&(e=!0,l=0);a.scrollArrX[b+c].scrollBarWidth>a.scrollArrX[b+c].scrollDomWidth&&(a.scrollArrX[b+c].scrollBarWidth=a.scrollArrX[b+c].scrollDomWidth);if(a.scrollArrX[b+c].limit<=a.scrollArrX[b+c].scrollDomWidth||d||e)m=f.style.cssText,f.style.cssText=m+k(0),a.scrollArrX[b+c].scrollCount=0,a.scrollArrX[b+c].touchStartNum=0;l+a.scrollArrX[b+c].scrollBarWidth>=
a.scrollArrX[b+c].scrollDomWidth&&!d&&(m=f.style.cssText,f.style.cssText=m+k(-1*(a.scrollArrX[b+c].limit-a.scrollArrX[b+c].scrollDomWidth)),a.scrollArrX[b+c].scrollCount=-1*(a.scrollArrX[b+c].limit-a.scrollArrX[b+c].scrollDomWidth));r&&(r.style.cssText=a.ua.ios?"width:"+a.scrollArrX[b+c].scrollBarWidth+"px;-webkit-transform:translateX("+l+"px);":"width:"+a.scrollArrX[b+c].scrollBarWidth+"px;-webkit-transform:translate3d("+l+"px,0,0);");h&&a.forceScrollXArr&&a.forceScrollXArr[b+c]&&(d=a.forceScrollXArr[b+
c].split(","),a.forceScrollX(b,c,d[0],d[1]),a.forceScrollXArr[b+c]=void 0)}}else{for(f in a.scrollArr)if(a.scrollArr[f].thisPage!==a.location)delete a.scrollArr[f];else if(c=a.doc.getElementById(a.scrollArr[f].targetId),!c||1>c.getElementsByClassName(a.scrollArr[f].innerClass).length)delete a.scrollArr[f];else{a.scrollArr[f].stopVelocity=!0;r=c.offsetHeight;a.scrollArr[f].domHeight=r;b=a.doc.getElementById(a.scrollArr[f].targetId).getElementsByClassName(a.scrollArr[f].innerClass)[0];a.scrollArr[f].limit=
b.offsetHeight;c=a.doc.getElementById(a.scrollArr[f].targetId).getElementsByClassName("scrollIndicatorInner")[0];g=d?0:Math.round(a.scrollArr[f].scrollbarPositionBase/a.scrollArr[f].limit*-r);a.scrollArr[f].scrollBarHeight=Math.round(r*r/a.scrollArr[f].limit);if(a.scrollArr[f].limit<=r||d)m=b.style.cssText,b.style.cssText=m+e(0),a.scrollArr[f].scrollCount=0,a.scrollArr[f].touchStartNum=0;g+a.scrollArr[f].scrollBarHeight>=r&&!d&&(m=b.style.cssText,b.style.cssText=m+e(-1*(a.scrollArr[f].limit-r)),a.scrollArr[f].scrollCount=
-1*(a.scrollArr[f].limit-r));c&&(Infinity!==a.scrollArr[f].scrollBarHeight?c.style.cssText=a.ua.ios?"height:"+a.scrollArr[f].scrollBarHeight+"px;-webkit-transform:translateY("+g+"px);":"height:"+a.scrollArr[f].scrollBarHeight+"px;-webkit-transform:translate3d(0,"+g+"px,0);":a.scrollArr[f].scrollBarHeight=a.scrollArr[f].limit);h&&a.forceScrollArr&&a.forceScrollArr[a.scrollArr[f].targetId+a.scrollArr[f].innerClass]&&(b=a.forceScrollArr[a.scrollArr[f].targetId+a.scrollArr[f].innerClass].split(","),a.forceScroll(a.scrollArr[f].targetId,
a.scrollArr[f].innerClass,b[0],b[1]),a.forceScrollArr[a.scrollArr[f].targetId+a.scrollArr[f].innerClass]=void 0)}for(f in a.scrollArrX)if(b=["CharaListTop","CharaListCompose","CharaListComposeMagia","CharaListCustomize","CharaListEquip"],-1<b.indexOf(a.location)&&-1<b.indexOf(a.scrollArrX[f].thisPage)&&a.doc.getElementById(a.scrollArrX[f].targetId)&&(a.scrollArrX[f].thisPage=a.location),a.scrollArrX[f].thisPage!==a.location)delete a.scrollArrX[f];else if(c=a.doc.getElementById(a.scrollArrX[f].targetId),
!c||1>c.getElementsByClassName(a.scrollArrX[f].innerClass).length)delete a.scrollArr[f];else{b=a.doc.getElementById(a.scrollArrX[f].targetId).getElementsByClassName(a.scrollArrX[f].innerClass)[0];e=b.childNodes;a.scrollArrX[f].scrollDomWidth=c.offsetWidth;m=e.length;g=e[m-1];for(c=g.offsetLeft;0<m;)m=m-1|0,e[m].offsetLeft>c&&(g=e[m],c=g.offsetLeft);a.scrollArrX[f].lastDom=g;e=g.offsetWidth;a.scrollArrX[f].lastDomOffLeft=c;a.scrollArrX[f].limit=a.scrollArrX[f].lastDomOffLeft+e+5;c=a.doc.getElementById(a.scrollArrX[f].targetId).getElementsByClassName("scrollIndicatorInnerX")[0];
g=d?0:Math.round(a.scrollArrX[f].scrollbarPositionBase/b.offsetWidth*-a.scrollArrX[f].scrollDomWidth);a.scrollArrX[f].scrollBarWidth=Math.round(a.scrollArrX[f].scrollDomWidth*a.scrollArrX[f].scrollDomWidth/a.scrollArrX[f].limit);r=!1;a.scrollArrX[f].scrollDomWidth>a.scrollArrX[f].lastDomOffLeft+e&&(r=!0,g=0);a.scrollArrX[f].scrollBarWidth>a.scrollArrX[f].scrollDomWidth&&(a.scrollArrX[f].scrollBarWidth=a.scrollArrX[f].scrollDomWidth);g+a.scrollArrX[f].scrollDomWidth>=a.scrollArrX[f].limit&&!d&&(m=
b.style.cssText,b.style.cssText=m+k(-1*(a.scrollArrX[f].limit-a.scrollArrX[f].scrollDomWidth)),a.scrollArrX[f].scrollCount=-1*(a.scrollArrX[f].limit-a.scrollArrX[f].scrollDomWidth),a.scrollArrX[f].touchStartNum=-1*(a.scrollArrX[f].limit-a.scrollArrX[f].scrollDomWidth));if(a.scrollArrX[f].limit<=a.scrollArrX[f].scrollDomWidth||d||r)m=b.style.cssText,b.style.cssText=m+k(0),a.scrollArrX[f].scrollCount=0,a.scrollArrX[f].touchStartNum=0;c&&(c.style.cssText=a.ua.ios?"width:"+a.scrollArrX[f].scrollBarWidth+
"px;-webkit-transform:translateX("+g+"px);":"width:"+a.scrollArrX[f].scrollBarWidth+"px;-webkit-transform:translate3d("+g+"px,0,0);");h&&a.forceScrollXArr&&a.forceScrollXArr[a.scrollArrX[f].targetId+a.scrollArrX[f].innerClass]&&(b=a.forceScrollXArr[a.scrollArrX[f].targetId+a.scrollArrX[f].innerClass].split(","),a.forceScrollX(a.scrollArrX[f].targetId,a.scrollArrX[f].innerClass,b[0],b[1]),a.forceScrollXArr[a.scrollArrX[f].targetId+a.scrollArrX[f].innerClass]=void 0)}}}};a.scrollDestroy=function(b,
c){var d=a.location;if(b&&a.scrollArr[b+c+d])a.doc.getElementById(b)||delete a.scrollArr[b+c+d];else if(b&&a.scrollArrX[b+c])a.doc.getElementById(b)||delete a.scrollArrX[b+c];else if(!b){for(var h in a.scrollArr)delete a.scrollArr[h];if(-1===["CharaListTop","CharaListCompose","CharaListComposeMagia","CharaListCustomize","CharaListEquip"].indexOf(a.location)){for(var e in a.scrollArrX)delete a.scrollArrX[e];a.scrollArrX={}}a.scrollArr={}}a.scrollRefresh()};a.forceScrollPreset=function(b,c,d,h){a.forceScrollArr||
(a.forceScrollArr=[]);a.forceScrollArr[b+c]=d+","+h;h&&a.addClass(a.doc.getElementById(b).getElementsByClassName(c)[0],"scrollForceInvisible")};a.forceScrollXPreset=function(b,c,d,h){a.forceScrollXArr||(a.forceScrollXArr=[]);a.forceScrollXArr[b+c]=d+","+h;h&&a.addClass(a.doc.getElementById(b).getElementsByClassName(c)[0],"scrollForceInvisible")};a.forceScroll=function(b,c,d,h){if(!a.forceScrollFlag){a.forceScrollFlag=!0;var e=a.doc.getElementById(b);if(e){var k=e.getElementsByClassName(c)[0];if(k)if(d=
a.doc.querySelectorAll('[data-scroll-hash\x3d"'+d+'"]')[0]){var g=a.location;if(a.scrollArr[b+c+g]){var f=e.getElementsByClassName("scrollIndicatorInner")[0],m,l;a.ua.ios?(m=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a){window.setTimeout(a,10)},l=window.cancelAnimationFrame||window.mozCancelAnimationFrame||function(a){window.setTimeout(a)}):(m=function(a){window.setTimeout(a,
10)},l=function(a){window.clearTimeout(a)});var n=0,q=!1,p=null,u=function(){if(a.forceScrollFlag&&e&&k&&!(.1>z)&&a.doc.getElementById(b)&&a.scrollArr[b+c+g]&&a.scrollArr[b+c+g].thisPage===a.location)if(1>k.length)a.forceScrollFlag=!1;else if(a.scrollArr[b+c+g].scrollCount+=n,z=0>n?-1*n:n,-a.scrollArr[b+c+g].scrollCount>=a.scrollArr[b+c+g].limit-e.offsetHeight)a.scrollArr[b+c+g].scrollCount=Math.round(a.scrollArr[b+c+g].scrollCount),a.scrollArr[b+c+g].touchStartNum=-a.scrollArr[b+c+g].limit+e.offsetHeight,
k.style.cssText=a.scrollArr[b+c+g].defaultCss+v(a.scrollArr[b+c+g].touchStartNum),a.removeClass(f,"onScroll"),a.forceScrollFlag=!1,a.removeClass(k,"scrollForce");else if(k.style.cssText=a.scrollArr[b+c+g].defaultCss+v(a.scrollArr[b+c+g].scrollCount),e&&k&&e&&a.scrollArr[b+c+g]){a.scrollArr[b+c+g].touchStartNum=a.scrollArr[b+c+g].scrollCount;var d=-a.scrollArr[b+c+g].scrollCount- -t,d=0>d?-1*d:d;d<(w+a.scrollArr[b+c+g].scrollCount)/100*-30&&(q?n*=.99:(n=0<n?d/20:d/20*-1,q=!0));3>d||p&&p<d?(a.scrollArr[b+
c+g].scrollCount=t,a.scrollArr[b+c+g].touchStartNum=t,k.style.cssText=a.scrollArr[b+c+g].defaultCss+v(a.scrollArr[b+c+g].touchStartNum),a.removeClass(f,"onScroll"),q=!1,a.forceScrollFlag=!1,a.removeClass(k,"scrollForce")):(C=m(u),p=d)}else a.forceScrollFlag=!1,a.removeClass(k,"scrollForce");else l(C),a.forceScrollFlag=!1,a.removeClass(k,"scrollForce")},v=function(d){var h=d=Math.round(100*d)/100;a.scrollArr[b+c+g].scrollbarPositionBase=h;h=Math.round(h/k.offsetHeight*-e.offsetHeight);f.style.cssText=
a.ua.ios?"height:"+a.scrollArr[b+c+g].scrollBarHeight+"px;-webkit-transform:translateY("+h+"px) translateZ(0);":"height:"+a.scrollArr[b+c+g].scrollBarHeight+"px;-webkit-transform:translate3d(0,"+h+"px,0);";return a.ua.ios?"-webkit-transform:translateY("+d+"px) translateZ(0);":"-webkit-transform:translate3d(0,"+d+"px,0);"},w=a.scrollArr[b+c+g].touchStartNum,t=-1*d.offsetTop+15;0<t&&(t=0);if(w===t){a.forceScrollFlag=!1;a.addClass(a.doc.getElementById(b).getElementsByClassName(c)[0],"fadeIn");var x=
function(){a.doc.getElementById(b).getElementsByClassName(c)[0]&&(a.doc.getElementById(b).getElementsByClassName(c)[0].removeEventListener("webkitAnimationEnd",x),a.removeClass(a.doc.getElementById(b).getElementsByClassName(c)[0],"scrollForceInvisible"),a.removeClass(a.doc.getElementById(b).getElementsByClassName(c)[0],"fadeIn"))};a.doc.getElementById(b).getElementsByClassName(c)[0].addEventListener("webkitAnimationEnd",x);a.removeClass(k,"scrollForce")}else if(a.addClass(k,"scrollForce"),"true"===
h||!0===h){a.scrollArr[b+c+g].scrollCount=t;a.scrollArr[b+c+g].touchStartNum=t;-a.scrollArr[b+c+g].scrollCount>=a.scrollArr[b+c+g].limit-e.offsetHeight&&(a.scrollArr[b+c+g].scrollCount=Math.round(a.scrollArr[b+c+g].scrollCount),a.scrollArr[b+c+g].touchStartNum=-a.scrollArr[b+c+g].limit+e.offsetHeight);k.style.cssText=a.scrollArr[b+c+g].defaultCss+v(a.scrollArr[b+c+g].touchStartNum);a.removeClass(f,"onScroll");q=!1;a.forceScrollFlag=!1;a.addClass(a.doc.getElementById(b).getElementsByClassName(c)[0],
"fadeIn");var y=function(){a.doc.getElementById(b).getElementsByClassName(c)[0]&&(a.doc.getElementById(b).getElementsByClassName(c)[0].removeEventListener("webkitAnimationEnd",y),a.removeClass(a.doc.getElementById(b).getElementsByClassName(c)[0],"scrollForceInvisible"),a.removeClass(a.doc.getElementById(b).getElementsByClassName(c)[0],"fadeIn"))};a.doc.getElementById(b).getElementsByClassName(c)[0].addEventListener("webkitAnimationEnd",y);a.removeClass(k,"scrollForce")}else{h=-w-(d.offsetTop-15);
n=(0>h?h:-h)/20;w<t&&(n*=-1);var z=0>n?-1*n:n,C=u()}}else a.forceScrollFlag=!1,a.removeClass(k,"scrollForceInvisible")}else a.forceScrollFlag=!1,a.removeClass(k,"scrollForceInvisible");else a.forceScrollFlag=!1}else a.forceScrollFlag=!1}};a.forceScrollX=function(b,c,d,h){if(!a.forceScrollFlag){a.forceScrollFlag=!0;var e=a.doc.getElementById(b);if(e){var k=e.getElementsByClassName(c)[0];if(k&&(d=a.doc.querySelectorAll('[data-scroll-hash\x3d"'+d+'"]')[0])&&a.scrollArrX[b+c]){var g=e.getElementsByClassName("scrollIndicatorInnerX")[0],
f,m;a.ua.ios?(f=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a){window.setTimeout(a,10)},m=window.cancelAnimationFrame||window.mozCancelAnimationFrame||function(a){window.setTimeout(a)}):(f=function(a){window.setTimeout(a,10)},m=function(a){window.clearTimeout(a)});var l=0,n=!1,q=null,p=function(){if(a.forceScrollFlag&&e&&k&&!(.1>y)&&a.doc.getElementById(b)&&a.scrollArrX[b+
c])if(1>k.length)a.forceScrollFlag=!1;else if(a.scrollArrX[b+c].scrollCount+=l,y=0>l?-1*l:l,-a.scrollArrX[b+c].scrollCount>=a.scrollArrX[b+c].limit-e.offsetWidth)a.scrollArrX[b+c].scrollCount=Math.round(a.scrollArrX[b+c].scrollCount),a.scrollArrX[b+c].touchStartNum=-a.scrollArrX[b+c].limit+e.offsetWidth,k.style.cssText=a.scrollArrX[b+c].defaultCss+u(a.scrollArrX[b+c].touchStartNum),a.removeClass(g,"onScroll"),a.forceScrollFlag=!1,a.removeClass(k,"scrollForce");else if(k.style.cssText=a.scrollArrX[b+
c].defaultCss+u(a.scrollArrX[b+c].scrollCount),e&&k&&e&&a.scrollArrX[b+c]){a.scrollArrX[b+c].touchStartNum=a.scrollArrX[b+c].scrollCount;var d=-a.scrollArrX[b+c].scrollCount- -w,d=0>d?-1*d:d;d<(v+a.scrollArrX[b+c].scrollCount)/100*-30&&(n?l*=.99:(l=0<l?d/20:d/20*-1,n=!0));3>d||q&&q<d?(a.scrollArrX[b+c].scrollCount=w,a.scrollArrX[b+c].touchStartNum=w,k.style.cssText=a.scrollArrX[b+c].defaultCss+u(a.scrollArrX[b+c].touchStartNum),a.removeClass(g,"onScroll"),n=!1,a.forceScrollFlag=!1,a.removeClass(k,
"scrollForce")):(z=f(p),q=d)}else a.forceScrollFlag=!1,a.removeClass(k,"scrollForce");else m(z),a.removeClass(k,"scrollForce")},u=function(d){var f=d=Math.round(100*d)/100;a.scrollArrX[b+c].scrollbarPositionBase=f;f=Math.round(f/k.offsetWidth*-e.offsetWidth);g.style.cssText=a.ua.ios?"height:"+a.scrollArrX[b+c].scrollBarHeight+"px;-webkit-transform:translateY("+f+"px) translateZ(0);":"height:"+a.scrollArrX[b+c].scrollBarHeight+"px;-webkit-transform:translate3d(0,"+f+"px,0);";return a.ua.ios?"-webkit-transform:translateX("+
d+"px) translateZ(0);":"-webkit-transform:translate3d("+d+"px,0,0);"},v=a.scrollArrX[b+c].touchStartNum,w=-1*d.offsetLeft+15;0<w&&(w=0);if(v===w){a.forceScrollFlag=!1;a.addClass(a.doc.getElementById(b).getElementsByClassName(c)[0],"fadeIn");var t=function(){a.doc.getElementById(b).getElementsByClassName(c)[0]&&(a.doc.getElementById(b).getElementsByClassName(c)[0].removeEventListener("webkitAnimationEnd",t),a.removeClass(a.doc.getElementById(b).getElementsByClassName(c)[0],"scrollForceInvisible"),
a.removeClass(a.doc.getElementById(b).getElementsByClassName(c)[0],"fadeIn"))};a.doc.getElementById(b).getElementsByClassName(c)[0].addEventListener("webkitAnimationEnd",t);a.removeClass(k,"scrollForce")}else if(a.addClass(k,"scrollForce"),"true"===h||!0===h){a.scrollArrX[b+c].scrollCount=w;a.scrollArrX[b+c].touchStartNum=w;-a.scrollArrX[b+c].scrollCount>=a.scrollArrX[b+c].limit-e.offsetWidth&&(a.scrollArrX[b+c].scrollCount=Math.round(a.scrollArrX[b+c].scrollCount),a.scrollArrX[b+c].touchStartNum=
-a.scrollArrX[b+c].limit+e.offsetWidth);k.style.cssText=a.scrollArrX[b+c].defaultCss+u(a.scrollArrX[b+c].touchStartNum);a.removeClass(g,"onScroll");n=!1;a.forceScrollFlag=!1;a.addClass(a.doc.getElementById(b).getElementsByClassName(c)[0],"fadeIn");var x=function(){a.doc.getElementById(b).getElementsByClassName(c)[0]&&(a.doc.getElementById(b).getElementsByClassName(c)[0].removeEventListener("webkitAnimationEnd",x),a.removeClass(a.doc.getElementById(b).getElementsByClassName(c)[0],"scrollForceInvisible"),
a.removeClass(a.doc.getElementById(b).getElementsByClassName(c)[0],"fadeIn"))};a.doc.getElementById(b).getElementsByClassName(c)[0].addEventListener("webkitAnimationEnd",x);a.removeClass(k,"scrollForce")}else{h=-v-(d.offsetLeft-15);l=(0>h?h:-h)/20;v<w&&(l*=-1);var y=0>l?-1*l:l,z=p()}}}}};a.nativeKeyBoard=function(b,c,d,h,e){b&&(c||(c=50),d||(d=0),0>c&&(c=0),require(["command"],function(k){var g=function(f){f.preventDefault();a.isScrolled()||a.isDoubleTouch()||!a.doc.getElementById(b)||(window.isBrowser||
a.tapBlock(!0),n("#commandDiv").on("nativeCallback",function(d,f){n("#commandDiv").off();a.tapBlock(!1);a.doc.getElementById(b)&&("error"===f.resultCode?new a.PopupClass({title:f.title,content:f.errorTxt,closeBtnText:"OK"}):(f=(d=f.text)&&d.length?d.length:0,c&&0<c&&f>c&&(d=d.substr(0,c)),a.doc.getElementById(b).value=d,h&&a.doc.getElementById(h)&&(a.doc.getElementById(h).textContent=f),e&&e()))}),f=a.doc.getElementById(b).value,k.openKeyBoard(f,c,d),window.isBrowser&&(a.doc.getElementById(b).removeEventListener(a.cgti,
g),a.doc.getElementById(b).removeAttribute("readonly"),h&&a.doc.getElementById(b).addEventListener("keyup",function(){var d=a.doc.getElementById(b).value,e=d&&d.length?d.length:0;0<c&&e>c&&(d=d.substr(0,c),a.doc.getElementById(b).value=d);a.doc.getElementById(h).textContent=e})))};a.doc.getElementById(b).addEventListener(a.cgti,g)}))};a.imageZoomView=function(b){var c=b.currentTarget;"IMG"!==c.tagName&&"img"!==c.tagName||new (x.View.extend({id:"overImageZoom",events:function(){var b={};b[a.cgti]=
this.removeView;return b},initialize:function(b){a.androidKeyForceStop=!0;a.addClass(a.doc.getElementById("curtain"),"show");this.createDom()},render:function(){var b=a.doc.createElement("img");b.src=c.src;this.el.appendChild(b);return this.el},createDom:function(){a.doc.getElementById("overlapContainer").appendChild(this.render());a.doc.getElementById("overlapContainer").style.zIndex="1000001"},removeView:function(){a.removeClass(a.doc.getElementById("curtain"),"show");a.androidKeyForceStop=!1;a.doc.getElementById("overlapContainer").style.zIndex=
"";this.off();this.remove()}}))};a.isRankingRunning=function(a){return a?v.findWhere(a,{eventType:"ARENAARENARANKING"})?!0:!1:!1};a.versionCheck=function(a,c,d){a=a.split(".");d=d.split(".");for(var b,e,k=Math.max(a.length,d.length);k--&&(b=parseInt(a.shift()||0),e=parseInt(d.shift()||0),b==e););return eval([b,c,e].join(" "))};return a});