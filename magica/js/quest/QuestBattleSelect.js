define("underscore backbone backboneCommon ajaxControl command QuestUtil text!template/quest/QuestBattleSelect.html text!css/quest/QuestBattleSelect.css text!css/quest/QuestCommon.css js/view/quest/QuestListPartsView".split(" "),function(f,u,a,l,g,v,w,x,y,r){function z(){var b={};b.key=m;b.type=1;b.id="0";b.x=280;b.y=Math.floor(a.doc.getElementsByTagName("body")[0].offsetHeight/2);g.startL2d(b)}var n,t,m,c,k,A=u.View.extend({events:function(){var b={};b[a.cgti+" .missionBtn"]=this.missionToggle;b[a.cgti+
" #advSkipPopBtn"]=this.advSkipSetting;return b},initialize:function(a){this.template=f.template(w);this.createDom()},render:function(){c.section.message=c.section.message.replace(/ï¼ /g,"\x3cbr\x3e");c.section.message=c.section.message.replace(/userName/g,a.storage.user.get("loginName"));c.section.halfAp=null;this.halfAp&&(c.section.halfAp=this.halfAp);"HARD"==a.mainQuestMode?(this.challengeModeAp&&(c.section.challengeModeAp=this.challengeModeAp),this.challengeModeDifficulty&&(c.section.challengeModeDifficulty=
this.challengeModeDifficulty)):(c.section.challengeModeAp=!1,c.section.challengeModeDifficulty=!1);console.log(c.section);this.$el.html(this.template({model:c.section}));return this},createDom:function(){a.setGlobalView();var b=l.getPageJson(),d=this;f.each(b.userSectionList,function(e){m==e.sectionId&&(e.section.questBattleList=[],f.each(b.userQuestBattleList,function(b){e.section.sectionId===b.questBattle.sectionId&&("MAIN"==e.section.questType?b.questBattle.questBattleType==a.mainQuestMode&&(e.section.questBattleList.push(b),
"HARD"!=a.mainQuestMode||d.challengeModeAp||(d.challengeModeAp=b.questBattle.ap||"-"),"HARD"!=a.mainQuestMode||d.challengeModeDifficulty||(d.challengeModeDifficulty=b.questBattle.difficulty||"-")):e.section.questBattleList.push(b))}),e.section.questBattleList.sort(function(a,b){return a.questBattle.sectionIndex-b.questBattle.sectionIndex}),c=e)});c||(a.tutorialId?g.nativeReload("#/TopPage"):location.href="#/MainQuest");d=this;this.halfAp=this.campaignData=null;this.freeAtNotClear=!1;b.campaignList&&
(this.campaignData=a.campaignParse(b.campaignList));this.campaignData&&(this.campaignData.FREE_AT_NOT_CLEAR&&(console.log("FANCcurrentSectionModel:",c),0<this.campaignData.FREE_AT_NOT_CLEAR.sectionIds.length&&0<=this.campaignData.FREE_AT_NOT_CLEAR.sectionIds.indexOf(String(c.sectionId))?this.freeAtNotClear=!0:0<this.campaignData.FREE_AT_NOT_CLEAR.chapterIds.length&&0<=this.campaignData.FREE_AT_NOT_CLEAR.chapterIds.indexOf(String(c.section.genericId))?this.freeAtNotClear=!0:!this.freeAtNotClear&&this.campaignData.FREE_AT_NOT_CLEAR.questType&&
f.each(this.campaignData.FREE_AT_NOT_CLEAR.questType,function(a,b){console.log("FANCtargetQuestType:",a);if("ALL"===a||a==c.section.questType)d.freeAtNotClear=!0})),this.campaignData.HALF_AP&&f.each(this.campaignData.HALF_AP.questType,function(a,b){console.log("targetQuestType:",a);console.log("currentSectionModel:",c);if("MAIN"==a||"SUB"==a)a==c.section.questType&&(0<=d.campaignData.HALF_AP.chapterIds.indexOf(String(c.section.genericId))||0===d.campaignData.HALF_AP.chapterIds.length)&&(d.halfAp=
d.challengeModeAp?Math.ceil(d.challengeModeAp/2):Math.ceil(c.section.ap/2));else if("ALL"==a||a==c.section.questType)d.halfAp=d.challengeModeAp?Math.ceil(d.challengeModeAp/2):Math.ceil(c.section.ap/2)}));f.each(b.userChapterList,function(a,b){c.section.genericId==a.chapterId&&(c.section.chapterNoForView=a.chapter.chapterNoForView,c.section.chapter=a.chapter)});switch(c.section.questType){case "MAIN":c.section.questTypeText="Main Story";break;case "SUB":c.section.questTypeText="Another Story";break;
case "CHARA":c.section.questTypeText="Magical Girl Story";break;case "COSTUME":c.section.questTypeText="Costume Story"}var h=this.render().el;a.mainQuestMode&&"HARD"==a.mainQuestMode&&a.addClass(h.querySelector("#QuestBattleSelect"),"challenge");a.addClass(h.querySelector("#QuestBattleSelect"),c.section.questType);a.content.append(h);z();c.section.imagePath&&g.changeBg("bg_adv_"+c.section.imagePath+".jpg");this.createQuestList();this.advSkipDomSet()},createQuestList:function(){var b=this;r.prototype.parentView=
this;r.prototype.template=f.template($("#QuestListParts").text());var d=!1,h=[];f.each(c.section.questBattleList,function(a,b){if(!d||a.cleared)h.push(a),a.cleared||(d=!0)});h.sort(function(a,b){return a.questBattle.sectionIndex>b.questBattle.sectionIndex?-1:a.questBattle.sectionIndex<b.questBattle.sectionIndex?1:0});var e=a.doc.createDocumentFragment();f.each(h,function(c,d){console.log(d,c);c.missionRewardCode=a.itemSet(c.questBattle.missionRewardCode);c.chestColor=c.missionRewardCode.chestColor;
!c.cleared&&b.freeAtNotClear?c.campaignFreeAtNotClear=!0:b.halfAp&&(c.halfAp=b.halfAp);d=new r({model:c});d.el.dataset.scrollHash=c.questBattleId;e.appendChild(d.render().el)});a.doc.getElementById("questLinkList").appendChild(e);a.scrollSet("scrollWrap","scrollInner");p&&!d&&a.forceScrollPreset("scrollWrap","scrollInner",p,!0);g.getBaseData(a.getNativeObj());a.ready.hide()},advSkipSetting:function(b){b.preventDefault();if(!a.isScrolled()){g.startSe(1002);var c={skipAdventure:k?!1:!0},f=this,e=new a.PopupClass({title:"Story Replay Settings",
popupId:"advSkipSetPop",content:"Already viewed Cutscenes will be replayed\x3cbr\x3ewhen playing the same Quest again.",decideBtnText:"OK",closeBtnText:"Close"},null,function(){var b=function(b){b&&b.gameUser&&(k=b.gameUser.skipAdventure,a.responseSetStorage(b),f.advSkipDomSet(k),e.remove())};$(".decideBtn").on(a.cgti,function(d){d.preventDefault();a.isScrolled()||l.ajaxPost(a.linkList.setAdvSkip,c,b)})})}},advSkipDomSet:function(b){k=void 0!==b?b:t.gameUser.skipAdventure;b=a.doc.querySelector("#advSkipPopBtn");
k?(a.addClass(b,"sb_gold_02"),a.removeClass(b,"on"),a.removeClass(b,"sb_gold_03")):(a.addClass(b,"on"),a.addClass(b,"sb_gold_03"),a.removeClass(b,"sb_gold_02"))},modelSend:function(){return c},missionToggle:function(b){b.preventDefault();if(!a.isScrolled()){b=a.doc.querySelector("#questLinkList");var c=a.doc.querySelector("#questLinkList").className;-1!==c.indexOf("first")?b.className="second scrollInner":-1!==c.indexOf("second")&&(b.className="first scrollInner")}}}),q=null,p=null;return{needModelIdObj:[{id:"user"},
{id:"gameUser"},{id:"itemList"},{id:"userItemList"},{id:"giftList"},{id:"userGiftList"},{id:"userStatusList"},{id:"userChapterList"},{id:"userSectionList"},{id:"userQuestBattleList"},{id:"userDeckList"},{id:"userCardList"},{id:"userDoppelList"},{id:"userLive2dList"},{id:"userCharaList"},{id:"userQuestAdventureList"},{id:"userFollowList"}],fetch:function(b,c){c&&(String(c).match(/TU/)?q=c:p=c);if(m=b||null)a.mainPointId=b;l.pageModelGet(this.needModelIdObj)},init:function(){if(q)if(a.tutorialId=q,
a.tutorialUtil)a.tutorialUtil.tutorialIdRegist(a.tutorialId),a.tutorialUtil.tutorialAddClass(a.tutorialId);else{g.nativeReload("#/TopPage");return}a.questBattleModel=null;a.setStyle(x+y);t=l.getPageJson();v.supportPickUp(t);n=new A},startCommand:function(){g.startBgm("bgm04_movie12")},remove:function(a){g.endL2d();p=c=m=q=null;n&&(n.trigger("removeView"),n.remove());a()}}});