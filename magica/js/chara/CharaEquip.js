define("underscore backbone backboneCommon ajaxControl command text!template/chara/CharaEquip.html text!template/chara/CharaLimitBreakParts.html text!css/chara/CharaEquip.css text!css/chara/CharaCommon.css cardUtil CharaCommon js/view/item/ItemSalePopupView".split(" "),function(q,m,a,k,h,v,w,x,y,n,c,z){var r,p=null,t=m.Model.extend(),A={0:5E3,1:1E4,2:5E4},B={RANK_1:10,RANK_2:10,RANK_3:3,RANK_4:1,RANK_5:1},e,C=m.View.extend({events:function(){return{}},initialize:function(a){this.template=q.template(v);
this.createDom()},render:function(){this.$el.html(this.template(k.getPageJson()));return this},createDom:function(){a.content.prepend(this.render().el);this.createView()},createView:function(){a.setGlobalView();var b=l();u.prototype.parentView=this;this.lbView=new u({model:new t(b)});a.doc.querySelector("#equipWrap").appendChild(this.lbView.render().el);a.firstNaviCheck(r);h.getBaseData(a.getNativeObj());a.ready.hide()},viewUpdate:function(){var b=c.charaDataView.model.toJSON().revision;3>b?a.doc.querySelector(".needRiche").textContent=
A[b]:a.doc.querySelector(".needRiche").textContent=0}}),u=m.View.extend({className:function(){return"lbWrap pos_"+this.model.get("revision")},events:function(){var b={};b[a.cgti+" .lbBtn"]=this.lbFunc;b[a.cgti+" .cGem"]=this.convertPop;return b},initialize:function(a){this.template=q.template(w);this.listenTo(this.model,"change",this.modelChange);this.parentView.viewUpdate()},render:function(){console.log(this.model.toJSON());this.$el.html(this.template({model:this.model.toJSON()}));return this},
modelChange:function(){this.render();this.el.className=this.className();this.parentView.viewUpdate()},lbFunc:function(b){b.preventDefault();if(!a.isScrolled()){var d=c.charaDataView.model.toJSON(),e=d.chara.name;d.chara.title&&(e+="("+d.chara.title+")");if(b.currentTarget.classList.contains("off"))new a.PopupClass({title:"Cannot Unlock Magic",content:"\x3cp\x3e\x3cspan class\x3d'c_red'\x3eInsufficient Destiny Gems\x3c/span\x3e for\x3cbr\x3e"+e+"You don't have enough Destiny Gems\x3cp\x3e",closeBtnText:"Close",
param:{width:"490px",height:"360px",top:"-webkit-calc(50% - 189px)",left:"-webkit-calc(50% - 245px)"},popupType:"original",popupId:"lbConfirm",showCurtain:!1},null,function(){var b=a.doc.querySelector(".lbWrap .imgWrap").cloneNode(!0),c=a.doc.querySelector(".popupTextArea p");a.doc.querySelector(".popupTextArea").insertBefore(b,c)},function(){a.removeClass(c.charaDataView.el,"popupOpen");a.removeClass(c.curtainView.el,"show")}),a.addClass(c.charaDataView.el,"popupOpen"),a.addClass(c.curtainView.el,
"show");else if(b=a.storage.gameUser.toJSON().riche,parseInt(a.doc.querySelector(".needRiche").textContent)>b)new a.PopupClass({title:"Can't Unlock Magic",content:"Insufficient CC",closeBtnText:"Close",param:{width:"490px",height:"360px",top:"-webkit-calc(50% - 189px)",left:"-webkit-calc(50% - 245px)"},popupType:"original",popupId:"composeConfirm",showCurtain:!1},null,null,function(){a.removeClass(c.charaDataView.el,"popupOpen");a.removeClass(c.curtainView.el,"show");a.removeClass(a.doc.querySelector(".needRiche"),
"c_red");a.addClass(a.doc.querySelector("#richeWrap"),"hide")}),a.addClass(c.charaDataView.el,"popupOpen"),a.addClass(c.curtainView.el,"show"),a.addClass(a.doc.querySelector(".needRiche"),"c_red"),a.removeClass(a.doc.querySelector("#richeWrap"),"hide");else{a.removeClass(a.doc.querySelector("#richeWrap"),"hide");var f=new a.PopupClass({title:"Unlock Magic",content:"\x3cp\x3eAre you sure you want to\x3cbr\x3eUnlock "+e+"'s Magic?\x3cp\x3e",closeBtnText:"Cancel",decideBtnText:"OK",param:{width:"490px",
height:"360px",top:"-webkit-calc(50% - 189px)",left:"-webkit-calc(50% - 245px)"},popupType:"original",popupId:"lbConfirm",showCurtain:!1},null,function(){$("#lbConfirm .decideBtn").on(a.cgti,function(b){b.preventDefault();a.isScrolled()||(a.androidKeyStop=!0,$("#lbConfirm .decideBtn").off(),D(),a.tapBlock(!0),f.remove(),a.removeClass(c.charaDataView.el,"popupOpen"),a.removeClass(c.charaDataView.el,"equipIconShow"),a.removeClass(c.curtainView.el,"show"),a.addClass(a.doc.querySelector("#richeWrap"),
"hide"))});var b=a.doc.querySelector(".lbWrap .imgWrap").cloneNode(!0),d=a.doc.querySelector(".popupTextArea p");a.doc.querySelector(".popupTextArea").insertBefore(b,d)},function(){a.removeClass(c.charaDataView.el,"popupOpen");a.removeClass(c.charaDataView.el,"equipIconShow");a.removeClass(c.curtainView.el,"show");a.addClass(a.doc.querySelector("#richeWrap"),"hide")});a.addClass(c.charaDataView.el,"popupOpen");a.addClass(c.charaDataView.el,"equipIconShow");a.addClass(c.curtainView.el,"show")}}},convertPop:function(b){b.preventDefault();
if(!a.isScrolled()){var d=this.model.toJSON();console.log("_model:",d);0>d.lbItemNum||(b=a.storage.userCardListEx.findWhere({charaId:d.charaId}),b=new z({model:b.toJSON()},function(){var b=c.charaDataView.model.toJSON(),f=a.storage.userCardList.findWhere({cardId:d.cardId}).toJSON(),g=a.storage.userCharaList.findWhere({charaId:d.charaId}).toJSON(),f=n.addExStatus($.extend(f,g)),b=a.storage.userCardListEx.findWhere({id:b.id});b.clear({silent:!0});b.set(f);console.log(f);c.charaDataView.model.set(f);
e.lbView&&(b=l(),e.lbView.model.clear({silent:!0}),e.lbView.model.set(b),h.getBaseData(a.getNativeObj()))}),new a.PopupClass({title:"Exchange Destiny Gems",popupType:"typeE",exClass:"itemSalePop"}),a.doc.getElementById("popupArea").getElementsByClassName("popupTextArea")[0].appendChild(b.render().el),h.getBaseData(a.getNativeObj()))}}}),D=function(){var b={};b.userCardId=c.charaDataView.model.toJSON().id;a.addClass(a.doc.getElementById("popupCurtain"),"tapBlock");k.ajaxPost(a.linkList.userCardLimitBreak,
b,function(b){a.responseSetStorage(b);c.playCustomizeEffect("LIMITBREAK");h.startSe(1121);setTimeout(function(){var d=c.charaDataView.model.toJSON(),f=n.addExStatus($.extend(b.userCardList[0],b.userCharaList[0]));c.charaDataView.model.set(f);var g=a.storage.userCardListEx.findWhere({id:d.id});g.clear({silent:!0});g.set(f);a.doc.querySelector(".hasRiche").textContent=b.gameUser.riche;g={type:"limitBreak"};g.before=d;g.after=f;d=new c.CharaResultView({model:new t(g)});$("#overlapContainer").append(d.render().el);
h.getBaseData(a.getNativeObj());e.lbView&&(d=l(),e.lbView.model.clear({silent:!0}),e.lbView.model.set(d),h.getBaseData(a.getNativeObj()));a.tapBlock(!1);a.removeClass(a.doc.getElementById("popupCurtain"),"tapBlock")},1500)})},l=function(){var a=c.charaDataView.model.toJSON(),d={};d.cardId=a.cardId;d.charaId=a.charaId;d.revision=a.revision;d.needNum=B[a.chara.defaultCard.rank]||null;d.hasNum=a.lbItemNum||0;d.canSet=d.hasNum<d.needNum?!1:!0;d.canCrystal="RANK_4"===a.chara.defaultCard.rank&&2<a.revision&&
2003!==a.charaId?!0:!1;console.log("lbModel",d);return d};return{needModelIdObj:[{id:"user"},{id:"gameUser"},{id:"userStatusList"},{id:"itemList"},{id:"userItemList"},{id:"userCharaList"},{id:"userCardList"},{id:"userDoppelList"},{id:"userLive2dList"},{id:"userGiftList"},{id:"pieceList"},{id:"userPieceList"},{id:"userPieceSetList"},{id:"userDeckList"},{id:"userChapterList"},{id:"userSectionList"},{id:"userQuestBattleList"}],charaSelect:function(b){c.charaSelect(b);b=c.charaDataView.model.toJSON().card.miniCharaNo;
c.showMiniChara(b);e&&e.lbView&&(b=l(),e.lbView.model.clear({silent:!0}),e.lbView.model.set(b),h.getBaseData(a.getNativeObj()))},fetch:function(a){p=a?a:null;k.pageModelGet(this.needModelIdObj)},init:function(){r=k.getPageJson();a.setStyle(x+y);n.createCardList();c.charaViewInit(p);e=new C;a.tapBlock(!1);var b=c.charaDataView.model.toJSON().card.miniCharaNo;c.showMiniChara(b)},remove:function(b){a.doc.querySelector(".needRiche").textContent=0;c.charaViewRemove();p=null;e&&(e.lbView&&(e.lbView.remove(),
e.lbView=null),e.trigger("remove"),e.remove());b()},charaCommon:function(){return c}}});