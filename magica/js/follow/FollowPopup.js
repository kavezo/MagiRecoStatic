define("underscore backbone backboneCommon text!template/follow/FollowPopup.html ajaxControl cardUtil command".split(" "),function(r,y,a,u,g,z,l){var v=r.template(u),h,e,m,f,n,d=!1,p,t=function(c){d=!1;var k=function(){a.followSave&&(a.followSave.active=!1)},b=function(b){window.isLocal&&(b=JSON.parse(b));if("error"!==b.resultCode){var c=[];for(i=1;7>i;i++)if(b.userDeck["userCardId"+i]){var d=r.findWhere(b.userCardList,{id:b.userDeck["userCardId"+i]});d.attNum=b.userDeck["questPositionId"+i];c.push(d)}a.followSave&&
(a.followSave.active=!0,a.followSave.scrollHash=f,a.followSave.pagingNum=p?p:1);a.supportCheckModel=b;new a.PopupClass({content:"",popupType:"typeB",exClass:"userProfile followerPop"},null,null,k);a.doc.createDocumentFragment();var d=a.doc.createElement("div"),h=a.isRankingRunning(g.getPageJson().eventList);d.innerHTML=v({model:e,profile:b,support:c,rankingRunning:h});a.doc.getElementById("popupArea").getElementsByClassName("popupTextArea")[0].appendChild(d);c=a.doc.getElementById("utilBtns");c.getElementsByClassName("follow")[0].addEventListener(a.cgti,
w);c.getElementsByClassName("disFollow")[0].addEventListener(a.cgti,x);e.blocked?a.doc.getElementById("followImageWrap").getElementsByClassName("messageInner")[0].textContent="Blocked":a.doc.getElementById("followImageWrap").getElementsByClassName("messageInner")[0].textContent=b.gameUser.comment;"arena"===m&&(a.doc.getElementsByClassName("helpBtnWrap")[0].style.display="none");window.isDebug&&a.doc.querySelector("#debugArenaBtn").addEventListener(a.cgti,function(c){c.preventDefault();a.isScrolled()||
(a.storage.userStatusList.findWhere({statusId:"BTP"})&&0==a.storage.userStatusList.findWhere({statusId:"BTP"}).point?new a.PopupClass({title:"Insufficient BP",content:"Restore BP before trying again.",closeBtnText:"Cancel"}):g.ajaxPost(a.linkList.arenaStart,{opponentUserId:b.userId,arenaBattleType:"FREE_RANK"},function(b){a.acpTimeCure&&(clearInterval(a.acpTimeCure),a.acpTimeCure=null);$(a.ready.target).on("webkitAnimationEnd",function(){l.changeBg("web_black.jpg");$(a.ready.target).off("webkitAnimationEnd");
$(a.ready.target).on("webkitAnimationEnd",function(b){"readyFadeOut"==b.originalEvent.animationName&&(a.ready.target.className="")});var c={};c.questId=b.userQuestBattleResultList[0].id;c.resultUrl="/magica/index.html#/TopPage";c.retireUrl="/magica/index.html#/ArenaFreeRank";c.tips={type:2};a.globalMenuView&&a.globalMenuView.trigger("removeView");setTimeout(function(){l.setWebView(!1);l.startArena(c)},500)});a.g_popup_instance.remove();a.addClass(a.ready.target,"preNativeFadeIn")}))})}l.getBaseData(a.getNativeObj())};
window.isLocal?require(["text!/magica/json/friend/user/1.json"],function(a){b(a)}):g.ajaxSimpleGet(a.linkList.followerProfile,f,b)},w=function(c){c.preventDefault();if(!a.isScrolled()&&!d){var k=a.storage.userStatusList.findWhere({statusId:"MAX_FOLLOW"}).toJSON().point;k<=a.storage.userFollowList.length?new a.PopupClass({title:"Max Followers",content:"You reached the Follow limit.\x3cbr\x3eYou cannot follow any more users.\x3cbr\x3e\x3cbr\x3e"+("Follows: "+a.storage.userFollowList.length+"/"+k+""),
closeBtnText:"Cancel"}):(d=!0,g.ajaxPost(a.linkList.sendFollow,{friendUserId:f},function(b){d=!1;"error"!==b.resultCode&&(a.responseSetStorage(b),new a.PopupClass({title:"Follow",content:"Followed \x3cspan class\x3d'c_pink'\x3e"+e.userName+"\x3c/span\x3e.\x3cbr\x3e\x3cbr\x3e"+("Follows: "+a.storage.userFollowList.length+"/"+k+""),closeBtnText:"Cancel"}),q()&&n.rootView.allCheckAndChange(f,"follow"))}))}},x=function(c){c.preventDefault();a.isScrolled()||d||(d=!0,g.ajaxPost(a.linkList.unfollow,{friendUserId:f},
function(c){d=!1;if("error"!==c.resultCode){var b=a.storage.userFollowList.length-c.deleted.userFollowList.length;a.responseSetStorage(c);q()||a.storage.userFollowList.remove(a.storage.userFollowList.findWhere({followUserId:f}));c=a.storage.userStatusList.findWhere({statusId:"MAX_FOLLOW"}).toJSON().point;new a.PopupClass({title:"Unfollow",content:"Unfollowed "+e.userName+".\x3cbr\x3e\x3cbr\x3e"+("Follows: "+b+"/"+c+""),closeBtnText:"Cancel"});q()&&n.rootView.allCheckAndChange(f,"unfollow")}}))},q=
function(){var a=!1;switch(m){case "follow":case "block":case "search":case "follower":a=!0}return a};return{followerDetailPopup:function(c,d){clearTimeout(h);h=setTimeout(function(){if(!a.isScrolled()){if(a.ua.android){var b=a.doc.body.scrollTop;if(30<b-a.g_window_posY||-30>b-a.g_window_posY)return}c.preventDefault();e=d;t()}},800)},popupTimerStop:function(a){clearTimeout(h)},instantPopup:function(a,d,b,g,h){e=d;m=b;f="follow"===b?e.followUserId:"follower"===b?e.followerUserId:"block"===b?e.blockUserId:
"search"===b?e.id:e.userId;n=g;p=h;t()}}});